import{d as R,k as D,c as w,o as g,x as Q,e as n,t as A,g as l,W as ie,L as Z,w as S,l as W,m as I,f as _,E as q,D as de,p as ee,r as U,y as te,a as e,n as E,F as T,H as P,v as ue,s as ce}from"./index-CIPWK8yN.js";import{_ as z}from"./BaseButton.vue_vue_type_script_setup_true_lang-B4Ux1n23.js";import{A as me}from"./AlertOutline-oU_ZwQVT.js";import{u as pe}from"./useFieldWrapper-BdEMQuhw.js";import{o as G,c as se,a as N,n as V,s as C}from"./types-CVZIcfwR.js";import{A as $}from"./api.schema-B7NsqcGR.js";import{c as fe}from"./defect.summaryApi-CUJMEH2X.js";import{u as ge}from"./line.page-D-LW0-Q-.js";import{u as ve}from"./user.table-B4bXUK39.js";import{t as ye}from"./vee-validate-zod-oXVd7K3l.js";import{u as _e}from"./vee-validate-Bhj0rIeg.js";import{S as he,T as be,P as Le}from"./Trash-B71ZDBje.js";import{_ as xe}from"./BaseInput.vue_vue_type_script_setup_true_lang-D7TFLp56.js";import{S as Se}from"./SearchOutline-Dz98mDoV.js";import{R as we}from"./RefreshRound-Dh-5GAel.js";import{C as ae}from"./ChartPerson20Filled-Db77PKFq.js";import{F as Ae}from"./FolderDetailsReference-nV6PVqR-.js";import{S as Ce}from"./SmartHome-Ds7UqPzK.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./stockin.api.schema-DC3-uBMr.js";import"./metaPagination-9MSE0uSw.js";import"./dateRangeFormaterNaive-ClR-GZjc.js";import"./user.store-2zhJjPCB.js";import"./user.schema-BXMI3HnA.js";import"./employeeSchema-AqYtwcrb.js";const ke={class:"flex flex-col gap-1"},Ue=["status","for"],X=R({__name:"BaseSelectWithError",props:{modelValue:{},options:{},placeholder:{default:"Select option"},clearable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},size:{default:"medium"},icon:{default:null},errors:{},label:{},name:{},multiple:{type:Boolean,default:!1},classContent:{}},emits:["update:modelValue"],setup(a,{emit:t}){const s=a,d=t,u=D(()=>s.errors?.[s.name]),c=D(()=>u.value?"error":void 0);return(r,o)=>{const p=_("n-icon"),h=_("n-tooltip");return g(),w("div",ke,[r.label?(g(),w("label",{key:0,status:c.value,for:s.name,class:"text-sm font-medium text-gray-700"},A(r.label),9,Ue)):Q("",!0),n(l(ie),{id:s.name,value:s.modelValue,options:s.options,multiple:s.multiple,placeholder:s.placeholder,clearable:s.clearable,filterable:s.filterable,size:s.size,"onUpdate:value":o[0]||(o[0]=m=>d("update:modelValue",m)),class:Z([s.classContent,"!min-w-[200px]"]),"max-tag-count":s.multiple?0:void 0,"render-tag":s.multiple?()=>null:void 0},{arrow:S(()=>[u.value?(g(),W(h,{key:0,show:!!u.value,trigger:"hover"},{trigger:S(()=>[n(p,{component:l(me),color:"red"},null,8,["component"])]),default:S(()=>[I(" "+A(u.value),1)]),_:1},8,["show"])):Q("",!0)]),_:1},8,["id","value","options","multiple","placeholder","clearable","filterable","size","class","max-tag-count","render-tag"])])}}}),Be=G({userId:V().nullable().refine(a=>a!==null,"Leader is required").transform(a=>a),lineId:N(V()).min(1,"Leader is required"),isActive:se()}),H="/api",O={getAssignments:()=>q.get(`${H}/leaders`).then(a=>a.data),createAssign:a=>q.post(`${H}/leaders/assign`,a).then(t=>t.data),createUnassign:a=>q.post(`${H}/leaders/unassign`,a).then(t=>t.data)},Y=G({assignId:V(),assignAt:C(),unassignAt:C().nullable(),lineId:V().nullable(),lineName:C().nullable(),createdBy:C(),updatedBy:C().nullable(),lastUpdated:C()}),Fe=G({leader:C(),leaderId:V(),isActive:se(),activeLines:C(),activeLineIds:C(),lastUpdated:C().nullable(),activeDetail:N(Y),inactiveDetail:N(Y)}),$e=fe(N(Fe)),ne=de("leaderStore",{state:()=>({loading:!1,error:null,AssignmentSummaryByLeader:[]}),actions:{async fetchSummaryByLeader(){this.loading=!0,this.error=null;try{const a=await O.getAssignments(),t=$e.parse(a);return this.AssignmentSummaryByLeader=t.data,$.parse({success:!0,message:t.message??"loaded"})}catch(a){const t=a?.response?.data?.message||"Something went wrong";return this.error=t,$.parse({success:!1,message:t})}finally{this.loading=!1}},async createAssignLeader(a){try{const t=await O.createAssign(a);return $.parse({success:!0,message:t.message??"Created",data:t.data})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}},async unAssignLeader(a){try{const t=await O.createUnassign(a);return $.parse({success:!0,message:t.message??"Created",data:t.data})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}}}});function le(a=null){const t=ee(),s=ne(),d=U(!1),{rows:u,handleFetch:c}=ve(),{data:r,handleFetch:o}=ge(),p=D(()=>u.value.map(x=>({label:x.name,value:x.id}))),h=D(()=>r.value.map(x=>({label:x.name,value:x.id}))),m=async x=>{d.value=!0,await s.createAssignLeader(x),d.value=!1},i=async x=>{d.value=!0;const{success:re,message:K}=await s.unAssignLeader(x);re?t.success(K):t.error(K),d.value=!1},v=async()=>{await Promise.all([c(),o({notify:!1},{})])},y=()=>({userId:a?.userId??null,lineId:a?.lineId??[],isActive:a?.isActive??!0}),{handleSubmit:B,errors:b,isSubmitting:F,resetForm:k,validate:f}=_e({validationSchema:ye(Be),initialValues:y()}),{userId:M,lineId:j,isActive:L}=pe(["userId","lineId","isActive"]);return{isLoading:d,userId:M,lineId:j,isActive:L,optionUsers:p,optionLines:h,handleUserLineData:v,onSubmit:B,resetForm:()=>{k({values:y(),errors:{}})},errors:b,isSubmitting:F,validateForm:async()=>{const x=await f();return x.valid?{valid:!0,values:x.values}:{valid:!1}},handleCreateAssignLeader:m,handleUnassignLeader:i}}const De={class:"flex flex-col gap-5"},Ie={class:"flex gap-2 items-end"},Ve={class:"flex flex-col"},Re={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Te={class:"flex gap-2 flex-wrap mt-2"},Pe={class:"flex gap-2 justify-end"},ze=R({__name:"LeaderAssignmentForm",props:{modal:{type:Boolean},initialData:{}},emits:["update:modal"],setup(a,{emit:t}){const s=a,{isLoading:d,userId:u,lineId:c,isActive:r,optionLines:o,optionUsers:p,onSubmit:h,errors:m,resetForm:i,handleUserLineData:v,handleCreateAssignLeader:y}=le(s.initialData),B=h(k=>{y(k),F(!1)}),b=t,F=k=>{b("update:modal",k)};return te(async()=>{await v()}),(k,f)=>{const M=_("n-switch"),j=_("n-tag");return g(),w("div",null,[e("form",{onSubmit:f[3]||(f[3]=ue((...L)=>l(B)&&l(B)(...L),["prevent"]))},[e("div",De,[f[6]||(f[6]=e("div",{class:"mb-5"},[e("p",{class:"text-xl font-semibold"},"Leader Assignment Form"),e("p",null,"A dedicated form interface for assigning leaders to specific production lines.")],-1)),e("div",Ie,[n(X,{name:"userId",options:l(p),label:"Leaders",modelValue:l(u),"onUpdate:modelValue":f[0]||(f[0]=L=>E(u)?u.value=L:null),placeholder:"Select Leader",errors:l(m)},null,8,["options","modelValue","errors"]),n(X,{name:"lineId",options:l(o),multiple:"",label:"Lines",modelValue:l(c),"onUpdate:modelValue":f[1]||(f[1]=L=>E(c)?c.value=L:null),placeholder:"Select Lines",errors:l(m)},null,8,["options","modelValue","errors"]),e("div",Ve,[f[4]||(f[4]=e("label",{id:"isActive",class:"mb-2 font-semibold"},"Is Active",-1)),n(M,{round:!1,size:"large",value:l(r),"onUpdate:value":f[2]||(f[2]=L=>E(r)?r.value=L:null)},null,8,["value"])])]),e("div",Re,[f[5]||(f[5]=e("p",{class:"text-xs text-gray-400"},"Selected Lines",-1)),e("div",Te,[(g(!0),w(T,null,P(l(c),L=>(g(),W(j,{key:L,size:"small",type:"info",round:""},{default:S(()=>[I(A(l(o).find(J=>J.value===L)?.label),1)]),_:2},1024))),128))])]),e("div",Pe,[n(z,{label:"Reset",onClick:l(i),type:"error",quaternary:""},null,8,["onClick"]),n(z,{label:"Assign Leader",icon:l(he),"icon-placement":"right",loading:l(d),type:"primary",attrType:"submit"},null,8,["icon","loading"])])])],32)])}}}),Ne={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Me={class:"text-lg font-semibold mb-5"},je=R({__name:"LeaderUnassignmentForm",props:{initialData:{}},setup(a){const t=U(null),{isLoading:s,handleUnassignLeader:d}=le(),u=async(c,r)=>{t.value=c,await d({id:r}),a.initialData?.activeDetail.splice(c,1),t.value=null};return(c,r)=>{const o=_("n-divider"),p=_("n-list-item"),h=_("n-list");return g(),w("div",null,[e("div",Ne,[e("p",Me,A(a.initialData?.leader),1),r[0]||(r[0]=e("p",{class:"text-xs font-semibold text-gray-400"},"Assignment Lines",-1)),n(o,{dashed:"",class:"!my-[10px]"}),n(h,{bordered:""},{default:S(()=>[(g(!0),w(T,null,P(a.initialData?.activeDetail,(m,i)=>(g(),W(p,{class:Z((i===t.value,"dimmed"))},{suffix:S(()=>[n(z,{label:"unassign line",size:"small",icon:l(be),type:"error",loading:l(s),onClick:v=>u(i,m.assignId),disabled:i==t.value},null,8,["icon","loading","onClick","disabled"])]),default:S(()=>[I(A(m?.lineName)+" ",1)]),_:2},1032,["class"]))),256))]),_:1})])])}}});function oe(){const a=ee(),t=ne(),s=U(!1),{loading:d,AssignmentSummaryByLeader:u}=ce(t);return{leaderPiniaLoading:d,isLoading:s,AssignmentSummaryByLeader:u,fetchSummaryByLeader:async(r={notify:!0})=>{const{success:o,message:p}=await t.fetchSummaryByLeader();return r.notify&&(o?a.success(p):a.error(p)),{success:o,message:p}}}}const qe={class:"flex flex-col gap-5"},Ee={class:"flex justify-between"},He={class:"!w-[300px]"},Oe={class:"flex gap-3 items-center"},We={class:"flex gap-2"},Ge=R({__name:"SummaryLeaderTable",emits:["click:unassignLine"],setup(a,{emit:t}){const s=U(""),d=D(()=>{const m=s.value.toLowerCase().trim();return m?(c.value||[]).filter(i=>i.leader?.toLowerCase().includes(m)||i.activeLines?.toLowerCase().includes(m)):c.value||[]}),{leaderPiniaLoading:u,AssignmentSummaryByLeader:c,fetchSummaryByLeader:r}=oe(),o=t,p=async()=>{await r()},h=async m=>{o("click:unassignLine",m)};return(m,i)=>{const v=z,y=_("n-skeleton"),B=_("n-table");return g(),w("div",qe,[e("div",Ee,[e("div",He,[n(xe,{icon:l(Se),placeholder:"Search",modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=b=>s.value=b)},null,8,["icon","modelValue"])]),e("div",Oe,[n(v,{label:"Refresh",icon:l(we),onClick:p},null,8,["icon"]),n(v,{label:"Create Leader Assignment",icon:l(ae),onClick:p,type:"primary"},null,8,["icon"])])]),n(B,null,{default:S(()=>[i[2]||(i[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Leader"),e("th",null,"Line Assignments"),e("th",null,"Last Updated"),e("th",null,"Status")])],-1)),e("tbody",null,[l(u)?(g(),w(T,{key:0},P(10,b=>e("tr",{key:b},[e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})]),e("td",null,[n(y,{text:""})])])),64)):(g(!0),w(T,{key:1},P(d.value,(b,F)=>(g(),w("tr",{key:F},[e("td",null,A(F+1),1),e("td",null,A(b.leader),1),e("td",null,A(b.activeLines),1),e("td",null,A(b.lastUpdated),1),e("td",We,[n(v,{label:"Detail",icon:l(Ae),onClick:i[1]||(i[1]=()=>{}),tertiary:""},null,8,["icon"]),n(v,{label:"Unasssign Line",icon:l(Le),tertiary:"",type:"error",onClick:k=>h(b)},null,8,["icon","onClick"])])]))),128))])]),_:1})])}}}),Je={class:"flex flex-col gap-10"},Ke={class:"flex justify-between items-center"},Qe={class:"w-84 flex-auto"},Xe={class:"text-xl font-bold mb-1"},Ye={class:"w-16 flex-auto text-right"},Ct=R({__name:"LeadersPageView",setup(a){const t=U({title:"Leader Management Module",description:"A centralized interface enabling users to view, create, and maintain leader records assigned across multiple production lines. The module streamlines oversight, improves data governance, and ensures operational visibility by providing a structured workflow for leader placement and line assignments."}),s=U(!1),d=U(),{fetchSummaryByLeader:u}=oe(),c=r=>{d.value=r};return te(async()=>{await u()}),(r,o)=>{const p=_("n-icon"),h=_("n-breadcrumb-item"),m=_("n-breadcrumb"),i=_("n-modal");return g(),w("div",Je,[e("div",Ke,[e("div",Qe,[e("h2",Xe,A(t.value.title),1),e("p",null,A(t.value.description),1)]),e("div",Ye,[n(m,null,{default:S(()=>[n(h,null,{default:S(()=>[n(p,{component:l(Ce)},null,8,["component"]),o[2]||(o[2]=I(" Home",-1))]),_:1}),n(h,null,{default:S(()=>[n(p,{component:l(ae)},null,8,["component"]),o[3]||(o[3]=I(" Leaders ",-1))]),_:1})]),_:1})])]),n(Ge,{"onClick:unassignLine":c}),n(i,{show:s.value,"onUpdate:show":o[1]||(o[1]=v=>s.value=v),preset:"card",style:"width: 1200px"},{default:S(()=>[n(ze,{modal:s.value,"onUpdate:modal":o[0]||(o[0]=v=>s.value=v)},null,8,["modal"])]),_:1},8,["show"]),n(je,{initialData:d.value},null,8,["initialData"])])}}});export{Ct as default};
