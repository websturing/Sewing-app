import{_ as I}from"./BaseSelectWithError.vue_vue_type_script_setup_true_lang-DAEM6_7f.js";import{_ as K}from"./BaseButton.vue_vue_type_script_setup_true_lang-DcrN91Jq.js";import{u as M}from"./gls.store-DO7Efq7E.js";import{u as W}from"./defect.store-D5KSGUF-.js";import{u as J}from"./replacement.store-Fxgg6xgP.js";import{p as O,r as g,s as Q,k as z,d as B,q as X,y as Y,c as v,a as e,x as T,e as o,g as i,f,t as p,w as h,h as Z,o as c,F,H as k,l as ee,I as te,m as $}from"./index-KKLjXh5o.js";import{S as le}from"./SaveAnnotation-o7iAhaiJ.js";import{S as ne}from"./SmartHome-CoCWvi5q.js";import{F as oe}from"./Forms-BC6efRn-.js";import"./AlertOutline-Cjudp7X9.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./metaPagination-BMwnZfrC.js";import"./types-CVZIcfwR.js";import"./api.schema-B7NsqcGR.js";import"./defect.summaryApi-Bar6lMpN.js";function se(){const N=O(),a=W(),y=J(),s=g(null),{defectGroupGlNumber:b}=Q(a),_=z(()=>b.value.length>0?b.value.map(l=>({value:l.glNumber,label:l.glNumber})):[]);return{defectColorSizeDetail:s,optionGlnumbers:_,handleFetchGlNumberDefect:async(l=!1)=>{const{success:u,message:m}=await a.fetchGroupGlNumber();return l&&(u?N.success(m):N.error(m)),{success:u,message:m}},handleFilterDefectGlNumber:l=>{const u=b.value.find(m=>m.glNumber==l);s.value=u,s.value.items=u?.items.map(m=>({...m,items:m.items.map(C=>({...C,maxDefect:C.totalDefect}))}))},handleCreateReplacement:async l=>{const{message:u}=await y.createTicketReplacement(l);return N.success(u),u}}}const ae={class:"flex flex-col gap-10"},re={class:"flex flex-col gap-2"},ie={key:0,class:"mt-2 p-10 bg-gray-50 border border-gray-200 rounded-lg"},ue={key:1,class:"flex flex-col gap-5 border border-gray-200 rounded-lg p-5"},me={class:"!text-md"},de={class:"!font-bold"},ce={class:"!font-bold"},pe={class:"!font-bold !text-red-400"},fe=["colspan"],be={class:"!text-center !bg-white"},ve={class:"!text-center"},_e={class:"flex justify-center"},ge={class:"!text-center !font-bold !text-red-400"},xe={class:"mt-3"},ye={class:"flex justify-end"},De=B({__name:"ReplacementForm",setup(N){const a=g(!1),y=g(null),s=g(" "),b=g([]),_=g(""),G=g([]),R=Z(),{optionGlnumbers:L,defectColorSizeDetail:l,handleFetchGlNumberDefect:u,handleFilterDefectGlNumber:m,handleCreateReplacement:C}=se(),V=z(()=>l.value?.items.reduce((r,t)=>r+t.items.reduce((d,D)=>d+(D.totalDefect??0),0),0)??0);X(y,async r=>{if(m(r),_.value=l.value?.items.find(t=>t.totalDefect>0)?.color??"",r){const{data:t}=await M().fetchSummaryGl(r);b.value=t.summaryByGl[0].layingPlannings}});const U=r=>{if(r.keyCode===8||r.key==="Backspace")return r.preventDefault(),!1},H=async()=>{const t=(l.value?.items.map(d=>d.items.filter(w=>w.totalDefect>0)).filter(d=>d.length>0).flat()).map(d=>{const D=b.value.find(w=>w.color===d.color);return{...d,layingPlanningId:D?.id??null}});G.value={defectList:t,note:s.value},a.value=!0,await C(G.value),a.value=!1,R.push({name:"replacement"})};return Y(()=>{u()}),(r,t)=>{const d=I,D=f("n-input"),w=f("n-empty"),P=f("n-divider"),j=f("n-input-number"),q=f("n-table"),A=f("n-tab-pane"),E=f("n-tabs");return c(),v("div",ae,[e("div",re,[o(d,{name:"glNumber",options:i(L),label:"GL Numbers",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),placeholder:"Select GL Number",classContent:"!w-[300px]"},null,8,["options","modelValue"]),e("div",null,[t[3]||(t[3]=e("label",{class:"font-semibold"},"Note",-1)),o(D,{value:s.value,"onUpdate:value":t[1]||(t[1]=n=>s.value=n),type:"textarea",placeholder:"	Provide additional details if needed"},null,8,["value"])])]),i(l)?T("",!0):(c(),v("div",ie,[o(w,{description:"GL Number not selected",size:"huge"})])),i(l)?(c(),v("div",ue,[e("div",null,[t[10]||(t[10]=e("p",{class:"mb-2 text-gray-400"},"GL Number Detail",-1)),e("table",me,[e("tbody",null,[e("tr",null,[t[4]||(t[4]=e("td",null,"GL Number",-1)),t[5]||(t[5]=e("td",null,"  :  ",-1)),e("td",de,p(i(l).glNumber),1)]),e("tr",null,[t[6]||(t[6]=e("td",null,"Color",-1)),t[7]||(t[7]=e("td",null,"  :  ",-1)),e("td",ce,p(i(l).color)+" ("+p(i(l).items.length)+" Color)",1)]),e("tr",null,[t[8]||(t[8]=e("td",null,"Total Defect",-1)),t[9]||(t[9]=e("td",null,"  :  ",-1)),e("td",pe,p(i(l).totalDefect),1)])])])]),o(P),t[17]||(t[17]=e("p",{class:"text-gray-400"},"Request Form Replacement Detail",-1)),e("div",null,[o(E,{value:_.value,"onUpdate:value":t[2]||(t[2]=n=>_.value=n),type:"card",animated:"","pane-class":"!bg-blue-50 rounded-lg !p-3"},{default:h(()=>[(c(!0),v(F,null,k(i(l)?.items.filter(n=>n.totalDefect>0),n=>(c(),ee(A,{name:n.color,tab:n.color},{default:h(()=>[o(q,{class:"!shadow-sm","single-line":!1},{default:h(()=>[e("thead",null,[e("tr",null,[t[11]||(t[11]=e("th",{class:"!bg-white"},"Color",-1)),e("th",{colspan:(n.items.length??0)+1,class:"!text-center !bg-white !text-blue-600 !font-semibold"},p(n.color),9,fe)]),e("tr",null,[t[12]||(t[12]=e("th",{class:"!bg-white"},"Size",-1)),(c(!0),v(F,null,k(n.items,x=>(c(),v("th",be,p(x.size),1))),256)),t[13]||(t[13]=e("th",{class:"!bg-white !text-center"},"Total",-1))])]),e("tbody",null,[e("tr",null,[t[14]||(t[14]=e("td",null,"Defect",-1)),(c(!0),v(F,null,k(n.items,x=>(c(),v("td",ve,[e("div",_e,[o(j,{min:"0",max:x.maxDefect,class:"!w-[110px]",value:x.totalDefect,"onUpdate:value":S=>x.totalDefect=S,onKeydown:U,"button-placement":"both"},null,8,["max","value","onUpdate:value"])])]))),256)),e("td",ge,p(n.items.reduce((x,S)=>x+(S.totalDefect??0),0)),1)])])]),_:2},1024),e("div",xe,[e("table",null,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("td",null,"Grand Total Defect",-1)),t[16]||(t[16]=e("td",null,"  :  ",-1)),e("td",null,p(V.value),1)])])])])]),_:2},1032,["name","tab"]))),256))]),_:1},8,["value"])]),e("div",ye,[o(K,{label:"Save Changes",type:"primary",onClick:H,icon:i(le),loading:a.value},null,8,["icon","loading"])])])):T("",!0)])}}}),he={class:"flex flex-col gap-10"},Ne={class:"flex justify-between items-center"},Ge={class:"w-84 flex-auto"},we={class:"text-xl font-bold mb-1"},Ce={class:"w-16 flex-auto text-right"},Ee=B({__name:"ReplacementPageFormView",setup(N){const a=g({title:"Defect Replacement Ticket Form",description:"A streamlined form interface for issuing replacement tickets tied to defective GL numbers identified during stock-in or sewing operations."});return te({title:a.value.title,meta:[{name:"description",content:a.value.description}]}),(y,s)=>{const b=f("n-icon"),_=f("n-breadcrumb-item"),G=f("n-breadcrumb");return c(),v("div",he,[e("div",Ne,[e("div",Ge,[e("h2",we,p(a.value.title),1),e("p",null,p(a.value.description),1)]),e("div",Ce,[o(G,null,{default:h(()=>[o(_,null,{default:h(()=>[o(b,{component:i(ne)},null,8,["component"]),s[0]||(s[0]=$(" Home",-1))]),_:1}),o(_,null,{default:h(()=>[o(b,{component:i(oe)},null,8,["component"]),s[1]||(s[1]=$(" Replacement ",-1))]),_:1})]),_:1})])]),o(De)])}}});export{Ee as default};
