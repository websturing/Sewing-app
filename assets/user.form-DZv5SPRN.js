import{A as U}from"./EyeOutline-DkxU9Qk7.js";import{d as V,k as R,c as _,x as b,e as F,t as k,f as v,S as D,w,o as C,l as N,m as x,g as L,D as B,E as m,p as A}from"./index-CjlGo7ug.js";import{u as E}from"./useFieldWrapper-D5k55XOA.js";import{U as T,a as W}from"./user.schema-CVwUSP_m.js";import{A as l}from"./api.schema-BgX2oz3V.js";import{t as I}from"./vee-validate-zod-CE1MH_0j.js";import{u as $}from"./vee-validate-uGSnglWx.js";const M={class:"flex flex-col gap-1"},O=["for"],ae=V({__name:"SelectLabelWithError",props:{modelValue:{},options:{},name:{},label:{},icon:{},placeholder:{default:"Select Item"},errors:{},readonly:{type:Boolean},classContent:{},multiple:{type:Boolean,default:!1}},emits:["update:modelValue","change","search"],setup(e,{emit:a}){const s=e,t=a,n=R(()=>s.errors?.[s.name]),p=R(()=>n.value?"error":void 0);return(i,u)=>{const g=v("n-icon"),f=v("n-tooltip"),S=v("n-select");return C(),_("div",M,[i.label?(C(),_("label",{key:0,for:s.name,class:"text-sm font-medium text-gray-700"},k(i.label),9,O)):b("",!0),F(S,D({id:s.name,status:p.value,multiple:i.multiple,options:s.options,placeholder:s.placeholder,disabled:s.readonly,filterable:""},i.$attrs,{value:i.modelValue,"onUpdate:value":u[0]||(u[0]=d=>{t("update:modelValue",d),t("change",d)}),class:[s.classContent,"w-full"],onSearch:u[1]||(u[1]=d=>t("search",d))}),{arrow:w(()=>[n.value?(C(),N(f,{key:0,show:!!n.value,trigger:"hover"},{trigger:w(()=>[F(g,{component:L(U),color:"red"},null,8,["component"])]),default:w(()=>[x(" "+k(n.value),1)]),_:1},8,["show"])):b("",!0)]),_:1},16,["id","status","multiple","options","placeholder","disabled","value","class"])])}}}),j=B("users",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:""}),actions:{async fetch(e={}){this.loading=!0,this.error=null,console.log("fetching user data");try{const a={page:e.page??1,perPage:e.perPage??10,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};console.log("fetching user data 1"),e.q&&(this.searchResult=[],this.isSearching=!0);const s=await m.get("/api/users",{params:a});console.log(s.data);const t=T.parse(s.data);return console.log(t),this.meta=t.meta,this.links=t.links,this.currentPage=t.meta.currentPage,this.lastPage=t.meta.lastPage,e.q?this.searchResult=t.data:(this.data=t.data,this.isSearching=!1,this.searchResult=[]),l.parse({success:!0,message:t.message??"Employees loaded"})}catch(a){const s=a?.response?.data?.message||"Something went wrong";return this.error=s,l.parse({success:!1,message:s})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetch(),this.data;const a=this.data.filter(t=>t.name?.toLowerCase().includes(e)||t.email?.toLowerCase().includes(e));return a.length>0?(this.searchResult=a,this.isSearching=!0,a):(await this.fetch({page:1,q:e})).success?this.searchResult:[]},async create(e){this.loading=!0,this.error=null;try{const a=await m.post("/api/users",e);return this.data.push(a.data.data),this.error=null,l.parse({success:!0,message:a.data.message??"Data Created Succesfully",id:a.data.data.id})}catch(a){const s=a?.response?.data?.message||"Someting Wrong";return this.error=s,l.parse({success:!1,message:s})}finally{this.loading=!1}},async update(e,a){this.loading=!0,this.error=null;try{const s=await m.post(`/api/users/${e}`,a),t=this.data.findIndex(n=>n.id===e);return t!==-1&&(this.data[t]={...this.data[t],...s.data.data}),this.error=null,l.parse({success:!0,message:s.data.message??"Data Update Successfully"})}catch(s){const t=s?.response?.data?.message||"Something Wrong";return this.error=t,l.parse({success:!1,message:t})}finally{this.loading=!1}},async delete(e){this.loading=!0,this.error=null;try{const a=await m.delete(`/api/users/${e}`);return this.data=this.data.filter(s=>s.id!==e),this.error=null,l.parse({success:!0,message:a.data.message??"Data Delete Successfully"})}catch(a){const s=a?.response?.data?.message||"Something Wrong";return this.error=s,l.parse({success:!1,message:s})}finally{this.loading=!1}}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const a=e.search.toLowerCase();return e.data.filter(s=>s.name?.toLowerCase().includes(a)||s.email?.toLowerCase().includes(a))}}});function te(e=null){const a=A(),s=j(),t=()=>({email:e?.email??"",name:e?.name??"",roleNames:e?.roleNames??[]}),{handleSubmit:n,errors:p,isSubmitting:i,resetForm:u,validate:g}=$({validationSchema:I(W),initialValues:t()}),f=()=>{u({values:t(),errors:{}})},{email:S,name:d,roleNames:P}=E(["email","name","roleNames"]);return{name:d,email:S,roleNames:P,errors:p,isSubmitting:i,validateForm:async()=>{const r=await g();return r.valid?{valid:!0,values:r.values}:{valid:!1}},onSubmit:r=>n(r),resetForm:f,handleCreateStore:async(r,h={notify:!0})=>{const{success:c,message:o}=await s.create(r);return h.notify&&(c?a.success(o):a.error(o)),{success:c,message:o}},handleUpdateStore:async(r,h,c={notify:!0})=>{const{success:o,message:y}=await s.update(r,h);return c.notify&&(o?a.success(y):a.error(y)),{success:o,message:y}},handleDeleteStore:async(r,h={notify:!0})=>{const{success:c,message:o}=await s.delete(r);return h.notify&&(c?a.success(o):a.error(o)),{success:c,message:o}}}}export{ae as _,j as a,te as u};
