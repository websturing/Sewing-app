import{u as oe,_ as ge}from"./AssignmentLines.store-BeNnRqzy.js";import{r as U,s as D,q as K,d as M,c as F,o as f,a as t,a7 as he,v as le,e as i,f as $,w as h,F as Y,H as W,l as V,m as A,t as S,a8 as pe,g as n,p as z,D as fe,E as ye,P as _e,k as ve,y as be,x as q,n as H,h as Se,I as xe}from"./index-BkxyZoiH.js";import{_ as re}from"./BaseButton.vue_vue_type_script_setup_true_lang-BbsPoPWD.js";import{t as we,I as Le}from"./vee-validate-zod-D8Nz0lEl.js";import{_ as Pe}from"./ProgressModal.vue_vue_type_script_setup_true_lang-BFKNsjM0.js";import{_ as ae}from"./SelectLabelWithError.vue_vue_type_script_setup_true_lang-C06U5tJm.js";import{u as Fe}from"./useFieldWrapper-DUlTV3px.js";import{f as Ce}from"./dateRangeFormaterNaive-ClR-GZjc.js";import{o as T,a as ie,s as C,n as k,e as $e,c as Ne}from"./types-D48y91Ee.js";import{u as J}from"./gls.store-BmEMjQDa.js";import{u as Re}from"./vee-validate-CsXVIkDi.js";import{C as Ge,B as ke,a as Ae,b as Ie,S as Ue}from"./Search20Filled-CF3QssaK.js";import{M as Ve,L as Te,A as ne}from"./api.schema-BwRGpLBP.js";import{S as Be}from"./SaveAnnotation-ZsCr-cyR.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Qe}from"./SmartHome-8PQQeU5l.js";import{B as je}from"./BrandAirtable-CcAwsQ6t.js";import{F as De}from"./FormNew28Regular-BbE14tnx.js";import"./user.schema-DUhrVGkL.js";import"./employeeSchema-BY4Ew02x.js";import"./EyeOutline-DFLeScVz.js";import"./DocumentError16Filled-D5jO0_o_.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";const Me=T({glId:k().min(1,"GL is required"),glNumber:C().min(1,"GL Number is required"),lineId:k().min(1,"Line is required"),dateStart:C(),dateEnd:C(),layingPlanning:T({id:k().optional(),color:C().min(1,"Color is required"),type:$e(["BODY","COMBINASI"]),summary:T({orderQty:k().int().nonnegative(),cutQty:k().int().nonnegative()})}),dateRange:ie(C()).length(2,"Date range must have exactly two dates")});function ze(e=null){const s=oe(),o=J(),a=U(null),{loading:d}=D(s),r=()=>({glNumber:e?.glNumber??"",lineId:e?.lineId??"",layingPlanning:e?.layingPlanning??{},dateRange:e?.dateRange??[]}),{handleSubmit:y,errors:x,isSubmitting:c,resetForm:p,validate:_}=Re({validationSchema:we(Me),initialValues:r()}),u=()=>{p({values:r(),errors:{}})},w=Fe(["glNumber","lineId","layingPlanning","dateRange","glId","dateStart","dateEnd"]),{glId:v,glNumber:L,lineId:B,layingPlanning:R,dateRange:I,dateStart:E,dateEnd:O}=w,G=async()=>{const b=await _();return b.valid?{valid:!0,values:b.values}:{valid:!1}},N=b=>y(b);return K(a,async b=>{if(b){const P=Ce(b);P&&(I.value.push(P[0],P[1]),E.value=P[0],O.value=P[1])}}),K(L,async b=>{const{id:P}=await o.fetchGLNumber(b);console.log(P),v.value=P||0}),{glNumber:L,lineId:B,isLoading:d,layingPlanning:R,dateRangeUnformated:a,errors:x,isSubmitting:c,validateForm:G,onSubmit:N,handleSubmit:y,resetForm:u}}const Ee=["onKeydown"],qe={class:"flex justify-between items-start mb-2"},He={class:"font-bold text-lg flex gap-3"},Ke={class:"text-[14px]"},Ye={class:"text-center"},We={class:"flex flex-col gap-1 text-sm"},Je={class:"flex justify-between"},Xe={class:"text-xs text-teal-700"},Ze={class:"flex justify-between"},et={class:"flex justify-between"},tt={class:"flex flex-col justify-between"},st={class:"flex flex-wrap"},at=M({__name:"GlsLayingPlanning",props:{layingPlanning:{},bgColor:{},rowIndex:{}},emits:["click"],setup(e,{emit:s}){const o=d=>{a("click",d)},a=s;return(d,r)=>{const y=$("n-ellipsis"),x=$("n-card");return f(),F("div",null,[t("div",{role:"button",tabindex:"0",onClick:r[0]||(r[0]=c=>o(e.layingPlanning)),onKeydown:he(le(o,["prevent"]),["enter","space"]),class:"cursor-pointer"},[i(x,{hoverable:"",style:{width:"330px"},"content-class":d.bgColor,"header-class":d.bgColor},{header:h(()=>[t("div",qe,[t("div",He,[t("div",Ke,[i(y,{style:{"max-width":"240px"}},{tooltip:h(()=>[t("div",Ye,S(e.layingPlanning.color),1)]),default:h(()=>[A(S(e.layingPlanning.color)+" ",1)]),_:1})])])]),t("div",We,[t("div",Je,[r[1]||(r[1]=t("p",{class:"font-normal text-xs"},"Type:",-1)),t("p",Xe,S(e.layingPlanning.type),1)]),t("div",Ze,[r[2]||(r[2]=t("p",{class:"text-gray-400 font-normal"}," Order Quantity: ",-1)),A(" "+S(e.layingPlanning.summary.orderQty),1)]),t("div",et,[r[3]||(r[3]=t("p",{class:"text-gray-400 font-normal"}," Cut Quantity: ",-1)),A(" "+S(e.layingPlanning.summary.cutQty),1)])])]),default:h(()=>[t("div",tt,[r[4]||(r[4]=t("p",{class:"text-xs text-gray-400 mb-2"},"Sizes",-1)),t("div",st,[(f(!0),F(Y,null,W(e.layingPlanning.sizeBreakdown,(c,p)=>(f(),V(re,{type:"info",size:"small",tertiary:!0,key:p,"class-content":[p!=e.layingPlanning.sizeBreakdown.length-1?"!mr-2 !mb-2":"!mb-2"]},{default:h(()=>[A(S(c.size),1)]),_:2},1032,["class-content"]))),128))])])]),_:1},8,["content-class","header-class"])],40,Ee)])}}}),nt={class:"flex justify-between items-center border-b-1 border-gray-100 pb-5"},ot={class:"font-bold text-lg flex items-center gap-3"},lt={class:"font-bold !text-blue-700"},rt={class:"flex gap-4 mt-1"},it={class:"flex items-center gap-2"},ct={class:"text-sm text-gray-400 font-normal"},dt={class:"flex items-center gap-2"},ut={class:"text-sm text-gray-400 font-normal"},mt={class:"flex items-center gap-2"},gt={class:"text-sm text-gray-400 font-normal"},ht=M({__name:"GlsSummary",props:{summary:{},lastUpdated:{},rowIndex:{}},setup(e){return(s,o)=>{const a=$("n-avatar"),d=$("n-icon"),r=$("n-card");return f(),V(r,{class:"mb-4"},{header:h(()=>[t("div",nt,[t("div",ot,[i(a,{size:52,color:"#f0f6ff"},{default:h(()=>[t("p",lt,S(s.rowIndex),1)]),_:1}),t("div",null,[t("p",null,"GL-"+S(e.summary.glNumber),1),t("div",rt,[t("div",it,[i(d,null,{default:h(()=>[i(n(Ge))]),_:1}),t("p",ct," Color : "+S(e.summary.layingPlannings.length),1)]),t("div",dt,[i(d,null,{default:h(()=>[i(n(ke))]),_:1}),t("p",ut," Order Quantity :"+S(e.summary.glSummary.orderQty),1)]),t("div",mt,[i(d,null,{default:h(()=>[i(n(Ae))]),_:1}),t("p",gt," Cut Quantity: "+S(e.summary.glSummary.cutQty),1)])])])]),t("div",null,[o[0]||(o[0]=t("p",{class:"text-sm text-gray-400 font-normal"},"Last Updated",-1)),A(" "+S(s.lastUpdated),1)])])]),default:h(()=>[pe(s.$slots,"default")]),_:3})}}});function pt(){const e=z(),s=J(),{search:o,options:a,summaryGl:d,metaSummary:r,loading:y}=D(s),x=u=>{const w=u.slice(3);c(w)},c=async(u,w={notify:!0})=>{const{success:v,message:L}=await s.fetchSummaryGl(u);return w.notify&&(v?e.success(L):e.error(L)),{success:v,message:L}};return{search:o,options:a,summaryGl:d,metaSummary:r,loading:y,handleFetch:async(u={notify:!0})=>{const{success:w,message:v}=await s.fetch();return u.notify&&(w?e.success(v):e.error(v)),{success:w,message:v}},handleFetchSummaryGLNumber:x,handleUpdateSearch:u=>{s.searchOrFetch(u)}}}function ft(){const e=z(),s=J(),{search:o,options:a}=D(s),d=c=>{const p=c.slice(3);r(p)},r=async(c,p={notify:!0})=>{const{success:_,message:u}=await s.fetchSummaryGl(c);return p.notify&&(_?e.success(u):e.error(u)),{success:_,message:u}};return{search:o,options:a,handleFetch:async(c={notify:!0})=>{const{success:p,message:_}=await s.fetch();return c.notify&&(p?e.success(_):e.error(_)),{success:p,message:_}},handleFetchSummaryGLNumber:d,handleUpdateSearch:c=>{s.searchOrFetch(c)}}}const yt=T({id:k().optional(),name:C().min(1,"Line name is required"),createdAt:C().optional(),updatedAt:C().optional()}),_t=ie(yt),vt=T({message:C(),data:_t,links:Te,meta:Ve,status:Ne()}),bt=fe("lines",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:""}),actions:{async fetch(e={}){this.loading=!0,this.error=null;try{const s={page:e.page??1,perPage:e.perPage??50,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};e.q&&(this.searchResult=[],this.isSearching=!0);const o=await ye.get("/api/lines",{params:s}),a=vt.parse(o.data);return this.meta=a.meta,this.links=a.links,this.currentPage=a.meta.currentPage,this.lastPage=a.meta.lastPage,e.q?this.searchResult=a.data:(this.data=a.data,this.isSearching=!1,this.searchResult=[]),ne.parse({success:!0,message:a.message??"lines loaded"})}catch(s){const o=s?.response?.data?.message||"Something went wrong";return this.error=o,ne.parse({success:!1,message:o})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetch(),this.data;const s=this.data.filter(a=>a.name?.toLowerCase().includes(e));return s.length>0?(this.searchResult=s,this.isSearching=!0,s):(await this.fetch({page:1,q:e})).success?this.searchResult:[]}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const s=e.search.toLowerCase();return e.data.filter(o=>o.name?.toLowerCase().includes(s))},options(){return this.searchedItems.map(e=>({value:e.id,label:e.name||""}))}}});function St(){const e=z(),s=bt(),{search:o,options:a}=D(s);return{search:o,options:a,handleFetch:async(y={notify:!0})=>{const{success:x,message:c}=await s.fetch();return y.notify&&(x?e.success(c):e.error(c)),{success:x,message:c}},handleUpdateSearch:y=>{s.searchOrFetch(y)}}}const xt={class:"flex flex-col gap-5"},wt={class:"flex flex-wrap gap-4 mb-4 items-center justify-between"},Lt={class:"flex items-start gap-4"},Pt={class:"space-y-2"},Ft={key:0,class:"ml-4 mt-2 border-l border-gray-300"},Ct={class:"relative pl-6 flex items-center gap-2"},$t={key:0,class:"w-1/6"},Nt={class:"flex flex-wrap gap-2 mt-4"},Rt=M({__name:"AssignmentLinesForm",setup(e){const s=Se(),o=_e(),{options:a,handleFetch:d,handleUpdateSearch:r}=St(),{options:y,handleFetch:x,handleUpdateSearch:c,handleFetchSummaryGLNumber:p}=ft(),{summaryGl:_,metaSummary:u,loading:w}=pt(),{glNumber:v,lineId:L,layingPlanning:B,errors:R,dateRangeUnformated:I,onSubmit:E}=ze(),O=oe(),G=U(null),N=U(""),b=z(),P=m=>{G.value=m,B.value={id:m.id,color:m.color,type:m.type,summary:m.summary}},X=E(async m=>{o.success({title:"Confirmation Create Line Assignment",content:"Are you sure you want to create this record? Please review the details before proceeding.",positiveText:"Create",negativeText:"Cancel",draggable:!0,onPositiveClick:async()=>{const{success:l,message:j}=await O.create(m);l?b.success(j):b.error(j)}})}),ce=m=>{G.value=null,B.value={id:void 0,color:"",type:"BODY",summary:{orderQty:0,cutQty:0}},p(m)},Z=ve(()=>N.value?_.value.map(m=>({...m,layingPlannings:m.layingPlannings.filter(l=>l.color.toLowerCase().includes(N.value.toLowerCase())||l.type.toLowerCase().includes(N.value.toLowerCase()))})):_.value);be(async()=>{await d({notify:!1}),await x({notify:!1})});const Q=U(!1);return K(()=>O.loading,m=>{m?Q.value=!0:setTimeout(()=>{Q.value=!1,G.value=null,s.push({name:"assignment-lines"})},500)}),(m,l)=>{const j=$("n-date-picker"),de=$("n-alert"),ue=$("n-spin"),ee=$("n-empty");return f(),F("div",xt,[t("form",{onSubmit:l[4]||(l[4]=le((...g)=>n(X)&&n(X)(...g),["prevent"]))},[i(ue,{size:"medium",class:"mt-6",description:"Please Wait, Loading your selected data",show:n(w)},{default:h(()=>[t("div",wt,[t("div",Lt,[t("ul",Pt,[t("li",null,[i(ae,{modelValue:n(v),"onUpdate:modelValue":l[0]||(l[0]=g=>H(v)?v.value=g:null),name:"glNumber",options:n(y),errors:n(R),multiple:!1,onChange:ce,onSearch:n(c),label:"GL Number"},null,8,["modelValue","options","errors","onSearch"]),n(_).length>0?(f(),F("ul",Ft,[t("li",Ct,[l[6]||(l[6]=t("span",{class:"absolute left-0 top-1/2 w-6 border-t border-gray-300"},null,-1)),i(Le,{modelValue:N.value,"onUpdate:modelValue":l[1]||(l[1]=g=>N.value=g),name:"searchLayingPlanning",placeholder:"Search by Color or Type",style:{width:"250px"},icon:n(Ie)},null,8,["modelValue","icon"])])])):q("",!0)])]),i(ae,{modelValue:n(L),"onUpdate:modelValue":l[2]||(l[2]=g=>H(L)?L.value=g:null),name:"lineId",options:n(a),multiple:!1,errors:n(R),label:"Line Name",onSearch:n(r)},null,8,["modelValue","options","errors","onSearch"]),t("div",null,[l[7]||(l[7]=t("label",{for:"dateRange",class:"font-bold"},"Start - End Date",-1)),i(j,{id:"dateRange",status:n(R).dateRange?"error":"",value:n(I),"onUpdate:value":l[3]||(l[3]=g=>H(I)?I.value=g:null),type:"daterange",clearable:""},null,8,["status","value"])]),i(re,{label:"Save Assignments",type:"success","class-content":"!mt-6",icon:n(Be),"icon-placement":"right","attr-type":"submit"},null,8,["icon"])]),n(R).layingPlanning?(f(),F("div",$t,[i(de,{type:"error"},{default:h(()=>[...l[8]||(l[8]=[A(" Please select a color from the list. ",-1)])]),_:1})])):q("",!0)])]),_:1},8,["show"]),Z.value.length===0?(f(),V(ee,{key:0,description:"GL Number Not Selected",class:"mt-10"})):(f(!0),F(Y,{key:1},W(Z.value,(g,me)=>(f(),F("div",null,[i(ht,{summary:g,"row-index":me+1,"last-updated":n(u).lastUpdated},{default:h(()=>[g.layingPlannings.length===0?(f(),V(ee,{key:0,description:`No results found for ${N.value}`},{icon:h(()=>[i(n(Ue),{class:"!text-6xl !text-gray-300"})]),_:1},8,["description"])):q("",!0),t("div",Nt,[(f(!0),F(Y,null,W(g.layingPlannings,(te,se)=>(f(),V(at,{key:se,"laying-planning":te,"bg-color":G.value==te?"bg-teal-50":"","row-index":se+1,onClick:P},null,8,["laying-planning","bg-color","row-index"]))),128))])]),_:2},1032,["summary","row-index","last-updated"])]))),256))],32),i(Pe,{show:Q.value,"onUpdate:show":l[5]||(l[5]=g=>Q.value=g),title:"Processing Assignment Lines",description:"Please wait while we process your request.",error:!1},null,8,["show"])])}}}),Gt=Oe(Rt,[["__scopeId","data-v-8cec405b"]]),kt={class:"flex flex-col gap-10"},At={class:"bg-gray-50 p-5 rounded-md"},ns=M({__name:"AssignmentLinesFormView",setup(e){const s=U({title:"Assignment Lines Form",description:"Create a new assignment between a line and GL."});return xe({title:s.value.title,meta:[{name:"description",content:s.value.description}]}),(o,a)=>(f(),F("div",kt,[t("div",At,[i(ge,{title:s.value.title,description:s.value.description,breadcrumbs:[{label:"Home",icon:n(Qe),to:"/"},{label:s.value.title,icon:n(je),to:{name:"assignment-lines"}},{label:"Form",icon:n(De)}]},null,8,["title","description","breadcrumbs"])]),i(Gt)]))}});export{ns as default};
