import{_ as W}from"./BaseButton.vue_vue_type_script_setup_true_lang-BJSFg9X6.js";import{_ as h}from"./BaseIconWithLabel.vue_vue_type_script_setup_true_lang-CpSPTeej.js";import{c as V,C as M,P as I,a as U,T as E,b as Q,I as J}from"./IosSync-2kF7M5sO.js";import{d as D,c,o as l,e as s,g as d,p as K,r as P,s as X,k as j,l as R,w as u,F as L,H as S,f as y,a as e,L as H,t as m,G as Y,x as q}from"./index-BXp2mkfJ.js";import{u as Z}from"./replacement.store-BjhZBmQ0.js";import{C as ee,F as O}from"./FolderPerson16Regular-B57rWPpN.js";import{B as te}from"./BrandAirtable-CM7KBFW2.js";import{H as se}from"./History-BJw_yOTh.js";const le=D({__name:"ProfileHeader",props:{email:{}},setup(_){return(t,n)=>(l(),c("div",null,[s(h,{icon:d(V),size:24,label:t.email},null,8,["icon","label"])]))}});function ae(){const _=K(),t=Z(),n=P(!1),o=P(""),z=P(null),w=P([]),{replacementList:x,remoteSearchResult:$,meta:a,links:r}=X(t),T=j(()=>o.value?$.value??k.value:k.value),k=j(()=>{const p=o.value?.toLowerCase();return p?x.value.filter(g=>{const b=g.glNo?.toLowerCase().includes(p),f=g.serialNumber?.toLowerCase().includes(p),C=g.defectList?.some(F=>F.color?.toLowerCase().includes(p));return b||f||C}):x.value}),B=async(p=!1,g)=>{n.value=!0;const b=Date.now(),{success:f,message:C}=await t.fetchReplacementListPagination(g),F=Date.now()-b,N=400;return F<N&&await new Promise(G=>setTimeout(G,N-F)),p&&(f?_.success(C):_.error(C)),n.value=!1,{success:f,message:C}},A=async()=>{if(!o.value.trim()){t.clearRemoteSearchResult();return}k.value.length>0||await B(!1,{search:o.value})},i=p=>{z.value=k.value[p]},v=async(p=!1,g)=>{n.value=!0;const{success:b,message:f}=await t.fetchReplacementApprovalPagination(g);return p&&(b?_.success(f):_.error(f)),n.value=!1,{success:b,message:f}};return{selectedReplacementItem:z,isLoading:n,meta:a,links:r,searchReplacementList:o,replacementListFilter:T,replacementList:x,timelineHistories:w,handleFetchReplacementListPagination:B,handleSearchReplacementList:A,selectReplacementItem:i,handleFetchReplacementApprovalPagination:v,handleSearchReplacementApprovalList:async()=>{if(!o.value.trim()){t.clearRemoteSearchResult();return}k.value.length>0||await v(!1,{search:o.value})},handleFetchHistoriesByReplacementId:async(p=!1,g)=>{n.value=!0;const{success:b,message:f,data:C}=await t.fetchHistoriesByReplacementId(g);return p&&(b?_.success(f):_.error(f)),n.value=!1,w.value=C,{success:b,message:f}}}}const ne={class:"px-4"},oe={class:"flex flex-col"},re={key:0,class:"flex flex-col gap-2"},ie={key:1,class:"flex flex-col gap-2"},ce={class:"flex justify-between"},de={class:"flex gap-2 items-center text-sm text-gray-400"},ue={class:"flex"},me={class:"flex flex-col"},pe={class:"flex flex-col gap-2"},fe=D({__name:"WorkflowTimeline",props:{workflow:{},currentStep:{},isLoading:{type:Boolean,default:!0},statusTicket:{default:"In Progress"}},setup(_){const t=_,n=o=>o.isApproved&&t.currentStep>o.stepOrder?{type:"success",title:"Approved",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!0,titleClass:"font-semibold text-black",roleClass:"text-sm text-black"}:o.isFinal&&o.stepOrder===t.currentStep?{type:"success",title:"Completed",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!1,titleClass:"font-semibold text-black",roleClass:"text-sm text-orange-400"}:o.stepOrder===t.currentStep&&t.statusTicket==="In Progress"?{type:"warning",title:"Progress",class:"inline-flex px-2 py-0.5 items-center bg-yellow-100",done:!1,titleClass:"font-semibold text-orange-400",roleClass:"text-sm text-orange-400"}:o.stepOrder===t.currentStep&&t.statusTicket==="Rejected"?{type:"error",title:"Rejected",class:"inline-flex px-2 py-0.5 items-center bg-red-100",done:!1,titleClass:"font-semibold text-red-400",roleClass:"text-sm text-red-400"}:{type:"Waiting",title:"Waiting",class:"inline-flex px-2 py-0.5 items-center bg-gray-100",done:!1,titleClass:"font-regular text-gray-400",roleClass:"text-sm text-gray-400"};return(o,z)=>{const w=y("n-icon"),x=y("n-skeleton"),$=y("n-timeline-item"),a=y("n-timeline");return l(),c("div",ne,[t.isLoading?(l(),R(a,{key:1},{default:u(()=>[(l(),c(L,null,S(6,(r,T)=>s($,{key:r},{icon:u(()=>[s(w,{size:22},{default:u(()=>[s(d(I))]),_:1})]),default:u(()=>[e("div",me,[e("div",pe,[s(x,{width:"40%",text:""}),s(x,{width:"15%",text:""}),s(x,{width:"5%",text:""})])])]),_:2},1024)),64))]),_:1})):(l(),R(a,{key:0},{default:u(()=>[(l(!0),c(L,null,S(t.workflow,r=>(l(),R($,{key:r.stepOrder,type:n(r).type},{icon:u(()=>[s(w,{size:22},{default:u(()=>[n(r).done?(l(),R(d(M),{key:0})):(l(),R(d(I),{key:1}))]),_:2},1024)]),default:u(()=>[e("div",oe,[t.isLoading?(l(),c("div",re,[s(x,{width:"30%",text:""}),s(x,{width:"10%",text:""})])):(l(),c("div",ie,[e("div",ce,[e("p",{class:H(n(r).titleClass)},m(r.workflowName),3)]),e("div",de,[s(h,{icon:d(ee),label:r.createdAt??"-",size:14},null,8,["icon","label"]),s(h,{icon:d(O),label:r.createdBy,size:16},null,8,["icon","label"])]),e("div",ue,[e("div",{class:H(["text-xs text-gray-500",n(r).class])},m(n(r).title),3)])]))])]),_:2},1032,["type"]))),128))]),_:1}))])}}}),_e={class:"flex flex-col gap-5"},xe={class:"flex justify-between"},ge={class:"flex flex-col gap-1"},be={class:"text-xl font-bold"},he={class:"flex gap-2"},ye={class:"text-sm"},ve={class:"text-sm"},we={class:"flex items-center gap-2"},ke={class:"text-sm"},Ce={class:"flex gap-5 justify-between items-center"},Re={class:"flex gap-5 items-center"},Le=["colspan"],Se={class:"!text-center !bg-white"},ze={class:"!text-center !text-red-400"},$e={class:"!text-center !font-bold !text-red-400"},Pe={class:"flex flex-col text-xs gap-1"},Te={class:"text-gray-400"},Be={class:"mt-2"},Fe={key:1,class:"text-gray-400"},Ve=D({__name:"ReplacementTicketDetail",props:{data:{},isLoading:{type:Boolean,default:!1}},setup(_){const t=_,n=P(!1),{timelineHistories:o,isLoading:z,handleFetchHistoriesByReplacementId:w}=ae(),x=async()=>{n.value=!0,w(!1,t.data.id)};return($,a)=>{const r=y("n-card"),T=y("n-table"),k=y("n-blockquote"),B=y("n-scrollbar"),A=y("n-modal");return l(),c("div",null,[s(r,{class:"shadow-xs"},{default:u(()=>[e("div",_e,[e("div",xe,[e("div",ge,[e("p",be,"GL-"+m(t.data.glNo),1),e("div",he,[e("div",{class:"shadow-sm border border-gray-200 rounded",style:Y({background:t.data.workflow?.color,padding:"4px 8px",borderRadius:"3px"})},[e("p",ye," Location : "+m(t.data.workflow?.current),1)],4),e("div",{class:H(["shadow-sm border border-gray-300  rounded px-2 py-0.5 items-center inline-flex",t.data.status.class])},[e("p",ve," Status : "+m(t.data.status.name),1)],2)])]),e("div",we,[e("table",ke,[e("tr",null,[e("td",null,[s(h,{icon:d(O),label:"Requested by",size:20},null,8,["icon"])]),a[1]||(a[1]=e("td",null,"  :  ",-1)),e("td",null,m(t.data.requestedBy),1)]),e("tr",null,[e("td",null,[s(h,{icon:d(U),label:"Requested Date",size:20},null,8,["icon"])]),a[2]||(a[2]=e("td",null,"  :  ",-1)),e("td",null,m(t.data.createdAt),1)])])])]),e("div",null,[s(r,{class:"shadow-xs border !border-gray-200"},{default:u(()=>[e("div",Ce,[e("div",Re,[s(h,{icon:d(te),label:`Line ${t.data.lineNames.join(",")}`,size:20,labelClass:"text-sm text-black font-semibold"},null,8,["icon","label"]),s(h,{icon:d(E),label:`Total Sizes : ${t.data.totalSize}`,size:20,labelClass:"text-sm text-black font-semibold"},null,8,["icon","label"]),s(h,{icon:d(Q),label:`Total Defect : ${t.data.defectTotal}`,size:19,labelClass:"text-sm text-red-400 font-semibold"},null,8,["icon","label"]),s(W,{icon:d(se),label:"Process History",size:"small",onClick:x},null,8,["icon"])]),e("div",null,[s(h,{icon:d(J),label:`Last Updated : ${t.data.updatedAt}`,size:19,labelClass:"text-sm italic text-gray-400"},null,8,["icon","label"])])])]),_:1})]),e("div",{class:H([t.data.defectList.length>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":"grid grid-cols-1 gap-4","bg-gray-50 border border-gray-200 rounded-lg p-2"])},[(l(!0),c(L,null,S(t.data.defectList,i=>(l(),c("div",{key:i.color,class:"!w-full !min-w-0"},[s(T,{class:"!border !border-gray-200 !w-full"},{default:u(()=>[e("thead",null,[e("tr",null,[a[3]||(a[3]=e("th",{class:"!bg-white"},"Color",-1)),e("th",{colspan:(i.sizeList.length??0)+1,class:"!text-center !bg-white !text-blue-600 !font-semibold"},m(i.color),9,Le)]),e("tr",null,[a[4]||(a[4]=e("th",{class:"!bg-white"},"Size",-1)),(l(!0),c(L,null,S(i.sizeList,v=>(l(),c("th",Se,m(v.size),1))),256)),a[5]||(a[5]=e("th",{class:"!bg-white !text-center"},"Total",-1))])]),e("tbody",null,[e("tr",null,[a[6]||(a[6]=e("td",null,"Defect",-1)),(l(!0),c(L,null,S(i.sizeList,v=>(l(),c("td",ze,m(v.defectQty),1))),256)),e("td",$e,m(i.totalDefect),1)])])]),_:2},1024)]))),128))],2),e("div",null,[s(B,{style:{"max-height":"350px"}},{default:u(()=>[a[7]||(a[7]=e("p",{class:"font-semibold mb-5"},"Notes",-1)),(l(!0),c(L,null,S(t.data.notes,(i,v)=>(l(),c("div",null,[i.note?(l(),R(k,{key:0},{default:u(()=>[e("div",Pe,[s(le,{email:i.createdBy},null,8,["email"]),e("p",Te,m(i.createdAt),1)]),e("p",Be,m(i.note),1)]),_:2},1024)):q("",!0),v==t.data.notes.length-1&&i.note==null?(l(),c("p",Fe," Notes are not available for this request. ")):q("",!0)]))),256))]),_:1})])])]),_:1}),s(A,{show:n.value,"onUpdate:show":a[0]||(a[0]=i=>n.value=i),preset:"card",style:"width: 600px",title:`GL-${t.data.glNo?.toString()}`},{default:u(()=>[s(fe,{workflow:d(o),currentStep:t.data.currentStep,isLoading:d(z),statusTicket:t.data.status.name},null,8,["workflow","currentStep","isLoading","statusTicket"])]),_:1},8,["show","title"])])}}});export{Ve as _,ae as u};
