import{_ as I}from"./BaseButton.vue_vue_type_script_setup_true_lang-Qhf6FCwo.js";import{d as T,k as H,c as h,o as g,x as Z,e as n,t as d,g as u,W as de,L as ae,w as v,l as j,m as M,f as A,E as O,D as ue,p as se,r as $,s as me,y as ne,a as e,n as W,F as k,H as F,v as ce}from"./index-Bxx76-Ez.js";import{A as pe}from"./AlertOutline-C1SYgRYP.js";import{u as ge}from"./useFieldWrapper-y8bl-FVg.js";import{o as K,c as le,a as z,n as N,s as C}from"./types-CVZIcfwR.js";import{A as R}from"./api.schema-B7NsqcGR.js";import{c as fe}from"./defect.summaryApi-CUJMEH2X.js";import{u as ve}from"./line.page-SJrtut57.js";import{u as ye}from"./user.table-Dd_PomV0.js";import{t as be}from"./vee-validate-zod-CaeLnshz.js";import{u as _e}from"./vee-validate-Bw-R3irC.js";import{S as he,T as Le,P as xe}from"./Trash-DNQjnX1Z.js";import{_ as we}from"./BaseInput.vue_vue_type_script_setup_true_lang-CZVjUVtR.js";import{S as Ae}from"./SearchOutline-DbSgM3Sm.js";import{R as Se}from"./RefreshRound-BXdsfRd4.js";import{C as oe}from"./ChartPerson20Filled-pJ1HWK9K.js";import{F as Ue}from"./FolderDetailsReference-0aT-PUMs.js";import{S as Be}from"./SmartHome-CQ7QgFdK.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./stockin.api.schema-DC3-uBMr.js";import"./metaPagination-9MSE0uSw.js";import"./dateRangeFormaterNaive-ClR-GZjc.js";import"./user.store-Bb_Wos0L.js";import"./user.schema-BXMI3HnA.js";import"./employeeSchema-AqYtwcrb.js";const Ce={class:"flex flex-col gap-1"},$e=["status","for"],ee=T({__name:"BaseSelectWithError",props:{modelValue:{},options:{},placeholder:{default:"Select option"},clearable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},size:{default:"medium"},icon:{default:null},errors:{},label:{},name:{},multiple:{type:Boolean,default:!1},classContent:{}},emits:["update:modelValue"],setup(s,{emit:l}){const t=s,o=l,m=H(()=>t.errors?.[t.name]),p=H(()=>m.value?"error":void 0);return(r,c)=>{const L=A("n-icon"),y=A("n-tooltip");return g(),h("div",Ce,[r.label?(g(),h("label",{key:0,status:p.value,for:t.name,class:"text-sm font-medium text-gray-700"},d(r.label),9,$e)):Z("",!0),n(u(de),{id:t.name,value:t.modelValue,options:t.options,multiple:t.multiple,placeholder:t.placeholder,clearable:t.clearable,filterable:t.filterable,size:t.size,"onUpdate:value":c[0]||(c[0]=a=>o("update:modelValue",a)),class:ae([t.classContent,"!min-w-[200px]"]),"max-tag-count":t.multiple?0:void 0,"render-tag":t.multiple?()=>null:void 0},{arrow:v(()=>[m.value?(g(),j(y,{key:0,show:!!m.value,trigger:"hover"},{trigger:v(()=>[n(L,{component:u(pe),color:"red"},null,8,["component"])]),default:v(()=>[M(" "+d(m.value),1)]),_:1},8,["show"])):Z("",!0)]),_:1},8,["id","value","options","multiple","placeholder","clearable","filterable","size","class","max-tag-count","render-tag"])])}}}),De=K({userId:N().nullable().refine(s=>s!==null,"Leader is required").transform(s=>s),lineId:z(N()).min(1,"Leader is required"),isActive:le()}),G="/api",J={getAssignments:()=>O.get(`${G}/leaders`).then(s=>s.data),createAssign:s=>O.post(`${G}/leaders/assign`,s).then(l=>l.data),createUnassign:s=>O.post(`${G}/leaders/unassign`,s).then(l=>l.data)},te=K({assignId:N(),assignAt:C(),unassignAt:C().nullable(),lineId:N().nullable(),lineName:C().nullable(),createdBy:C(),updatedBy:C().nullable(),lastUpdated:C()}),ke=K({leader:C(),leaderId:N(),isActive:le(),activeLines:C(),activeLineIds:C(),lastUpdated:C().nullable(),activeDetail:z(te),inactiveDetail:z(te)}),Fe=fe(z(ke)),ie=ue("leaderStore",{state:()=>({loading:!1,error:null,AssignmentSummaryByLeader:[]}),actions:{async fetchSummaryByLeader(){this.loading=!0,this.error=null;try{const s=await J.getAssignments(),l=Fe.parse(s);return this.AssignmentSummaryByLeader=l.data,R.parse({success:!0,message:l.message??"loaded"})}catch(s){const l=s?.response?.data?.message||"Something went wrong";return this.error=l,R.parse({success:!1,message:l})}finally{this.loading=!1}},async createAssignLeader(s){try{const l=await J.createAssign(s);return R.parse({success:!0,message:l.message??"Created",data:l.data})}catch(l){const t=l?.response?.data?.message||"Something went wrong";return this.error=t,R.parse({success:!1,message:t})}finally{this.loading=!1}},async unAssignLeader(s){try{const l=await J.createUnassign(s);return R.parse({success:!0,message:l.message??"Created",data:l.data})}catch(l){const t=l?.response?.data?.message||"Something went wrong";return this.error=t,R.parse({success:!1,message:t})}finally{this.loading=!1}}}});function Q(s=null){const l=se(),t=ie(),o=$(!1),{rows:m,handleFetch:p}=ye(),{data:r,handleFetch:c}=ve(),L=H(()=>m.value.map(S=>({label:S.name,value:S.id}))),y=H(()=>r.value.map(S=>({label:S.name,value:S.id}))),a=async S=>{o.value=!0,await t.createAssignLeader(S),o.value=!1},B=async S=>{o.value=!0;const{success:re,message:Y}=await t.unAssignLeader(S);re?l.success(Y):l.error(Y),o.value=!1},f=async()=>{await Promise.all([p(),c({notify:!1},{})])},b=()=>({userId:s?.userId??null,lineId:s?.lineId??[],isActive:s?.isActive??!0}),{handleSubmit:x,errors:i,isSubmitting:V,resetForm:w,validate:D}=_e({validationSchema:be(De),initialValues:b()}),{userId:_,lineId:q,isActive:E}=ge(["userId","lineId","isActive"]);return{isLoading:o,userId:_,lineId:q,isActive:E,optionUsers:L,optionLines:y,handleUserLineData:f,onSubmit:x,resetForm:()=>{w({values:b(),errors:{}})},errors:i,isSubmitting:V,validateForm:async()=>{const S=await D();return S.valid?{valid:!0,values:S.values}:{valid:!1}},handleCreateAssignLeader:a,handleUnassignLeader:B}}function P(){const s=se(),l=ie(),t=$(!1),{loading:o,AssignmentSummaryByLeader:m}=me(l);return{leaderPiniaLoading:o,isLoading:t,AssignmentSummaryByLeader:m,fetchSummaryByLeader:async(r={notify:!0})=>{const{success:c,message:L}=await l.fetchSummaryByLeader();return r.notify&&(c?s.success(L):s.error(L)),{success:c,message:L}}}}const Ie={class:"flex flex-col gap-5"},Ve={class:"flex gap-2 items-end"},Re={class:"flex flex-col"},Te={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},He={class:"flex gap-2 flex-wrap mt-2"},Me={class:"flex gap-2 justify-end"},Ne=T({__name:"LeaderAssignmentForm",props:{modal:{type:Boolean},initialData:{}},emits:["update:modal"],setup(s,{emit:l}){const t=s,{isLoading:o,userId:m,lineId:p,isActive:r,optionLines:c,optionUsers:L,onSubmit:y,errors:a,resetForm:B,handleUserLineData:f,handleCreateAssignLeader:b}=Q(t.initialData),{fetchSummaryByLeader:x}=P(),i=y(async D=>{await b(D),await x(),w(!1)}),V=l,w=D=>{V("update:modal",D)};return ne(async()=>{await f()}),(D,_)=>{const q=A("n-switch"),E=A("n-tag");return g(),h("div",null,[e("form",{onSubmit:_[3]||(_[3]=ce((...U)=>u(i)&&u(i)(...U),["prevent"]))},[e("div",Ie,[_[6]||(_[6]=e("div",{class:"mb-5"},[e("p",{class:"text-xl font-semibold"},"Leader Assignment Form"),e("p",null,"A dedicated form interface for assigning leaders to specific production lines.")],-1)),e("div",Ve,[n(ee,{name:"userId",options:u(L),label:"Leaders",modelValue:u(m),"onUpdate:modelValue":_[0]||(_[0]=U=>W(m)?m.value=U:null),placeholder:"Select Leader",errors:u(a)},null,8,["options","modelValue","errors"]),n(ee,{name:"lineId",options:u(c),multiple:"",label:"Lines",modelValue:u(p),"onUpdate:modelValue":_[1]||(_[1]=U=>W(p)?p.value=U:null),placeholder:"Select Lines",errors:u(a)},null,8,["options","modelValue","errors"]),e("div",Re,[_[4]||(_[4]=e("label",{id:"isActive",class:"mb-2 font-semibold"},"Is Active",-1)),n(q,{round:!1,size:"large",value:u(r),"onUpdate:value":_[2]||(_[2]=U=>W(r)?r.value=U:null)},null,8,["value"])])]),e("div",Te,[_[5]||(_[5]=e("p",{class:"text-xs text-gray-400"},"Selected Lines",-1)),e("div",He,[(g(!0),h(k,null,F(u(p),U=>(g(),j(E,{key:U,size:"small",type:"info",round:""},{default:v(()=>[M(d(u(c).find(X=>X.value===U)?.label),1)]),_:2},1024))),128))])]),e("div",Me,[n(I,{label:"Reset",onClick:u(B),type:"error",quaternary:""},null,8,["onClick"]),n(I,{label:"Assign Leader",icon:u(he),"icon-placement":"right",loading:u(o),type:"primary",attrType:"submit"},null,8,["icon","loading"])])])],32)])}}}),Pe={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},ze={class:"text-lg font-semibold mb-2"},je={class:"flex gap-2 mb-5"},qe=T({__name:"LeaderAssignmentHistory",props:{initialData:{},modal:{type:Boolean}},emits:["update:modal"],setup(s,{emit:l}){return $(null),Q(),P(),(t,o)=>{const m=I,p=A("n-table");return g(),h("div",null,[e("div",Pe,[o[3]||(o[3]=e("p",{class:"text-gray-400 font-semibold"},"Leader Name",-1)),e("p",ze,d(s.initialData?.leader.toUpperCase()),1),e("div",je,[(g(!0),h(k,null,F(s.initialData?.activeLines.split(","),r=>(g(),j(m,{label:r,classContent:"!bg-green-200"},null,8,["label"]))),256))]),o[4]||(o[4]=e("p",{class:"text-xs font-semibold text-gray-400 mb-3"},"History Assignments",-1)),n(p,null,{default:v(()=>[o[2]||(o[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Line"),e("th",null,"Assign At"),e("th",null,"Unassign At"),e("th",null,"Created By"),e("th",null,"Updated By"),e("th",{class:"!text-center"},"Active"),e("th",null,"Last Updated")])],-1)),e("tbody",null,[(g(!0),h(k,null,F(s.initialData?.activeDetail,(r,c)=>(g(),h("tr",null,[e("td",null,d(c+1),1),e("td",null,d(r.lineName),1),e("td",null,d(r.assignAt),1),e("td",null,d(r.unassignAt??"-"),1),e("td",null,d(r.createdBy),1),e("td",null,d(r.updatedBy??"-"),1),o[0]||(o[0]=e("td",{class:"!bg-green-200 !text-center"},"Active",-1)),e("td",null,d(r.lastUpdated),1)]))),256)),(g(!0),h(k,null,F(s.initialData?.inactiveDetail,(r,c)=>(g(),h("tr",null,[e("td",null,d(c+1),1),e("td",null,d(r.lineName),1),e("td",null,d(r.assignAt),1),e("td",null,d(r.unassignAt??"-"),1),e("td",null,d(r.createdBy),1),e("td",null,d(r.updatedBy??"-"),1),o[1]||(o[1]=e("td",{class:"!bg-red-200 !text-center"},"Inactive",-1)),e("td",null,d(r.lastUpdated),1)]))),256))])]),_:1})])])}}}),Ee={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Oe={class:"text-lg font-semibold mb-2"},We=T({__name:"LeaderUnassignmentForm",props:{initialData:{},modal:{type:Boolean}},emits:["update:modal"],setup(s,{emit:l}){const t=l,o=$(null),{isLoading:m,handleUnassignLeader:p}=Q(),{fetchSummaryByLeader:r}=P(),c=y=>{t("update:modal",y)},L=async(y,a)=>{o.value=y,await p({id:a}),s.initialData?.activeDetail.splice(y,1),o.value=null,await r(),c(!1)};return(y,a)=>{const B=A("n-divider"),f=A("n-list-item"),b=A("n-list");return g(),h("div",null,[e("div",Ee,[e("p",Oe,d(s.initialData?.leader),1),a[0]||(a[0]=e("p",{class:"text-xs font-semibold text-gray-400"},"Assignment Lines",-1)),n(B,{dashed:"",class:"!my-[10px]"}),n(b,{bordered:""},{default:v(()=>[(g(!0),h(k,null,F(s.initialData?.activeDetail,(x,i)=>(g(),j(f,{class:ae((i===o.value,"dimmed"))},{suffix:v(()=>[n(I,{label:"unassign line",size:"small",icon:u(Le),type:"error",loading:u(m)&&i==o.value,onClick:V=>L(i,x.assignId),disabled:i==o.value},null,8,["icon","loading","onClick","disabled"])]),default:v(()=>[M(d(x?.lineName)+" ",1)]),_:2},1032,["class"]))),256))]),_:1})])])}}}),Ge={class:"flex flex-col gap-5"},Je={class:"flex justify-between"},Ke={class:"!w-[300px]"},Qe={class:"flex gap-3 items-center"},Xe={class:"flex gap-2"},Ye=T({__name:"SummaryLeaderTable",props:{modal:{type:Boolean}},emits:["click:unassignLine","click:assignHistory","update:modal"],setup(s,{emit:l}){const t=$(""),o=H(()=>{const f=t.value.toLowerCase().trim();return f?(p.value||[]).filter(b=>b.leader?.toLowerCase().includes(f)||b.activeLines?.toLowerCase().includes(f)):p.value||[]}),{leaderPiniaLoading:m,AssignmentSummaryByLeader:p,fetchSummaryByLeader:r}=P(),c=l,L=async()=>{await r()},y=async f=>{c("click:unassignLine",f)},a=f=>{c("update:modal",f)},B=f=>{c("click:assignHistory",f)};return(f,b)=>{const x=I,i=A("n-skeleton"),V=A("n-table");return g(),h("div",Ge,[e("div",Je,[e("div",Ke,[n(we,{icon:u(Ae),placeholder:"Search",modelValue:t.value,"onUpdate:modelValue":b[0]||(b[0]=w=>t.value=w)},null,8,["icon","modelValue"])]),e("div",Qe,[n(x,{label:"Refresh",icon:u(Se),onClick:L},null,8,["icon"]),n(x,{label:"Create Leader Assignment",icon:u(oe),onClick:b[1]||(b[1]=w=>a(!0)),type:"primary"},null,8,["icon"])])]),n(V,null,{default:v(()=>[b[2]||(b[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Leader"),e("th",null,"Line Assignments"),e("th",null,"Last Updated"),e("th",null,"Status")])],-1)),e("tbody",null,[u(m)?(g(),h(k,{key:0},F(10,w=>e("tr",{key:w},[e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})]),e("td",null,[n(i,{text:""})])])),64)):(g(!0),h(k,{key:1},F(o.value,(w,D)=>(g(),h("tr",{key:D},[e("td",null,d(D+1),1),e("td",null,d(w.leader),1),e("td",null,d(w.activeLines),1),e("td",null,d(w.lastUpdated),1),e("td",Xe,[n(x,{label:"Detail",icon:u(Ue),onClick:_=>B(w),tertiary:""},null,8,["icon","onClick"]),n(x,{label:"Unasssign Line",icon:u(xe),tertiary:"",type:"error",onClick:_=>y(w)},null,8,["icon","onClick"])])]))),128))])]),_:1})])}}}),Ze={class:"flex flex-col gap-10"},et={class:"flex justify-between items-center"},tt={class:"w-84 flex-auto"},at={class:"text-xl font-bold mb-1"},st={class:"w-16 flex-auto text-right"},nt={class:"flex justify-end"},lt={class:"flex justify-end"},Ft=T({__name:"LeadersPageView",setup(s){const l=$({title:"Leader Management Module",description:"A centralized interface enabling users to view, create, and maintain leader records assigned across multiple production lines. The module streamlines oversight, improves data governance, and ensures operational visibility by providing a structured workflow for leader placement and line assignments."}),t=$(!1),o=$(!1),m=$(!1),p=$(),{fetchSummaryByLeader:r}=P(),c=y=>{p.value=y,o.value=!0},L=y=>{p.value=y,m.value=!0};return ne(async()=>{await r()}),(y,a)=>{const B=A("n-icon"),f=A("n-breadcrumb-item"),b=A("n-breadcrumb"),x=A("n-modal");return g(),h("div",Ze,[e("div",et,[e("div",tt,[e("h2",at,d(l.value.title),1),e("p",null,d(l.value.description),1)]),e("div",st,[n(b,null,{default:v(()=>[n(f,null,{default:v(()=>[n(B,{component:u(Be)},null,8,["component"]),a[9]||(a[9]=M(" Home",-1))]),_:1}),n(f,null,{default:v(()=>[n(B,{component:u(oe)},null,8,["component"]),a[10]||(a[10]=M(" Leaders ",-1))]),_:1})]),_:1})])]),n(Ye,{"onClick:unassignLine":c,modal:t.value,"onUpdate:modal":a[0]||(a[0]=i=>t.value=i),modalDetail:m.value,"onUpdate:modalDetail":a[1]||(a[1]=i=>m.value=i),"onClick:assignHistory":L},null,8,["modal","modalDetail"]),n(x,{show:t.value,"onUpdate:show":a[3]||(a[3]=i=>t.value=i),preset:"card",style:"width: 1200px"},{default:v(()=>[n(Ne,{modal:t.value,"onUpdate:modal":a[2]||(a[2]=i=>t.value=i)},null,8,["modal"])]),_:1},8,["show"]),n(x,{show:o.value,"onUpdate:show":a[6]||(a[6]=i=>o.value=i),preset:"card",style:"width: 1200px"},{header:v(()=>[...a[11]||(a[11]=[e("p",null,"Leader Unassignment",-1),e("p",{class:"text-sm font-normal"},"An operational interface for removing a leader from a designated production line.",-1)])]),footer:v(()=>[e("div",nt,[n(I,{label:"Close",type:"primary",tertiary:"",onClick:a[4]||(a[4]=i=>o.value=!1)})])]),default:v(()=>[n(We,{initialData:p.value,modal:o.value,"onUpdate:modal":a[5]||(a[5]=i=>o.value=i)},null,8,["initialData","modal"])]),_:1},8,["show"]),n(x,{show:m.value,"onUpdate:show":a[8]||(a[8]=i=>m.value=i),preset:"card",style:"width: 1200px"},{header:v(()=>[...a[12]||(a[12]=[e("p",null,"Leader Assignment History",-1),e("p",{class:"text-sm font-normal"},"A comprehensive log displaying historical leader-to-line assignments, including activation and unassignment records.",-1)])]),footer:v(()=>[e("div",lt,[n(I,{label:"Close",type:"primary",tertiary:"",onClick:a[7]||(a[7]=i=>m.value=!1)})])]),default:v(()=>[n(qe,{initialData:p.value},null,8,["initialData"])]),_:1},8,["show"])])}}});export{Ft as default};
