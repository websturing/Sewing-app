import{D as H,E as _,p as O,s as V,r as J,d as I,c as f,o as i,F as B,x as j,a as r,t as v,G as K,H as M,e as u,f as g,w as h,l as T,y as Q,g as p,n as E,v as X,m as P}from"./index-D9MKkV31.js";import{t as Y,I as Z}from"./vee-validate-zod-DnnkVXK4.js";import{h as S,u as ee}from"./Role-BYqooUc9.js";import{o as se,s as U,n as F,a as L}from"./types-D48y91Ee.js";import{u as te,a as $}from"./vee-validate-DkEPkXFH.js";import{S as oe}from"./SendOutline-CFyv3Tdu.js";const W=H("module",{state:()=>({data:[],loading:!1,error:null}),actions:{async fetchModule(){this.loading=!0,this.error=null;try{const e=await _.get("/api/module");this.data=e.data.data,this.error=null}catch(e){throw this.data=[],this.error=S(e),e}finally{this.loading=!1}},async fetchModuleWithPermissions(){this.loading=!0,this.error=null;try{const e=await _.get("/api/module/withpermissions");this.data=e.data.data,this.error=null}catch(e){throw this.data=[],this.error=S(e),e}finally{this.loading=!1}},async createModule(e){this.loading=!0,this.error=null;try{const t=await _.post("/api/module",e);return await this.fetchModule(),t.data.message}catch(t){const o=t?.response?.data?.message||"Terjadi kesalahan";throw this.error=o,o}finally{this.loading=!1}},async updateModule(e,t){this.loading=!0,this.error=null;try{const o=await _.post(`/api/module/${e}`,t);return this.fetchModule(),this.error=null,o.data.message}catch(o){return console.log(o),this.error=S(o),o}finally{this.loading=!1}},async deleteModule(e){this.loading=!0,this.error=null;try{const t=await _.delete(`/api/module/${e}`);return this.fetchModule(),this.error=null,t.data.message}catch(t){throw this.error=S(t),t}finally{this.loading=!1}}}}),A=se({id:F().optional(),name:U().min(1,"Name is required."),guardName:U().default("web")}),re=A.pick({name:!0,guardName:!0}).extend({permissions:L(F()).min(1,"Please select at least one permission.")});A.partial().extend({permissions:L(F()).optional()});function ne(e=null){const t=O(),o=ee(),y=W(),{data:b}=V(o),{data:x}=V(y),{handleSubmit:s,errors:a,isSubmitting:m,resetForm:k}=te({validationSchema:Y(re),initialValues:{name:e?.name||"",guardName:e?.guardName||"web",permissions:e?.permissions||[]}}),{value:w}=$("name"),{value:l}=$("permissions"),d=J(!!e?.id),n=()=>{k({values:{name:e?.name||"",guardName:e?.guardName||"web",permissions:e?.permissions||[]},errors:{}})},R=s(async C=>{try{if(d.value){const c=await o.updateRole(e.id,C);t.success(c)}else{const c=await o.createRole(C);t.success(c),n()}}catch(c){console.error("Error submitting form:",c)}});return{name:w,permissions:l,isEdit:d,onSubmit:R,resetForm:n,parentData:b,errors:a,isSubmitting:m,permissionData:x}}const ae={key:0},ie={class:"text-center"},le={key:0,class:"font-semibold"},me={key:1,class:"ml-2"},de=I({__name:"RolesPermissionRowTable",props:{item:{},index:{},level:{},permissionCheckBox:{}},emits:["update:permissionCheckBox"],setup(e,{emit:t}){const o=e,y=t;function b(s=[],a){return s.find(m=>m.action===a)?.permissionId}const x=["read","create","update","delete","upload","download"];return(s,a)=>{const m=g("n-checkbox"),k=g("n-checkbox-group"),w=g("RolesPermissionRowTable",!0);return i(),f(B,null,[o.item&&o.item.name?(i(),f("tr",ae,[r("td",ie,v(s.level===0?s.index:""),1),r("td",{style:K({paddingLeft:`${s.level*20}px`}),class:"!pl-5"},[s.level===0?(i(),f("span",le,v(s.item.name),1)):(i(),f("span",me,"- "+v(s.item.name),1))],4),(i(),f(B,null,M(x,l=>r("td",{key:l,class:"!text-center"},[u(k,{value:s.permissionCheckBox,"onUpdate:value":a[0]||(a[0]=d=>y("update:permissionCheckBox",d))},{default:h(()=>[u(m,{value:b(s.item.permissions,l),disabled:!b(s.item.permissions,l)},null,8,["value","disabled"])]),_:2},1032,["value"])])),64))])):j("",!0),(i(!0),f(B,null,M(s.item.children,(l,d)=>(i(),T(w,{key:`${l.id}-${d}`,item:l,index:s.index,level:s.level+1,permissionCheckBox:s.permissionCheckBox,"onUpdate:permissionCheckBox":a[1]||(a[1]=n=>y("update:permissionCheckBox",n))},null,8,["item","index","level","permissionCheckBox"]))),128))],64)}}}),ye=I({__name:"RoleForm",props:{initialData:{}},emits:["submitted"],setup(e,{emit:t}){const o=W(),y=e,b=t,x=async()=>{await k(),b("submitted")};Q(async()=>{try{await o.fetchModuleWithPermissions()}catch(d){console.error("Error fetching modules:",d)}});const{name:s,permissions:a,errors:m,onSubmit:k,isEdit:w,permissionData:l}=ne(y.initialData);return(d,n)=>{const R=g("n-table"),C=g("n-card"),c=g("n-space"),D=g("n-icon"),q=g("n-button");return i(),f("div",null,[r("form",{onSubmit:X(x,["prevent"])},[u(Z,{modelValue:p(s),"onUpdate:modelValue":n[0]||(n[0]=N=>E(s)?s.value=N:null),name:"name",errors:p(m),label:"Role Name"},null,8,["modelValue","errors"]),u(c,{vertical:"",class:"mt-5"},{default:h(()=>[n[3]||(n[3]=r("p",{class:"text-gray-400"},"Manage Permission",-1)),u(R,{"single-line":!1},{default:h(()=>[n[2]||(n[2]=r("thead",null,[r("tr",null,[r("th",{class:"!text-center",width:"20px"},"No"),r("th",null,"Module Name"),r("th",{class:"!text-center"},"View"),r("th",{class:"!text-center"},"Create"),r("th",{class:"!text-center"},"Update"),r("th",{class:"!text-center"},"Delete"),r("th",{class:"!text-center"},"Upload"),r("th",{class:"!text-center"},"Download")])],-1)),r("tbody",null,[(i(!0),f(B,null,M(p(l),(N,z)=>(i(),T(de,{item:N,index:z+1,level:0,permissionCheckBox:p(a),"onUpdate:permissionCheckBox":n[1]||(n[1]=G=>E(a)?a.value=G:null)},null,8,["item","index","permissionCheckBox"]))),256))])]),_:1}),p(m).permissions?(i(),T(C,{key:0,"content-class":"bg-red-100"},{default:h(()=>[P(v(p(m).permissions),1)]),_:1})):j("",!0)]),_:1}),u(c,{class:"mt-10",justify:"end"},{default:h(()=>[u(q,{type:"success","icon-placement":"right","attr-type":"submit",block:""},{icon:h(()=>[u(D,null,{default:h(()=>[u(p(oe))]),_:1})]),default:h(()=>[P(" "+v(p(w)?"Apply Changes":"Create New"),1)]),_:1})]),_:1})],32)])}}});export{ye as _,W as u};
