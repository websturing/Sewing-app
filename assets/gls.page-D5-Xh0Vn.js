import{D as N,E as f,p as x,s as P,r as G,q as W,k as D,h as Y}from"./index-CjlGo7ug.js";import{q as H}from"./index-B-cYlh1f.js";import{M as A,L as T,A as c}from"./api.schema-BgX2oz3V.js";import{o as n,s as r,n as e,a as i,c as w,f as J,u as k}from"./types-CVZIcfwR.js";const K=n({id:e().optional(),glNumber:r().min(1,"Line name is required"),createdAt:r().optional(),updatedAt:r().optional()}),V=i(K),X=n({message:r(),data:V,links:T,meta:A,status:w()}),Z=n({glNo:r(),totalBundle:e(),totalPcs:e(),totalColors:e(),totalSizes:e(),lastUpdated:r(),lineNames:r()}),_=n({status:w(),message:r(),data:i(Z),links:T,meta:A}),z=n({orderQty:e().int().nonnegative(),cutQty:e().int().nonnegative()}),B=n({size:r(),orderQty:e().int().nonnegative(),cutQty:e().int().nonnegative()}),aa=n({id:e().optional(),color:r(),type:r(),summary:z,sizeBreakdown:i(B)}),ta=n({orderQty:e().int().nonnegative(),cutQty:e().int().nonnegative()}),ea=n({size:r(),orderQty:e().int().nonnegative(),cutQty:e().int().nonnegative()}),sa=n({glNumber:r(),layingPlannings:i(aa),glSummary:ta,glSizeBreakdown:i(ea)}),ra=n({color:r(),type:J(["BODY","COMBINASI"]),summary:z,sizeBreakdown:i(B)}),na=n({orderQty:e().int().nonnegative(),cutQty:e().int().nonnegative()}),oa=n({glNumbers:i(r())}),ia=n({totalGlCount:e().int().positive(),totalColorCount:e().int().positive(),totalLayingPlannings:e().int().positive(),generatedAt:r(),lastUpdated:r(),filtersApplied:oa}),la=n({message:r(),status:e(),data:n({summaryByGl:i(sa),summaryByColor:i(ra),grandTotal:na,metadata:ia})}),R=N("glsTable",{state:()=>({data:[],meta:{},links:{},loading:!1,error:null}),actions:{async fetch(s={}){this.loading=!0,this.error=null;try{const t=await f.get("/api/gls",{params:{page:s.page??1,perPage:s.perPage??10,search:s.search??void 0}}),a=_.parse(t.data);return this.data=Array.isArray(a.data)?a.data:[],this.meta=a.meta,this.links=a.links,{success:!0,message:a.message??"GLs loaded"}}catch(t){const a=t?.response?.data?.message||"Fetch failed";return this.error=a,this.data=[],{success:!1,message:a}}finally{this.loading=!1}}},getters:{options:s=>s.data.map(t=>({value:t.glNo,label:t.glNo}))}});function ca(){const s=x(),t=R(),{data:a,loading:o,meta:h}=P(t),S=G(""),u=G([]),m=G(!1),y=async(l=!0)=>{const{success:p,message:g}=await t.fetch({search:S.value||void 0});l&&(p?s.success(g):s.error(g))};W(S,async l=>{if(!l){u.value=[],m.value=!1,await y(!1);return}const p=t.data.filter(g=>g.glNo?.toLowerCase().includes(l.toLowerCase()));p.length>0?(u.value=p,m.value=!0):(await y(!1),t.data.length===0?(u.value=[],m.value=!1):(u.value=t.data,m.value=!0))});const C=D(()=>m.value?u.value:a.value);return{meta:h,data:C,search:S,loading:o,handleFetch:y}}const ma="/api",ua={getMatrix:s=>f.get(`${ma}/gls/matrix-date`,{params:s,paramsSerializer:t=>H.stringify(t,{arrayFormat:"brackets"})}).then(t=>t.data)},ga=n({glNo:r(),date:r(),size:r(),totalBundle:e(),totalPcs:k([r(),e()]),totalDefect:k([r(),e()]),lineNames:r(),totalColors:e()}),M=n({size:r(),totalPcs:e(),totalBundle:e()}),da=n({color:r(),totalPcs:e(),totalBundle:e(),totalSizes:e(),totalDefect:e(),lineNames:r(),sizes:i(M)}),ha=n({glNo:r(),sizes:i(M),colors:i(da)}),ya=n({status:w(),message:r(),glNo:r(),hasRecentData:w(),startDate:r(),endDate:r(),count:e(),data:i(ga),summary:ha}),pa=n({id:e(),cuttingGlColorId:e(),size:r(),orderQty:e(),cutQty:e(),stockOutQty:e(),replacementQty:e(),createdAt:r(),updatedAt:r(),sewingStockinQty:e(),sewingStockoutQty:e()}),Sa=n({id:e(),cuttingGlSummaryId:e(),color:r(),type:r(),orderQty:e(),cutQty:e(),stockOutQty:e(),replacementQty:e(),lastSyncAt:r(),createdAt:r(),updatedAt:r(),sewingTotalStockinQty:e(),sewingTotalStockoutQty:e(),sizes:i(pa)}),F=n({id:e(),glNumber:r(),orderQty:e(),cutQty:e(),stockOutQty:e(),replacementQty:e(),lastSyncAt:r(),sewingTotalStockinQty:e(),sewingTotalStockoutQty:e(),colors:i(Sa)}),I=n({status:w(),message:r(),data:F});F.omit({colors:!0});const O=N("gls",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:"",summaryGl:[],summaryByColor:[],total:{},metaSummary:{},matrixData:[],matrixSummary:{}}),actions:{async fetch(s={}){this.loading=!0,this.error=null;try{const t={page:s.page??1,perPage:s.perPage??50,q:s.q??void 0,dateFrom:s.dateFrom,dateTo:s.dateTo};s.q&&(this.searchResult=[],this.isSearching=!0);const a=await f.get("/api/gls",{params:t}),o=X.parse(a.data);return this.meta=o.meta,this.links=o.links,this.currentPage=o.meta.currentPage,this.lastPage=o.meta.lastPage,s.q?this.searchResult=o.data:(this.data=o.data,this.isSearching=!1,this.searchResult=[]),c.parse({success:!0,message:o.message??"Gl Numbers loaded"})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}},async fetchGLNumber(s){this.loading=!0,this.error=null;try{const a=(await f.get(`/api/gls/number/${s}`)).data;return c.parse({success:!0,message:a.message??"Gl Numbers loaded",id:a.data.id})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}},async fetchSummaryGl(s){this.loading=!0,this.error=null;try{const t=await f.get("/api/gls/cutting-summary",{params:{glNumber:s}}),a=la.parse(t.data);return this.summaryGl=a.data.summaryByGl,this.summaryByColor=a.data.summaryByColor,this.metaSummary=a.data.metadata,this.total=a.data.grandTotal,c.parse({success:!0,message:t.data.message??"Gl Numbers loaded"})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}},async fetchSyncCuttingGL(s){this.loading=!0,this.error=null;try{const t=await f.get("/api/gls/syncCuttingGlNumber",{params:{glNumber:s}}),a=I.parse(t.data);return console.log(a),c.parse({success:!0,message:t.data.message??"Gl Numbers loaded"})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}},async fetchGLMatix(s){this.loading=!0,this.error=null;try{const t=await ua.getMatrix(s),a=ya.parse(t);return this.matrixData=a.data,this.matrixSummary=a.summary,c.parse({success:!0,message:a.message??"Summary Chart loaded",data:{startDate:a.startDate,endDate:a.endDate,glNo:a.glNo,summary:a.summary,chartData:a.data}})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}},async searchOrFetch(s){if(this.search!==s&&(this.searchResult=[],this.isSearching=!1),this.search=s,!s)return await this.fetch(),this.data;const t=this.data.filter(o=>o.glNumber?.toLowerCase().includes(s));return t.length>0?(this.searchResult=t,this.isSearching=!0,t):(await this.fetch({page:1,q:s})).success?this.searchResult:[]}},getters:{searchedItems:s=>{if(!s.search)return s.data;if(s.isSearching&&s.searchResult.length)return s.searchResult;const t=s.search.toLowerCase();return s.data.filter(a=>a.glNumber?.toLowerCase().includes(t))},options(){return this.searchedItems.map(s=>({value:s.glNumber||"",label:s.glNumber||""}))}}});function fa(){const s=O(),t=x(),{matrixData:a,matrixSummary:o}=P(s),h=G({}),S=D(()=>a.value.map(l=>l.date)),u=D(()=>a.value.map(l=>l.totalPcs)),m=G(),y=G();return h.value={tooltip:{trigger:"axis"},legend:{data:["PCS","Bundle"]},grid:{left:"0%",right:"0%",bottom:"1%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:S},yAxis:{type:"value"},series:[{name:"PCS",type:"line",smooth:!0,data:u,areaStyle:{opacity:.6,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#6366f1"},{offset:1,color:"rgba(99,102,241,0)"}]}},itemStyle:{color:"#4f46e5"},lineStyle:{width:3}}]},{matrixData:a,matrixSummary:o,startDate:m,endDate:y,GLNumberOptionsEchart:h,handleFetchGLMatrix:async(l,p={notify:!0})=>{const{success:g,message:b,data:v}=await s.fetchGLMatix(l);p.notify&&(g?t.success(b):t.error(b)),g&&v&&(m.value=v.startDate,y.value=v.endDate)}}}const Ga=N("glsSync",{state:()=>({data:{},colors:[],loading:!1,error:null}),actions:{async fetchSyncCuttingGL(s){this.loading=!0,this.error=null;try{const t=await f.get("/api/gls/syncCuttingGlNumber",{params:{glNumber:s}}),a=I.parse(t.data),{colors:o,...h}=a.data;return this.data=h,this.colors=a.data.colors,c.parse({success:!0,message:t.data.message??"Gl Numbers loaded"})}catch(t){const a=t?.response?.data?.message||"Something went wrong";return this.error=a,c.parse({success:!1,message:a})}finally{this.loading=!1}}}});function Qa(){const s=x(),t=R(),a=O(),o=Ga(),{handleFetch:h,data:S,loading:u,search:m,meta:y}=ca(),{data:C,loading:l,colors:p}=P(o),{matrixData:g,matrixSummary:b,GLNumberOptionsEchart:v,handleFetchGLMatrix:E,startDate:U,endDate:$}=fa(),L=G(10),j=Y();return{data:S,meta:y,search:m,loading:u,glCombineData:C,glCombineColors:p,glCombineLoading:l,matrixData:g,matrixSummary:b,startDate:U,endDate:$,GLNumberOptionsEchart:v,handleFetch:h,handlePageChange:async d=>{await t.fetch({page:d,perPage:L.value})},handlePageSizeChange:async d=>{L.value=d,await t.fetch({page:1,perPage:L.value})},handleCuttingIntegrationGl:async d=>{await a.fetchSummaryGl(d)},handleSyncCuttingGL:async d=>{const{success:q,message:Q}=await o.fetchSyncCuttingGL(d);q?s.success(Q):s.error(Q)},navigateToGLDetail:d=>{j.push({name:"gls-detail",params:{id:d}})},handleFetchGLMatrix:E}}export{Qa as a,ca as u};
