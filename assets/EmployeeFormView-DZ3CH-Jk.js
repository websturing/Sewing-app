import{d as j,c as U,e as t,f as c,w as l,o as C,a,l as W,t as h,g as e,m as N,r as d,q as H,v as q,x as ae,n as M,L as T,M as le,O as re,P as ie,h as ue,k as me,y as ce,I as pe}from"./index-DKBTRk-l.js";import{_ as I}from"./BaseButton.vue_vue_type_script_setup_true_lang-RFHt82WQ.js";import{D as de,U as L,A as fe,N as ve}from"./UserAddOutlined-DB6gSzvH.js";import{u as _e,_ as ye}from"./user.form-AEAkYQqJ.js";import{u as be,a as z,_ as ge}from"./useEmployee-DGIr1Qat.js";import{u as we}from"./useRoleTable-Dw_tbht4.js";import{u as xe}from"./user.store-Ifh98lxa.js";import{I as O}from"./InputLabelWithError-BArHEzIi.js";import{S as Q}from"./SaveAnnotation-C4cpGCzd.js";import{a as he}from"./vee-validate-zod-BO4IYhAf.js";import{u as Ce,a as Ee}from"./vee-validate-emIdRdtZ.js";import{S as ke}from"./SmartHome-DW14BnM_.js";import{C as Fe}from"./QrCode20Filled-Lfs_t4Er.js";import{F as Se}from"./FormNew28Regular-1WIQi6p5.js";import{o as De,a as Ne,s as Ue}from"./types-CVZIcfwR.js";import"./AlertOutline-ChyIBSBw.js";import"./useFieldWrapper-CGj0wRYJ.js";import"./user.schema-BXMI3HnA.js";import"./employeeSchema-AqYtwcrb.js";import"./metaPagination-9MSE0uSw.js";import"./api.schema-B7NsqcGR.js";import"./dayjs.min-lasCq60O.js";import"./_commonjsHelpers-CE1G-McA.js";import"./Role-C2UxYGZJ.js";import"./Trash-DkM1KI5p.js";import"./EyeOutline-B4cxGYh5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"flex justify-center p-5"},Te={class:"text-center"},$e={class:"mb-2 font-bold mt-5 animate-pulse"},Ae={key:1,class:"text-center"},Pe={class:"mb-2 font-bold mt-5"},Re={class:"mb-4"},Be=j({__name:"ProgressModal",props:{title:{},description:{},show:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},emits:["update:show"],setup(E,{emit:i}){const u=E,b=i;return(p,o)=>{const n=c("n-spin"),m=c("NIcon"),g=c("n-button"),w=c("n-modal");return C(),U("div",null,[t(w,{show:u.show,closable:!1,preset:"card",style:{width:"600px"},"close-on-esc":!1,"mask-closable":!1,"onUpdate:show":o[1]||(o[1]=f=>b("update:show",f))},{default:l(()=>[a("div",Ve,[u.error?(C(),U("div",Ae,[t(m,{component:e(de),size:"96",color:"#d90429"},null,8,["component"]),a("p",Pe,h(u.title),1),a("p",Re,h(u.description),1),t(g,{tertiary:"",onClick:o[0]||(o[0]=f=>b("update:show",!1))},{default:l(()=>[...o[2]||(o[2]=[N("Close",-1)])]),_:1})])):(C(),W(n,{key:0,show:!0,size:"large"},{description:l(()=>[a("div",Te,[a("p",$e,h(u.title),1),a("p",null,h(u.description),1)])]),_:1}))])]),_:1},8,["show"])])}}});function Ie(E){const i=d(1),u=d("process");return{current:i,currentStatus:u,next:async o=>{const n=i.value-1;o[n]&&!await o[n]()||i.value<E&&i.value++},prev:()=>{i.value>1&&i.value--}}}const Me={class:"flex gap-2"},je=j({__name:"UserForm",props:{initialData:{},isEdit:{type:Boolean,default:!1},submitLabel:{default:"Create Employee"},submitType:{default:"default"},placmentEnd:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},icon:{default:Q}},emits:["click:submitted"],setup(E,{expose:i,emit:u}){const b=u,p=d(!1),o=E,{name:n,email:m,errors:g,validateForm:w,onSubmit:f}=_e(o.initialData),k=f(v=>{b("click:submitted",v)});return H(()=>o.initialData,v=>{v?n.value=v.name:o.isEdit&&(n.value=""),p.value=!0},{deep:!0}),i({name:n,validateForm:w,submit:k}),(v,_)=>{const $=c("n-icon"),A=c("n-button");return C(),U("div",null,[a("form",{onSubmit:_[2]||(_[2]=q((...x)=>e(k)&&e(k)(...x),["prevent"]))},[a("div",Me,[t(O,{name:"name",errors:e(g),label:"Name",modelValue:e(n),"onUpdate:modelValue":_[0]||(_[0]=x=>M(n)?n.value=x:null),readonly:p.value,classContent:"!bg-gray-100"},null,8,["errors","modelValue","readonly"]),t(O,{name:"email",errors:e(g),label:"Email",modelValue:e(m),"onUpdate:modelValue":_[1]||(_[1]=x=>M(m)?m.value=x:null)},null,8,["errors","modelValue"])]),o.visible?(C(),U("div",{key:0,class:T([o.placmentEnd?"justify-end":"","flex gap-2 mt-10"])},[a("div",null,[t(A,{type:o.submitType,"icon-placement":"right","attr-type":"submit",block:""},{icon:l(()=>[t($,null,{default:l(()=>[(C(),W(le(o.icon)))]),_:1})]),default:l(()=>[N(" "+h(o.submitLabel),1)]),_:1},8,["type"])])],2)):ae("",!0)],32)])}}}),Le={class:"flex flex-col gap-10"},ze={class:"bg-gray-50 p-5 rounded-md"},Oe={class:"flex justify-between items-center"},We={class:"w-84 flex-auto"},He={class:"text-xl font-bold mb-1"},qe={class:"w-16 flex-auto text-right"},Qe={class:"p-5 flex flex-col gap-10"},Ge={class:"mt-5 mb-10"},Ye={class:"flex justify-end gap-3"},Ct=j({__name:"EmployeeFormView",setup(E){const i=ue(),u=xe(),b=be(),{meta:p}=z(),o=d(!1),n=re({title:"Creating Employee Personal Detail",description:"Please wait while we are creating the new record. This may take a few seconds.",error:!1}),m=d(),g=d(),w=d({}),f=d({}),k=ie(),v=d({name:"",email:"",roleNames:[]}),{handleCreateEmployee:_}=z(),$=he(De({roles:Ne(Ue()).min(1,"Pilih minimal 1 role")})),{errors:A,handleSubmit:x,validate:G}=Ce({validationSchema:$}),P=x(async()=>{n.error=!1,f.value.roleNames=V.value;const{id:r,success:s,message:S}=await u.create(f.value);if(!s){n.title=S,n.error=!0;return}n.title="creating Employee Account",w.value.userId=r;const{success:D,message:R}=await b.createEmployee(w.value);if(!D){n.title=R,n.error=!0;return}setTimeout(()=>{o.value=!1,i.push({name:"employee"})},3e3)}),{value:V}=Ee("roles",void 0,{initialValue:[]}),{fnRefresh:Y,data:J}=we(),K=me(()=>J.value.map(r=>({value:r.name,label:r.name}))),{current:y,currentStatus:X,next:Z,prev:ee}=Ie(3),te=[async()=>{const{valid:r,values:s}=await m.value?.validateForm();return r?(w.value=s,!0):!1},async()=>{const{valid:r,values:s}=await g.value?.validateForm();return r?(f.value=s,!0):!1},async()=>{const{valid:r}=await G();return r?(k.success({title:"Confirmation Create Employee",content:"Are you sure you want to create this record? Please review the details before proceeding.",positiveText:"Create",negativeText:"Cancel",draggable:!0,onPositiveClick:async()=>{o.value=!0,P()}}),!0):!1}],oe=async r=>{k.warning({title:"No User Account Detected",content:"This employee doesnâ€™t have a user account yet. Do you still want to save? You can assign one later to provide access.",positiveText:"Sure",negativeText:"Not Sure",draggable:!0,onPositiveClick:async()=>{_(r)}})};function se(){m.value?.submit()}return ce(async()=>{await Y()}),p.value.description="Quickly register and onboard new employees.",pe({title:"Employee Form",meta:[{name:"description",content:p.value.description}]}),H(()=>m.value?.name,()=>{v.value.name=m.value?.name}),(r,s)=>{const S=c("n-icon"),D=c("n-breadcrumb-item"),R=c("n-breadcrumb"),B=c("n-step"),ne=c("n-steps");return C(),U("div",Le,[a("div",ze,[a("div",Oe,[a("div",We,[a("h2",He,h(e(p).title),1),a("p",null,h(e(p).description),1)]),a("div",qe,[t(R,null,{default:l(()=>[t(D,null,{default:l(()=>[t(S,{component:e(ke)},null,8,["component"]),s[4]||(s[4]=N(" Home",-1))]),_:1}),t(D,null,{default:l(()=>[t(S,{component:e(Fe)},null,8,["component"]),s[5]||(s[5]=N(" Employee",-1))]),_:1}),t(D,null,{default:l(()=>[t(S,{component:e(Se)},null,8,["component"]),s[6]||(s[6]=N(" Form",-1))]),_:1})]),_:1})])])]),a("div",Qe,[a("form",{onSubmit:s[1]||(s[1]=q((...F)=>e(P)&&e(P)(...F),["prevent"]))},[t(ne,{current:e(y),status:e(X),vertical:""},{default:l(()=>[t(B,{title:"Employee",description:"Personal Detail"},{default:l(()=>[s[7]||(s[7]=a("p",null,"Quickly register and onboard new employees.",-1)),a("div",Ge,[t(ge,{ref_key:"employeeForm",ref:m,submitLabel:"Create Employee Without User Account","onClick:submitted":oe,visible:!1,icon:e(L),class:T([e(y)==1?"":"opacity-25"])},null,8,["icon","class"])])]),_:1}),t(B,{title:"User Account",description:"Create a new user account with required credentials"},{default:l(()=>[t(je,{ref_key:"userForm",ref:g,class:T([e(y)==2?"":"opacity-25"]),initialData:v.value,visible:!1},null,8,["class","initialData"])]),_:1}),t(B,{title:"Access Control",description:"Assign roles and manage employee permissions."},{default:l(()=>[a("div",{class:T([e(y)==3?"":"opacity-25","mt-5 mb-10"])},[t(ye,{modelValue:e(V),"onUpdate:modelValue":s[0]||(s[0]=F=>M(V)?V.value=F:null),name:"roles",options:K.value,multiple:!0,errors:e(A),label:"Roles Name"},null,8,["modelValue","options","errors"])],2)]),_:1})]),_:1},8,["current","status"])],32),a("div",Ye,[t(I,{label:"Create Employee Without User Account",onClick:se,class:"pr-10",icon:e(L)},null,8,["icon"]),t(I,{label:"Prev",icon:e(fe),onClick:e(ee),disabled:e(y)===1},null,8,["icon","onClick","disabled"]),t(I,{label:e(y)==3?"Apply Changes":"Next",icon:e(y)===3?e(Q):e(ve),"icon-placement":"right",type:e(y)==3?"success":"info",onClick:s[2]||(s[2]=F=>e(Z)(te))},null,8,["label","icon","type"])])]),t(Be,{show:o.value,"onUpdate:show":s[3]||(s[3]=F=>o.value=F),title:n.title,error:n.error,description:n.description},null,8,["show","title","error","description"])])}}});export{Ct as default};
