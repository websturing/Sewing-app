import{_ as I}from"./BaseButton.vue_vue_type_script_setup_true_lang-6gotNCYT.js";import{E as q,D as ie,p as te,r as D,k as J,s as re,d as H,y as se,c as _,o as y,a as e,e as a,g as u,n as E,f as S,F as k,H as F,l as K,w as L,m as P,t as d,v as de,L as ue}from"./index-gyip3Da5.js";import{_ as Z}from"./BaseSelectWithError.vue_vue_type_script_setup_true_lang-BM5fCO6u.js";import{u as me}from"./useFieldWrapper-DCulIXd5.js";import{o as Q,c as ae,a as N,n as T,s as C}from"./types-CVZIcfwR.js";import{A as R}from"./api.schema-B7NsqcGR.js";import{a as ce}from"./defect.summaryApi-Bar6lMpN.js";import{u as pe}from"./line.page-B7BVgfMd.js";import{u as ge}from"./user.table-DUnJk_ZR.js";import{t as fe}from"./vee-validate-zod-OUh74rQ8.js";import{u as ve}from"./vee-validate-Cv_M3Sb7.js";import{S as ye,T as be,P as Le}from"./Trash-DVVOSnOO.js";import{_ as he}from"./BaseInput.vue_vue_type_script_setup_true_lang-BXNYiFAI.js";import{S as _e}from"./SearchOutline-DcfiRB9x.js";import{R as xe}from"./RefreshRound-Bbu_KeRB.js";import{C as ne}from"./ChartPerson20Filled-D_PkwJbp.js";import{F as Ae}from"./FolderDetailsReference-BjRF1myt.js";import{S as we}from"./SmartHome-BXqWVksu.js";import"./AlertOutline-C9G8OYL2.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./stockin.api.schema-cou0zUz2.js";import"./metaPagination-BMwnZfrC.js";import"./dateRangeFormaterNaive-ClR-GZjc.js";import"./user.store-BTCPniS8.js";import"./user.schema-CdSDHvt6.js";import"./employeeSchema-Cz-UxfTA.js";const Se=Q({userId:T().nullable().refine(s=>s!==null,"Leader is required").transform(s=>s),lineId:N(T()).min(1,"Leader is required"),isActive:ae()}),O="/api",G={getAssignments:()=>q.get(`${O}/leaders`).then(s=>s.data),createAssign:s=>q.post(`${O}/leaders/assign`,s).then(n=>n.data),createUnassign:s=>q.post(`${O}/leaders/unassign`,s).then(n=>n.data)},ee=Q({assignId:T(),assignAt:C(),unassignAt:C().nullable(),lineId:T().nullable(),lineName:C().nullable(),createdBy:C(),updatedBy:C().nullable(),lastUpdated:C()}),Ue=Q({leader:C(),leaderId:T(),isActive:ae(),activeLines:C(),activeLineIds:C(),lastUpdated:C().nullable(),activeDetail:N(ee),inactiveDetail:N(ee)}),Be=ce(N(Ue)),le=ie("leaderStore",{state:()=>({loading:!1,error:null,AssignmentSummaryByLeader:[]}),actions:{async fetchSummaryByLeader(){this.loading=!0,this.error=null;try{const s=await G.getAssignments(),n=Be.parse(s);return this.AssignmentSummaryByLeader=n.data,R.parse({success:!0,message:n.message??"loaded"})}catch(s){const n=s?.response?.data?.message||"Something went wrong";return this.error=n,R.parse({success:!1,message:n})}finally{this.loading=!1}},async createAssignLeader(s){try{const n=await G.createAssign(s);return R.parse({success:!0,message:n.message??"Created",data:n.data})}catch(n){const r=n?.response?.data?.message||"Something went wrong";return this.error=r,R.parse({success:!1,message:r})}finally{this.loading=!1}},async unAssignLeader(s){try{const n=await G.createUnassign(s);return R.parse({success:!0,message:n.message??"Created",data:n.data})}catch(n){const r=n?.response?.data?.message||"Something went wrong";return this.error=r,R.parse({success:!1,message:r})}finally{this.loading=!1}}}});function W(s=null){const n=te(),r=le(),l=D(!1),{rows:m,handleFetch:c}=ge(),{data:i,handleFetch:p}=pe(),A=J(()=>m.value.map(w=>({label:w.name,value:w.id}))),b=J(()=>i.value.map(w=>({label:w.name,value:w.id}))),t=async w=>{l.value=!0,await r.createAssignLeader(w),l.value=!1},B=async w=>{l.value=!0;const{success:oe,message:Y}=await r.unAssignLeader(w);oe?n.success(Y):n.error(Y),l.value=!1},g=async()=>{await Promise.all([c(),p({notify:!1},{perPage:200})])},f=()=>({userId:s?.userId??null,lineId:s?.lineId??[],isActive:s?.isActive??!0}),{handleSubmit:h,errors:o,isSubmitting:V,resetForm:x,validate:$}=ve({validationSchema:fe(Se),initialValues:f()}),{userId:v,lineId:j,isActive:z}=me(["userId","lineId","isActive"]);return{isLoading:l,userId:v,lineId:j,isActive:z,optionUsers:A,optionLines:b,handleUserLineData:g,onSubmit:h,resetForm:()=>{x({values:f(),errors:{}})},errors:o,isSubmitting:V,validateForm:async()=>{const w=await $();return w.valid?{valid:!0,values:w.values}:{valid:!1}},handleCreateAssignLeader:t,handleUnassignLeader:B}}function M(){const s=te(),n=le(),r=D(!1),{loading:l,AssignmentSummaryByLeader:m}=re(n);return{leaderPiniaLoading:l,isLoading:r,AssignmentSummaryByLeader:m,fetchSummaryByLeader:async(i={notify:!0})=>{const{success:p,message:A}=await n.fetchSummaryByLeader();return i.notify&&(p?s.success(A):s.error(A)),{success:p,message:A}}}}const Ce={class:"flex flex-col gap-5"},De={class:"flex gap-2 items-end"},$e={class:"flex flex-col"},ke={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Fe={class:"flex gap-2 flex-wrap mt-2"},Ie={class:"flex gap-2 justify-end"},Ve=H({__name:"LeaderAssignmentForm",props:{modal:{type:Boolean},initialData:{}},emits:["update:modal"],setup(s,{emit:n}){const r=s,{isLoading:l,userId:m,lineId:c,isActive:i,optionLines:p,optionUsers:A,onSubmit:b,errors:t,resetForm:B,handleUserLineData:g,handleCreateAssignLeader:f}=W(r.initialData),{fetchSummaryByLeader:h}=M(),o=b(async $=>{await f($),await h(),x(!1)}),V=n,x=$=>{V("update:modal",$)};return se(async()=>{await g()}),($,v)=>{const j=S("n-switch"),z=S("n-tag");return y(),_("div",null,[e("form",{onSubmit:v[3]||(v[3]=de((...U)=>u(o)&&u(o)(...U),["prevent"]))},[e("div",Ce,[v[6]||(v[6]=e("div",{class:"mb-5"},[e("p",{class:"text-xl font-semibold"},"Leader Assignment Form"),e("p",null,"A dedicated form interface for assigning leaders to specific production lines.")],-1)),e("div",De,[a(Z,{name:"userId",options:u(A),label:"Leaders",modelValue:u(m),"onUpdate:modelValue":v[0]||(v[0]=U=>E(m)?m.value=U:null),placeholder:"Select Leader",errors:u(t)},null,8,["options","modelValue","errors"]),a(Z,{name:"lineId",options:u(p),multiple:"",label:"Lines",modelValue:u(c),"onUpdate:modelValue":v[1]||(v[1]=U=>E(c)?c.value=U:null),placeholder:"Select Lines",errors:u(t)},null,8,["options","modelValue","errors"]),e("div",$e,[v[4]||(v[4]=e("label",{id:"isActive",class:"mb-2 font-semibold"},"Is Active",-1)),a(j,{round:!1,size:"large",value:u(i),"onUpdate:value":v[2]||(v[2]=U=>E(i)?i.value=U:null)},null,8,["value"])])]),e("div",ke,[v[5]||(v[5]=e("p",{class:"text-xs text-gray-400"},"Selected Lines",-1)),e("div",Fe,[(y(!0),_(k,null,F(u(c),U=>(y(),K(z,{key:U,size:"small",type:"info",round:""},{default:L(()=>[P(d(u(p).find(X=>X.value===U)?.label),1)]),_:2},1024))),128))])]),e("div",Ie,[a(I,{label:"Reset",onClick:u(B),type:"error",quaternary:""},null,8,["onClick"]),a(I,{label:"Assign Leader",icon:u(ye),"icon-placement":"right",loading:u(l),type:"primary",attrType:"submit"},null,8,["icon","loading"])])])],32)])}}}),Re={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Te={class:"text-lg font-semibold mb-2"},He={class:"flex gap-2 mb-5"},Me=H({__name:"LeaderAssignmentHistory",props:{initialData:{},modal:{type:Boolean}},emits:["update:modal"],setup(s,{emit:n}){return D(null),W(),M(),(r,l)=>{const m=I,c=S("n-table");return y(),_("div",null,[e("div",Re,[l[3]||(l[3]=e("p",{class:"text-gray-400 font-semibold"},"Leader Name",-1)),e("p",Te,d(s.initialData?.leader.toUpperCase()),1),e("div",He,[(y(!0),_(k,null,F(s.initialData?.activeLines.split(","),i=>(y(),K(m,{label:i,classContent:"!bg-green-200"},null,8,["label"]))),256))]),l[4]||(l[4]=e("p",{class:"text-xs font-semibold text-gray-400 mb-3"},"History Assignments",-1)),a(c,null,{default:L(()=>[l[2]||(l[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Line"),e("th",null,"Assign At"),e("th",null,"Unassign At"),e("th",null,"Created By"),e("th",null,"Updated By"),e("th",{class:"!text-center"},"Active"),e("th",null,"Last Updated")])],-1)),e("tbody",null,[(y(!0),_(k,null,F(s.initialData?.activeDetail,(i,p)=>(y(),_("tr",null,[e("td",null,d(p+1),1),e("td",null,d(i.lineName),1),e("td",null,d(i.assignAt),1),e("td",null,d(i.unassignAt??"-"),1),e("td",null,d(i.createdBy),1),e("td",null,d(i.updatedBy??"-"),1),l[0]||(l[0]=e("td",{class:"!bg-green-200 !text-center"},"Active",-1)),e("td",null,d(i.lastUpdated),1)]))),256)),(y(!0),_(k,null,F(s.initialData?.inactiveDetail,(i,p)=>(y(),_("tr",null,[e("td",null,d(p+1),1),e("td",null,d(i.lineName),1),e("td",null,d(i.assignAt),1),e("td",null,d(i.unassignAt??"-"),1),e("td",null,d(i.createdBy),1),e("td",null,d(i.updatedBy??"-"),1),l[1]||(l[1]=e("td",{class:"!bg-red-200 !text-center"},"Inactive",-1)),e("td",null,d(i.lastUpdated),1)]))),256))])]),_:1})])])}}}),Pe={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Ne={class:"text-lg font-semibold mb-2"},je=H({__name:"LeaderUnassignmentForm",props:{initialData:{},modal:{type:Boolean}},emits:["update:modal"],setup(s,{emit:n}){const r=n,l=D(null),{isLoading:m,handleUnassignLeader:c}=W(),{fetchSummaryByLeader:i}=M(),p=b=>{r("update:modal",b)},A=async(b,t)=>{l.value=b,await c({id:t}),s.initialData?.activeDetail.splice(b,1),l.value=null,await i(),p(!1)};return(b,t)=>{const B=S("n-divider"),g=S("n-list-item"),f=S("n-list");return y(),_("div",null,[e("div",Pe,[e("p",Ne,d(s.initialData?.leader),1),t[0]||(t[0]=e("p",{class:"text-xs font-semibold text-gray-400"},"Assignment Lines",-1)),a(B,{dashed:"",class:"!my-[10px]"}),a(f,{bordered:""},{default:L(()=>[(y(!0),_(k,null,F(s.initialData?.activeDetail,(h,o)=>(y(),K(g,{class:ue((o===l.value,"dimmed"))},{suffix:L(()=>[a(I,{label:"unassign line",size:"small",icon:u(be),type:"error",loading:u(m)&&o==l.value,onClick:V=>A(o,h.assignId),disabled:o==l.value},null,8,["icon","loading","onClick","disabled"])]),default:L(()=>[P(d(h?.lineName)+" ",1)]),_:2},1032,["class"]))),256))]),_:1})])])}}}),ze={class:"flex flex-col gap-5"},qe={class:"flex justify-between"},Ee={class:"!w-[300px]"},Oe={class:"flex gap-3 items-center"},Ge={class:"flex gap-2"},Je=H({__name:"SummaryLeaderTable",props:{modal:{type:Boolean}},emits:["click:unassignLine","click:assignHistory","update:modal"],setup(s,{emit:n}){const r=D(""),l=J(()=>{const g=r.value.toLowerCase().trim();return g?(c.value||[]).filter(f=>f.leader?.toLowerCase().includes(g)||f.activeLines?.toLowerCase().includes(g)):c.value||[]}),{leaderPiniaLoading:m,AssignmentSummaryByLeader:c,fetchSummaryByLeader:i}=M(),p=n,A=async()=>{await i()},b=async g=>{p("click:unassignLine",g)},t=g=>{p("update:modal",g)},B=g=>{p("click:assignHistory",g)};return(g,f)=>{const h=I,o=S("n-skeleton"),V=S("n-table");return y(),_("div",ze,[e("div",qe,[e("div",Ee,[a(he,{icon:u(_e),placeholder:"Search",modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=x=>r.value=x)},null,8,["icon","modelValue"])]),e("div",Oe,[a(h,{label:"Refresh",icon:u(xe),onClick:A},null,8,["icon"]),a(h,{label:"Create Leader Assignment",icon:u(ne),onClick:f[1]||(f[1]=x=>t(!0)),type:"primary"},null,8,["icon"])])]),a(V,null,{default:L(()=>[f[2]||(f[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Leader"),e("th",null,"Line Assignments"),e("th",null,"Last Updated"),e("th",null,"Status")])],-1)),e("tbody",null,[u(m)?(y(),_(k,{key:0},F(10,x=>e("tr",{key:x},[e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})]),e("td",null,[a(o,{text:""})])])),64)):(y(!0),_(k,{key:1},F(l.value,(x,$)=>(y(),_("tr",{key:$},[e("td",null,d($+1),1),e("td",null,d(x.leader),1),e("td",null,d(x.activeLines),1),e("td",null,d(x.lastUpdated),1),e("td",Ge,[a(h,{label:"Detail",icon:u(Ae),onClick:v=>B(x),tertiary:""},null,8,["icon","onClick"]),a(h,{label:"Unasssign Line",icon:u(Le),tertiary:"",type:"error",onClick:v=>b(x)},null,8,["icon","onClick"])])]))),128))])]),_:1})])}}}),Ke={class:"flex flex-col gap-10"},Qe={class:"flex justify-between items-center"},We={class:"w-84 flex-auto"},Xe={class:"text-xl font-bold mb-1"},Ye={class:"w-16 flex-auto text-right"},Ze={class:"flex justify-end"},et={class:"flex justify-end"},Ct=H({__name:"LeadersPageView",setup(s){const n=D({title:"Leader Management Module",description:"A centralized interface enabling users to view, create, and maintain leader records assigned across multiple production lines. The module streamlines oversight, improves data governance, and ensures operational visibility by providing a structured workflow for leader placement and line assignments."}),r=D(!1),l=D(!1),m=D(!1),c=D(),{fetchSummaryByLeader:i}=M(),p=b=>{c.value=b,l.value=!0},A=b=>{c.value=b,m.value=!0};return se(async()=>{await i()}),(b,t)=>{const B=S("n-icon"),g=S("n-breadcrumb-item"),f=S("n-breadcrumb"),h=S("n-modal");return y(),_("div",Ke,[e("div",Qe,[e("div",We,[e("h2",Xe,d(n.value.title),1),e("p",null,d(n.value.description),1)]),e("div",Ye,[a(f,null,{default:L(()=>[a(g,null,{default:L(()=>[a(B,{component:u(we)},null,8,["component"]),t[9]||(t[9]=P(" Home",-1))]),_:1}),a(g,null,{default:L(()=>[a(B,{component:u(ne)},null,8,["component"]),t[10]||(t[10]=P(" Leaders ",-1))]),_:1})]),_:1})])]),a(Je,{"onClick:unassignLine":p,modal:r.value,"onUpdate:modal":t[0]||(t[0]=o=>r.value=o),modalDetail:m.value,"onUpdate:modalDetail":t[1]||(t[1]=o=>m.value=o),"onClick:assignHistory":A},null,8,["modal","modalDetail"]),a(h,{show:r.value,"onUpdate:show":t[3]||(t[3]=o=>r.value=o),preset:"card",style:"width: 1200px"},{default:L(()=>[a(Ve,{modal:r.value,"onUpdate:modal":t[2]||(t[2]=o=>r.value=o)},null,8,["modal"])]),_:1},8,["show"]),a(h,{show:l.value,"onUpdate:show":t[6]||(t[6]=o=>l.value=o),preset:"card",style:"width: 1200px"},{header:L(()=>[...t[11]||(t[11]=[e("p",null,"Leader Unassignment",-1),e("p",{class:"text-sm font-normal"},"An operational interface for removing a leader from a designated production line.",-1)])]),footer:L(()=>[e("div",Ze,[a(I,{label:"Close",type:"primary",tertiary:"",onClick:t[4]||(t[4]=o=>l.value=!1)})])]),default:L(()=>[a(je,{initialData:c.value,modal:l.value,"onUpdate:modal":t[5]||(t[5]=o=>l.value=o)},null,8,["initialData","modal"])]),_:1},8,["show"]),a(h,{show:m.value,"onUpdate:show":t[8]||(t[8]=o=>m.value=o),preset:"card",style:"width: 1200px"},{header:L(()=>[...t[12]||(t[12]=[e("p",null,"Leader Assignment History",-1),e("p",{class:"text-sm font-normal"},"A comprehensive log displaying historical leader-to-line assignments, including activation and unassignment records.",-1)])]),footer:L(()=>[e("div",et,[a(I,{label:"Close",type:"primary",tertiary:"",onClick:t[7]||(t[7]=o=>m.value=!1)})])]),default:L(()=>[a(Me,{initialData:c.value},null,8,["initialData"])]),_:1},8,["show"])])}}});export{Ct as default};
