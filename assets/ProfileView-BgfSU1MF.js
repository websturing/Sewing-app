import{u as B,d as D,D as I,L as M,A as H}from"./useLogout-BASUhjFV.js";import{u as z,s as F,d as C,c as w,o as f,e,f as o,w as s,a as g,g as c,t as P,F as O,H as E,l as L,m as b,D as R,E as U,p as N,n as V,v as j,r as W,I as Y}from"./index-CIPWK8yN.js";import{I as $}from"./InputLabelWithError-B15EnSE9.js";import{o as q,s as T}from"./types-CVZIcfwR.js";import{t as G}from"./vee-validate-zod-oXVd7K3l.js";import{u as J,a as A}from"./vee-validate-Bhj0rIeg.js";import{S as K}from"./SendOutline-BYg0EsLT.js";import"./EyeOutline-Bjj8CuS7.js";import"./AlertOutline-oU_ZwQVT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function S(){const i=z(),{user:l,role:n,permissions:a}=F(i),r=l.value?.email,t=l.value?.name;return{email:r,name:t,role:n,permissions:a}}const Q={class:"flex gap-2 items-center"},X={class:"font-bold"},Z={class:"text-gray-400 flex"},ee=C({__name:"ProfileCard",emits:["change-password"],setup(i,{emit:l}){const n=l,a=()=>{n("change-password")},{toggleModal:r}=B(),{email:t,role:u}=S();return(d,m)=>{const p=o("n-avatar"),h=o("n-tag"),v=o("n-space"),y=o("n-card"),_=o("n-icon"),x=o("n-button");return f(),w("div",null,[e(y,{"content-class":"bg-indigo-100 rounded-lg"},{default:s(()=>[g("div",Q,[e(p,{round:"",size:64,src:c(D)},null,8,["src"]),e(v,{vertical:"",size:"small"},{default:s(()=>[g("span",X,P(c(t)),1),g("div",Z,[(f(!0),w(O,null,E(c(u),k=>(f(),L(h,{key:k,type:"warning",size:"small"},{default:s(()=>[b(P(k),1)]),_:2},1024))),128))])]),_:1})])]),_:1}),e(v,{class:"mt-2"},{default:s(()=>[e(x,{type:"default",block:"",size:"large",onClick:a},{icon:s(()=>[e(_,null,{default:s(()=>[e(c(I))]),_:1})]),default:s(()=>[m[0]||(m[0]=b(" Change Password ",-1))]),_:1}),e(x,{type:"error",block:"",size:"large",onClick:c(r)},{icon:s(()=>[e(_,null,{default:s(()=>[e(c(M))]),_:1})]),default:s(()=>[m[1]||(m[1]=b(" Sign Out ",-1))]),_:1},8,["onClick"])]),_:1})])}}}),te=q({password:T().min(8,"Password must be at least 8 characters")}),se=te.extend({passwordConfirm:T().min(8,"Confirm Password must be at least 8 characters")}).refine(i=>i.password===i.passwordConfirm,{message:"Passwords do not match",path:["passwordConfirm"]}),ne=R("profile",{state:()=>({data:[],loading:!1,error:null}),actions:{async changePassword(i,l){this.loading=!0,this.error=null;try{return(await U.post(`/api/auth/password/${l}`,i)).data.message}catch(n){const a=n?.response?.data?.message||"Terjadi kesalahan";throw this.error=a,a}finally{this.loading=!1}}}});function oe(){const i=ne(),l=z(),n=N(),{user:a}=F(l),{handleSubmit:r,errors:t,isSubmitting:u,resetForm:d}=J({validationSchema:G(se)}),{value:m}=A("password"),{value:p}=A("passwordConfirm"),h=()=>{d({values:{password:"",passwordConfirm:""},errors:{}})},v=r(async y=>{if(!a.value?.id){n.error("User ID not found");return}try{const _=await i.changePassword(y,a.value?.id);n.success(_),h()}catch(_){n.error("Error submitting form"),console.error("Error submitting form:",_)}});return{password:m,passwordConfirm:p,errors:t,isSubmitting:u,onSubmit:v,resetForm:h}}const ae=C({__name:"ProfileChangePassword",emits:["submitted"],setup(i,{emit:l}){const n=l,a=async()=>{await d(),n("submitted")},{password:r,passwordConfirm:t,errors:u,onSubmit:d}=oe();return(m,p)=>{const h=o("n-icon"),v=o("n-button"),y=o("n-space");return f(),w("div",null,[g("form",{onSubmit:j(a,["prevent"])},[e(y,{vertical:"",size:"large"},{default:s(()=>[e($,{type:"password",modelValue:c(r),"onUpdate:modelValue":p[0]||(p[0]=_=>V(r)?r.value=_:null),name:"password",errors:c(u),label:"Password"},null,8,["modelValue","errors"]),e($,{type:"password",modelValue:c(t),"onUpdate:modelValue":p[1]||(p[1]=_=>V(t)?t.value=_:null),name:"passwordConfirm",errors:c(u),label:"Confirm Password"},null,8,["modelValue","errors"]),e(v,{type:"success","icon-placement":"right","attr-type":"submit",block:""},{icon:s(()=>[e(h,null,{default:s(()=>[e(c(K))]),_:1})]),default:s(()=>[p[2]||(p[2]=b(" Apply Changes ",-1))]),_:1})]),_:1})],32)])}}}),re=C({__name:"ProfileHistory",setup(i){return(l,n)=>{const a=o("n-icon"),r=o("n-button"),t=o("n-timeline-item"),u=o("n-timeline"),d=o("n-card");return f(),w("div",null,[e(d,{title:"Recent Activity"},{"header-extra":s(()=>[e(r,{text:""},{icon:s(()=>[e(a,null,{default:s(()=>[e(c(H))]),_:1})]),default:s(()=>[n[0]||(n[0]=b(" All Activity ",-1))]),_:1})]),default:s(()=>[e(u,null,{default:s(()=>[e(t,{content:"Oops"}),e(t,{type:"success",title:"Success",content:"success content",time:"2018-04-03 20:46"}),e(t,{type:"error",content:"Error content",time:"2018-04-03 20:46"}),e(t,{type:"warning",title:"Warning",content:"warning content",time:"2018-04-03 20:46"}),e(t,{type:"info",title:"Info",content:"info content",time:"2018-04-03 20:46","line-type":"dashed"}),e(t,{content:"Oops"})]),_:1})]),_:1})])}}}),le=C({__name:"ProfilePermission",setup(i){const{permissions:l}=S();return(n,a)=>{const r=o("n-tag"),t=o("n-space"),u=o("n-card");return f(),w("div",null,[e(u,{title:"Access Control"},{default:s(()=>[e(t,null,{default:s(()=>[(f(!0),w(O,null,E(c(l),d=>(f(),L(r,{key:d},{default:s(()=>[b(P(d),1)]),_:2},1024))),128))]),_:1})]),_:1})])}}}),ie={class:"flex gap-3"},ce={class:"flex-1"},ue={class:"flex-2"},ye=C({__name:"ProfileView",setup(i){const{email:l}=S(),n=W(!1),a=r=>{n.value=r};return Y({title:`Profile -  ${l}`,meta:[{name:"description",content:"Halaman dashboard aplikasi"}]}),(r,t)=>{const u=o("n-space"),d=o("n-modal");return f(),w("div",null,[g("div",ie,[g("div",ce,[e(u,{vertical:"",size:"large"},{default:s(()=>[e(ee,{onChangePassword:t[0]||(t[0]=m=>a(!0))}),e(le)]),_:1})]),g("div",ue,[e(re)])]),e(d,{show:n.value,"onUpdate:show":t[2]||(t[2]=m=>n.value=m),closable:!0,title:"Change Your Password",preset:"card",style:{width:"600px"}},{default:s(()=>[e(ae,{onSubmitted:t[1]||(t[1]=m=>a(!1))})]),_:1},8,["show"])])}}});export{ye as default};
