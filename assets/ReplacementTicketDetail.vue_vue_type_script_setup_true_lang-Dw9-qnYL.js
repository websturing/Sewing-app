import{_ as G}from"./BaseButton.vue_vue_type_script_setup_true_lang-6gotNCYT.js";import{d as A,c as r,o as l,a as e,L as $,e as s,f as g,t as u,g as d,p as V,r as B,s as M,k as N,l as R,w as m,F as z,H as S,G as U,x as j}from"./index-gyip3Da5.js";import{d as E,a as Q,F as O,C as J,P as q,b as K,T as X,c as Y,I as Z}from"./IosSync-sCuO5KOP.js";import{u as ee}from"./replacement.store-CoMKGJe-.js";import{B as te}from"./BrandAirtable-Db38xdY0.js";import{H as se}from"./History-s4Bic8pm.js";const y=A({__name:"BaseIconWithLabel",props:{icon:{},label:{},size:{default:18},labelClass:{default:"text-xs"},textColor:{default:"text-gray-400"}},setup(p){const t=p;return(n,o)=>{const w=g("n-icon");return l(),r("div",null,[e("div",{class:$(["flex items-center gap-2 text-xs",t.textColor])},[s(w,{component:t.icon,size:t.size},null,8,["component","size"]),e("p",{class:$([t.labelClass])},u(t.label),3)],2)])}}}),le=A({__name:"ProfileHeader",props:{email:{}},setup(p){return(t,n)=>(l(),r("div",null,[s(y,{icon:d(E),size:24,label:t.email},null,8,["icon","label"])]))}});function ae(){const p=V(),t=ee(),n=B(!1),o=B(""),w=B(null),k=B([]),{replacementList:x,remoteSearchResult:P,meta:a,links:i}=M(t),T=N(()=>o.value?P.value??C.value:C.value),C=N(()=>{const f=o.value?.toLowerCase();return f?x.value.filter(b=>{const h=b.glNo?.toLowerCase().includes(f),_=b.serialNumber?.toLowerCase().includes(f),L=b.defectList?.some(H=>H.color?.toLowerCase().includes(f));return h||_||L}):x.value}),F=async(f=!1,b)=>{n.value=!0;const h=Date.now(),{success:_,message:L}=await t.fetchReplacementListPagination(b),H=Date.now()-h,I=400;return H<I&&await new Promise(W=>setTimeout(W,I-H)),f&&(_?p.success(L):p.error(L)),n.value=!1,{success:_,message:L}},D=async()=>{if(!o.value.trim()){t.clearRemoteSearchResult();return}C.value.length>0||await F(!1,{search:o.value})},c=f=>{w.value=C.value[f]},v=async(f=!1,b)=>{n.value=!0;const{success:h,message:_}=await t.fetchReplacementApprovalPagination(b);return f&&(h?p.success(_):p.error(_)),n.value=!1,{success:h,message:_}};return{selectedReplacementItem:w,isLoading:n,meta:a,links:i,searchReplacementList:o,replacementListFilter:T,replacementList:x,timelineHistories:k,handleFetchReplacementListPagination:F,handleSearchReplacementList:D,selectReplacementItem:c,handleFetchReplacementApprovalPagination:v,handleSearchReplacementApprovalList:async()=>{if(!o.value.trim()){t.clearRemoteSearchResult();return}C.value.length>0||await v(!1,{search:o.value})},handleFetchHistoriesByReplacementId:async(f=!1,b)=>{n.value=!0;const{success:h,message:_,data:L}=await t.fetchHistoriesByReplacementId(b);return f&&(h?p.success(_):p.error(_)),n.value=!1,k.value=L,{success:h,message:_}}}}const ne={class:"px-4"},oe={class:"flex flex-col"},re={key:0,class:"flex flex-col gap-2"},ie={key:1,class:"flex flex-col gap-2"},ce={class:"flex justify-between"},de={class:"flex gap-2 items-center text-sm text-gray-400"},ue={class:"flex"},me={class:"flex flex-col"},pe={class:"flex flex-col gap-2"},fe=A({__name:"WorkflowTimeline",props:{workflow:{},currentStep:{},isLoading:{type:Boolean,default:!0},statusTicket:{default:"In Progress"}},setup(p){const t=p,n=o=>o.isApproved&&t.currentStep>o.stepOrder?{type:"success",title:"Approved",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!0,titleClass:"font-semibold text-black",roleClass:"text-sm text-black"}:o.isFinal&&o.stepOrder===t.currentStep?{type:"success",title:"Completed",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!1,titleClass:"font-semibold text-black",roleClass:"text-sm text-orange-400"}:o.stepOrder===t.currentStep&&t.statusTicket==="In Progress"?{type:"warning",title:"Progress",class:"inline-flex px-2 py-0.5 items-center bg-yellow-100",done:!1,titleClass:"font-semibold text-orange-400",roleClass:"text-sm text-orange-400"}:o.stepOrder===t.currentStep&&t.statusTicket==="Rejected"?{type:"error",title:"Rejected",class:"inline-flex px-2 py-0.5 items-center bg-red-100",done:!1,titleClass:"font-semibold text-red-400",roleClass:"text-sm text-red-400"}:{type:"Waiting",title:"Waiting",class:"inline-flex px-2 py-0.5 items-center bg-gray-100",done:!1,titleClass:"font-regular text-gray-400",roleClass:"text-sm text-gray-400"};return(o,w)=>{const k=g("n-icon"),x=g("n-skeleton"),P=g("n-timeline-item"),a=g("n-timeline");return l(),r("div",ne,[t.isLoading?(l(),R(a,{key:1},{default:m(()=>[(l(),r(z,null,S(6,(i,T)=>s(P,{key:i},{icon:m(()=>[s(k,{size:22},{default:m(()=>[s(d(q))]),_:1})]),default:m(()=>[e("div",me,[e("div",pe,[s(x,{width:"40%",text:""}),s(x,{width:"15%",text:""}),s(x,{width:"5%",text:""})])])]),_:2},1024)),64))]),_:1})):(l(),R(a,{key:0},{default:m(()=>[(l(!0),r(z,null,S(t.workflow,i=>(l(),R(P,{key:i.stepOrder,type:n(i).type},{icon:m(()=>[s(k,{size:22},{default:m(()=>[n(i).done?(l(),R(d(J),{key:0})):(l(),R(d(q),{key:1}))]),_:2},1024)]),default:m(()=>[e("div",oe,[t.isLoading?(l(),r("div",re,[s(x,{width:"30%",text:""}),s(x,{width:"10%",text:""})])):(l(),r("div",ie,[e("div",ce,[e("p",{class:$(n(i).titleClass)},u(i.workflowName),3)]),e("div",de,[s(y,{icon:d(Q),label:i.createdAt??"-",size:14},null,8,["icon","label"]),s(y,{icon:d(O),label:i.createdBy,size:16},null,8,["icon","label"])]),e("div",ue,[e("div",{class:$(["text-xs text-gray-500",n(i).class])},u(n(i).title),3)])]))])]),_:2},1032,["type"]))),128))]),_:1}))])}}}),_e={class:"flex flex-col gap-5"},xe={class:"flex justify-between"},ge={class:"flex flex-col gap-1"},be={class:"text-xl font-bold"},he={class:"flex gap-2"},ye={class:"text-sm"},ve={class:"text-sm"},we={class:"flex items-center gap-2"},ke={class:"text-sm"},Ce={class:"flex gap-5 justify-between items-center"},Le={class:"flex gap-5 items-center"},Re=["colspan"],ze={class:"!text-center !bg-white"},Se={class:"!text-center !text-red-400"},$e={class:"!text-center !font-bold !text-red-400"},Pe={class:"flex flex-col text-xs gap-1"},Be={class:"text-gray-400"},Te={class:"mt-2"},Fe={key:1,class:"text-gray-400"},We=A({__name:"ReplacementTicketDetail",props:{data:{},isLoading:{type:Boolean,default:!1}},setup(p){const t=p,n=B(!1),{timelineHistories:o,isLoading:w,handleFetchHistoriesByReplacementId:k}=ae(),x=async()=>{n.value=!0,k(!1,t.data.id)};return(P,a)=>{const i=g("n-card"),T=g("n-table"),C=g("n-blockquote"),F=g("n-scrollbar"),D=g("n-modal");return l(),r("div",null,[s(i,{class:"shadow-xs"},{default:m(()=>[e("div",_e,[e("div",xe,[e("div",ge,[e("p",be,"GL-"+u(t.data.glNo),1),e("div",he,[e("div",{class:"shadow-sm border border-gray-200 rounded",style:U({background:t.data.workflow?.color,padding:"4px 8px",borderRadius:"3px"})},[e("p",ye," Location : "+u(t.data.workflow?.current),1)],4),e("div",{class:$(["shadow-sm border border-gray-300  rounded px-2 py-0.5 items-center inline-flex",t.data.status.class])},[e("p",ve," Status : "+u(t.data.status.name),1)],2)])]),e("div",we,[e("table",ke,[e("tr",null,[e("td",null,[s(y,{icon:d(O),label:"Requested by",size:20},null,8,["icon"])]),a[1]||(a[1]=e("td",null,"  :  ",-1)),e("td",null,u(t.data.requestedBy),1)]),e("tr",null,[e("td",null,[s(y,{icon:d(K),label:"Requested Date",size:20},null,8,["icon"])]),a[2]||(a[2]=e("td",null,"  :  ",-1)),e("td",null,u(t.data.createdAt),1)])])])]),e("div",null,[s(i,{class:"shadow-xs border !border-gray-200"},{default:m(()=>[e("div",Ce,[e("div",Le,[s(y,{icon:d(te),label:`Line ${t.data.lineNames.join(",")}`,size:20,labelClass:"text-sm text-black font-semibold"},null,8,["icon","label"]),s(y,{icon:d(X),label:`Total Sizes : ${t.data.totalSize}`,size:20,labelClass:"text-sm text-black font-semibold"},null,8,["icon","label"]),s(y,{icon:d(Y),label:`Total Defect : ${t.data.defectTotal}`,size:19,labelClass:"text-sm text-red-400 font-semibold"},null,8,["icon","label"]),s(G,{icon:d(se),label:"Process History",size:"small",onClick:x},null,8,["icon"])]),e("div",null,[s(y,{icon:d(Z),label:`Last Updated : ${t.data.updatedAt}`,size:19,labelClass:"text-sm italic text-gray-400"},null,8,["icon","label"])])])]),_:1})]),e("div",{class:$([t.data.defectList.length>1?"grid grid-cols-1 sm:grid-cols-2 gap-4":"grid grid-cols-1 gap-4","bg-gray-50 border border-gray-200 rounded-lg p-2"])},[(l(!0),r(z,null,S(t.data.defectList,c=>(l(),r("div",{key:c.color,class:"!w-full !min-w-0"},[s(T,{class:"!border !border-gray-200 !w-full"},{default:m(()=>[e("thead",null,[e("tr",null,[a[3]||(a[3]=e("th",{class:"!bg-white"},"Color",-1)),e("th",{colspan:(c.sizeList.length??0)+1,class:"!text-center !bg-white !text-blue-600 !font-semibold"},u(c.color),9,Re)]),e("tr",null,[a[4]||(a[4]=e("th",{class:"!bg-white"},"Size",-1)),(l(!0),r(z,null,S(c.sizeList,v=>(l(),r("th",ze,u(v.size),1))),256)),a[5]||(a[5]=e("th",{class:"!bg-white !text-center"},"Total",-1))])]),e("tbody",null,[e("tr",null,[a[6]||(a[6]=e("td",null,"Defect",-1)),(l(!0),r(z,null,S(c.sizeList,v=>(l(),r("td",Se,u(v.defectQty),1))),256)),e("td",$e,u(c.totalDefect),1)])])]),_:2},1024)]))),128))],2),e("div",null,[s(F,{style:{"max-height":"350px"}},{default:m(()=>[a[7]||(a[7]=e("p",{class:"font-semibold mb-5"},"Notes",-1)),(l(!0),r(z,null,S(t.data.notes,(c,v)=>(l(),r("div",null,[c.note?(l(),R(C,{key:0},{default:m(()=>[e("div",Pe,[s(le,{email:c.createdBy},null,8,["email"]),e("p",Be,u(c.createdAt),1)]),e("p",Te,u(c.note),1)]),_:2},1024)):j("",!0),v==t.data.notes.length-1&&c.note==null?(l(),r("p",Fe," Notes are not available for this request. ")):j("",!0)]))),256))]),_:1})])])]),_:1}),s(D,{show:n.value,"onUpdate:show":a[0]||(a[0]=c=>n.value=c),preset:"card",style:"width: 600px",title:`GL-${t.data.glNo?.toString()}`},{default:m(()=>[s(fe,{workflow:d(o),currentStep:t.data.currentStep,isLoading:d(w),statusTicket:t.data.status.name},null,8,["workflow","currentStep","isLoading","statusTicket"])]),_:1},8,["show","title"])])}}});export{We as _,ae as u};
