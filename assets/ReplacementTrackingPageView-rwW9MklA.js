import{_ as ee}from"./BaseInput.vue_vue_type_script_setup_true_lang-C4zdXy1y.js";import{_ as N}from"./BaseIconWithLabel.vue_vue_type_script_setup_true_lang-DyK7j_Xf.js";import{C as te,F as se}from"./FolderPerson16Regular-swM86aN5.js";import{d as I,r as x,q as H,c as P,e as o,f as v,w as h,o as S,a as r,F as re,H as ne,l as le,L as q,t as k,g as m,J as ae,p as oe,I as ce,m as j}from"./index-KKLjXh5o.js";import{u as ie}from"./replacement.store-Fxgg6xgP.js";import{S as ue,I as de}from"./InsightsRound-CsEkuS6F.js";import{S as fe}from"./SmartHome-CoCWvi5q.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./defect.summaryApi-Bar6lMpN.js";import"./types-CVZIcfwR.js";import"./metaPagination-BMwnZfrC.js";import"./api.schema-B7NsqcGR.js";const me={class:"px-4"},pe={class:"flex gap-3 pb-3",style:{"min-width":"max-content"}},ge={class:"flex flex-col gap-2"},_e={class:"flex"},xe={class:"flex flex-col gap-1 text-gray-500"},ye=280,be=12,we=I({__name:"WorkflowTimelineCard",props:{workflow:{},currentStep:{},isLoading:{type:Boolean,default:!0},statusTicket:{default:"In Progress"}},setup(c){const e=c,l=x(null),n=new Map,a=(t,f)=>{t?.$el&&n.set(f,t.$el)},s=t=>t===e.currentStep,i=()=>{ae(()=>{if(!l.value)return;const t=e.currentStep-1,f=Math.max(0,t*(ye+be)-100);l.value.scrollTo({left:f,behavior:"smooth"})})};H(()=>e.workflow,t=>{t.length>0&&setTimeout(i,150)},{immediate:!0}),H(()=>e.currentStep,()=>{i()});const u=t=>t.isApproved&&e.currentStep>t.stepOrder?{type:"success",title:"Approved",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!0,titleClass:"font-semibold text-black",roleClass:"text-sm text-black"}:t.isFinal&&t.stepOrder===e.currentStep?{type:"success",title:"Completed",class:"inline-flex px-2 py-0.5 items-center bg-green-100",done:!1,titleClass:"font-semibold text-black",roleClass:"text-sm text-orange-400"}:t.stepOrder===e.currentStep&&e.statusTicket==="In Progress"?{type:"warning",title:"Progress",class:"inline-flex px-2 py-0.5 items-center bg-yellow-100",done:!1,titleClass:"font-semibold text-orange-400",roleClass:"text-sm text-orange-400"}:t.stepOrder===e.currentStep&&e.statusTicket==="Rejected"?{type:"error",title:"Rejected",class:"inline-flex px-2 py-0.5 items-center bg-red-100",done:!1,titleClass:"font-semibold text-red-400",roleClass:"text-sm text-red-400"}:{type:"Waiting",title:"Waiting",class:"inline-flex px-2 py-0.5 items-center bg-gray-100",done:!1,titleClass:"font-regular text-gray-400",roleClass:"text-sm text-gray-400"};return(t,f)=>{const C=v("n-card"),T=v("n-scrollbar");return S(),P("div",me,[o(T,{ref_key:"scrollbarRef",ref:l,"x-scrollable":"",style:{"max-width":"100%"}},{default:h(()=>[r("div",pe,[(S(!0),P(re,null,ne(e.workflow,d=>(S(),le(C,{key:d.stepOrder,ref_for:!0,ref:O=>a(O,d.stepOrder),class:q(["!w-[280px] !min-w-[280px] transition-all duration-300",s(d.stepOrder)?"!border-2 !border-orange-400 !shadow-lg":"!border !border-gray-200"])},{default:h(()=>[r("div",ge,[r("p",{class:q(u(d).titleClass)},k(d.workflowName),3),r("div",_e,[r("div",{class:q(["text-xs rounded",u(d).class])},k(u(d).title),3)]),r("div",xe,[o(N,{icon:m(te),label:d.createdAt??"-",size:14},null,8,["icon","label"]),o(N,{icon:m(se),label:d.createdBy??"-",size:16},null,8,["icon","label"])])])]),_:2},1032,["class"]))),128))])]),_:1},512)])}}});let _;const ve=()=>{const c=x(!1),e=x(null),l=x(null);_=oe();const n=new Map,a=x(null);let s=null,i=null,u=null;const t=async(p,B={})=>{const{minLoadingTime:z=500,notify:R=!1,showLoadingToast:G=!1,loadingMessage:J="Loading...",retryAttempts:L=0,retryDelay:U=1e3,manualRetry:$=!1,cache:E=!1,cacheTime:K=300*1e3,onSuccess:V,onError:W,onRetry:Q,onCancel:X,abortSignal:Y}=B;i=p,u=B;const A=E?p.toString():"";if(E&&A){const y=n.get(A);if(y&&Date.now()-y.timestamp<K)return l.value=y.data,R&&_.success("Data loaded from cache"),V?.(y.data),y.data}c.value=!0,e.value=null,Y||(a.value=new AbortController),G&&(s=_.loading(J,{duration:0,closable:!0,onClose:()=>{T(),X?.()}}));let F="";try{const y=$?1:L+1;for(let w=0;w<y;w++)try{const[D]=await Promise.all([p(),new Promise(Z=>setTimeout(Z,z))]),{success:b,message:g,data:M}=D;if(b)return l.value=M,E&&A&&n.set(A,{data:M,timestamp:Date.now()}),R&&_.success(g||"Success!"),V?.(M),M;e.value=g,F=g,$?f(g):w===L&&(R&&_.error(g),W?.(g))}catch(D){if(D.name==="AbortError")return e.value="Request was cancelled",null;const b=D.message||"An unexpected error occurred.";if(F=b,!$&&w<L){e.value=null,Q?.(w+1),R&&_.warning(`Retrying... (${w+1}/${L})`),await new Promise(g=>setTimeout(g,U));continue}e.value=b,$?f(b):(R&&_.error(b),W?.(b))}return null}finally{c.value=!1,s&&(s.destroy(),s=null)}},f=p=>{_.error(p,{duration:1500,closable:!0})},C=async()=>!i||!u?(console.warn("No previous request to retry"),null):await t(i,u),T=()=>{a.value&&(a.value.abort(),a.value=null,c.value=!1),s&&(s.destroy(),s=null)};return{isLoading:c,error:e,data:l,execute:t,retry:C,cancel:T,clearCache:p=>{p?n.delete(p):n.clear()},reset:()=>{c.value=!1,e.value=null,l.value=null,T()}}};function he(){const c=ie(),{isLoading:e,error:l,data:n,execute:a}=ve(),s=x([]);return{isLoading:e,error:l,data:n,fetchTrackingData:async u=>await a(()=>c.fetchTicketTrackBySerial(u),{notify:!1,showLoadingToast:!0,loadingMessage:`Searching for ${u}...`,minLoadingTime:500,retryAttempts:2,retryDelay:1500,manualRetry:!0,onSuccess:t=>{s.value=t.timeline}}),workflow:s}}const ke={class:"flex flex-col gap-5"},Ce=I({__name:"ReplacementTracking",setup(c){const e=x("SWA-REPLACEMENT-20251208141755-65830-01"),{isLoading:l,error:n,fetchTrackingData:a,workflow:s}=he(),i=()=>{a(e.value||"")};return(u,t)=>{const f=v("n-card");return S(),P("div",ke,[o(f,{class:"!bg-gray-50 !border !border-gray-200"},{default:h(()=>[r("div",null,[o(ee,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=C=>e.value=C),icon:m(ue),placeholder:"Search Replacement Request",onEnter:i,loading:m(l)},null,8,["modelValue","icon","loading"])])]),_:1}),r("div",null,[t[1]||(t[1]=r("p",{class:"font-semibold text-lg"},"Replacement Request Workflow",-1)),r("p",null,"Track the steps and status for Ticket : "+k(e.value),1),r("p",null,k(m(n)),1)]),o(we,{workflow:m(s),isLoading:m(l),currentStep:2},null,8,["workflow","isLoading"])])}}}),Te={class:"flex flex-col gap-10"},Re={class:"flex justify-between items-center"},Se={class:"w-84 flex-auto"},Le={class:"text-xl font-bold mb-1"},$e={class:"w-16 flex-auto text-right"},He=I({__name:"ReplacementTrackingPageView",setup(c){const e=x({title:"Track Request Status & Progress",description:"Monitor the current stage, real-time status, and detailed progress history of your replacement requests."});return ce({title:e.value.title,meta:[{name:"description",content:e.value.description}]}),(l,n)=>{const a=v("n-icon"),s=v("n-breadcrumb-item"),i=v("n-breadcrumb");return S(),P("div",Te,[r("div",Re,[r("div",Se,[r("h2",Le,k(e.value.title),1),r("p",null,k(e.value.description),1)]),r("div",$e,[o(i,null,{default:h(()=>[o(s,null,{default:h(()=>[o(a,{component:m(fe)},null,8,["component"]),n[0]||(n[0]=j(" Home",-1))]),_:1}),o(s,null,{default:h(()=>[o(a,{component:m(de)},null,8,["component"]),n[1]||(n[1]=j(" Track Replacement Request ",-1))]),_:1})]),_:1})])]),o(Ce)])}}});export{He as default};
