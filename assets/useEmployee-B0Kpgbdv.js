import{D as G,E as C,p as I,s as A,r as N,y as J,q as O,d as W,c as Y,o as _,a as n,x as q,e as u,g as l,n as g,f as F,L as H,w as T,m as K,t as X,l as Z,M as ee,v as se,h as te}from"./index-D9MKkV31.js";import{t as ae,I as L}from"./vee-validate-zod-DnnkVXK4.js";import{S as oe}from"./SaveAnnotation-dQH_obV9.js";import{Q as re}from"./QrCode20Filled-COkXmqOq.js";import{A as i}from"./api.schema-BwRGpLBP.js";import{E as le,a as ne,b as ie}from"./employeeSchema-BY4Ew02x.js";import{u as de}from"./useFieldWrapper-D-5lxAwI.js";import{d as U}from"./dayjs.min-lasCq60O.js";import{u as me}from"./vee-validate-DkEPkXFH.js";const z=G("employee",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:"",employeeLastCode:""}),actions:{async fetchEmployee(e={}){this.loading=!0,this.error=null;try{const s={page:e.page??1,perPage:e.perPage??10,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};e.q&&(this.searchResult=[],this.isSearching=!0);const t=await C.get("/api/employee",{params:s}),a=ne.parse(t.data);return this.meta=a.meta,this.links=a.links,this.currentPage=a.meta.currentPage,this.lastPage=a.meta.lastPage,e.q?this.searchResult=a.data:(this.data=a.data,this.isSearching=!1,this.searchResult=[]),i.parse({success:!0,message:a.message??"Employees loaded"})}catch(s){const t=s?.response?.data?.message||"Something went wrong";return this.error=t,i.parse({success:!1,message:t})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetchEmployee(),this.data;const s=this.data.filter(a=>a.employeeCode?.toLowerCase().includes(e)||a.department?.toLowerCase().includes(e)||a.position?.toLowerCase().includes(e));return s.length>0?(this.searchResult=s,this.isSearching=!0,s):(await this.fetchEmployee({page:1,q:e})).success?this.searchResult:[]},async fetchEmployeeLastCode(){this.loading=!0,this.error=null;try{const e=await C.get("/api/employee/code"),s=le.parse(e.data);return this.employeeLastCode=s.data,i.parse({success:!0,message:s.message??"Employees loaded"})}catch(e){const s=e?.response?.data?.message||"Something went wrong";return this.error=s,i.parse({success:!1,message:s})}finally{this.loading=!1}},async createEmployee(e){this.loading=!0,this.error=null;try{const s=await C.post("/api/employee",e);return this.data.push(s.data.data),this.error=null,i.parse({success:!0,message:s.data.message??"Employees loaded",id:s.data.data.id})}catch(s){const t=s?.response?.data?.message||"Terjadi kesalahan";return this.error=t,i.parse({success:!1,message:t})}finally{this.loading=!1}},async updateEmployee(e,s){this.loading=!0,this.error=null;try{const t=await C.post(`/api/employee/${e}`,s),a=this.data.findIndex(y=>y.id===e);return a!==-1&&(this.data[a]={...this.data[a],...t.data.data}),this.error=null,i.parse({success:!0,message:t.data.message??"Employee Update Successfully"})}catch(t){const a=t?.response?.data?.message||"Terjadi kesalahan";return this.error=a,i.parse({success:!1,message:a})}finally{this.loading=!1}},async deleteEmployee(e){this.loading=!0,this.error=null;try{const s=await C.delete(`/api/employee/${e}`);return this.data=this.data.filter(t=>t.id!==e),this.error=null,i.parse({success:!0,message:s.data.message??"Employees loaded"})}catch(s){const t=s?.response?.data?.message||"Terjadi kesalahan";return this.error=t,i.parse({success:!1,message:t})}finally{this.loading=!1}}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const s=e.search.toLowerCase();return e.data.filter(t=>t.employeeCode?.toLowerCase().includes(s)||t.department?.toLowerCase().includes(s)||t.position?.toLowerCase().includes(s))}}});function Q(e=null){const s=I(),t=z(),{data:a}=A(t),y=N(U().subtract(17,"year").format("YYYY-MM-DD")),c=()=>({employeeCode:e?.employeeCode??"",name:e?.name??"",gender:e?.gender??"male",dateBirth:e?.dateBirth??y.value,joinDate:e?.joinDate??U().format("YYYY-MM-DD"),position:e?.position??"",department:e?.department??"",active:e?.active??!0,id:e?.id,userId:e?.userId,device_id:e?.device_id,createdAt:e?.createdAt}),{handleSubmit:p,errors:v,isSubmitting:d,resetForm:m,validate:b}=me({validationSchema:ae(ie),initialValues:c()}),E=()=>{m({values:c(),errors:{}})},{employeeCode:f,position:R,department:k,active:w,name:S,gender:o,dateBirth:B,joinDate:x}=de(["employeeCode","name","gender","dateBirth","joinDate","position","department","active"]),j=async()=>{const h=await b();return h.valid?{valid:!0,values:h.values}:{valid:!1}},M=p(h=>h),r=async(h,P)=>{const{success:V,message:D}=await t.updateEmployee(h,P);V?s.success(D):s.error(D)},$=async h=>{const{success:P,message:V}=await t.deleteEmployee(h);P?s.success(V):s.error(V)};return J(async()=>{e?.employeeCode||(await t.fetchEmployeeLastCode(),f.value=t.employeeLastCode)}),O(()=>e,()=>E(),{deep:!0,immediate:!0}),{employeeCode:f,name:S,gender:o,dateBirth:B,joinDate:x,position:R,department:k,active:w,onSubmit:p,resetForm:E,updateEmployee:r,deleteEmployee:$,data:a,errors:v,isSubmitting:d,validateForm:j,submitForm:M}}const ue={class:"flex flex-col gap-3"},ce={class:"flex gap-2"},pe={class:"w-30"},he={class:"w-40"},ye={class:"flex gap-2"},Ve=W({__name:"EmployeeForm",props:{initialData:{},submitLabel:{default:"Create Employee"},submitType:{default:"default"},placmentEnd:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},icon:{default:oe}},emits:["click:submitted"],setup(e,{expose:s,emit:t}){const a=e,y=t,{employeeCode:c,name:p,gender:v,dateBirth:d,joinDate:m,position:b,department:E,errors:f,validateForm:R,onSubmit:k}=Q(a.initialData),w=k(S=>{y("click:submitted",S)});return s({name:p,validateForm:R,submit:w}),(S,o)=>{const B=F("n-select"),x=F("n-date-picker"),j=F("n-icon"),M=F("n-button");return _(),Y("div",null,[n("form",{onSubmit:o[7]||(o[7]=se((...r)=>l(w)&&l(w)(...r),["prevent"]))},[n("div",ue,[n("div",null,[u(L,{icon:l(re),modelValue:l(c),"onUpdate:modelValue":o[0]||(o[0]=r=>g(c)?c.value=r:null),name:"employeeCode",errors:l(f),readonly:!0,label:"Employee Code",classContent:"!bg-gray-100 !w-45"},null,8,["icon","modelValue","errors"])]),n("div",ce,[u(L,{modelValue:l(p),"onUpdate:modelValue":o[1]||(o[1]=r=>g(p)?p.value=r:null),name:"name",errors:l(f),label:"Employee Name",placeholder:"Please type name",class:"w-200"},null,8,["modelValue","errors"]),n("div",pe,[o[8]||(o[8]=n("label",{for:"gender",class:"text-sm font-medium text-gray-700"}," Gender ",-1)),u(B,{style:{"margin-top":"3px"},id:"gender",size:"medium",value:l(v),"onUpdate:value":o[2]||(o[2]=r=>g(v)?v.value=r:null),options:[{value:"male",label:"Male"},{value:"female",label:"Female"}]},null,8,["value"])]),n("div",he,[o[9]||(o[9]=n("label",{for:"dateBirth",class:"text-sm font-medium text-gray-700"}," Date Birth ",-1)),u(x,{id:"dateBirth",style:{"margin-top":"3px"},"formatted-value":l(d),"onUpdate:formattedValue":o[3]||(o[3]=r=>g(d)?d.value=r:null),"value-format":"yyyy-MM-dd",type:"date"},null,8,["formatted-value"])])]),n("div",ye,[n("div",null,[o[10]||(o[10]=n("label",{for:"joinDate",class:"text-sm font-medium text-gray-700"}," Join Date ",-1)),u(x,{id:"joinDate",style:{"margin-top":"3px"},"formatted-value":l(m),"onUpdate:formattedValue":o[4]||(o[4]=r=>g(m)?m.value=r:null),"value-format":"yyyy-MM-dd",type:"date"},null,8,["formatted-value"])]),u(L,{modelValue:l(b),"onUpdate:modelValue":o[5]||(o[5]=r=>g(b)?b.value=r:null),name:"position",errors:l(f),label:"Position",placeholder:"Please type position employee"},null,8,["modelValue","errors"]),u(L,{modelValue:l(E),"onUpdate:modelValue":o[6]||(o[6]=r=>g(E)?E.value=r:null),name:"department",errors:l(f),label:"Department",placeholder:"Please type department employee"},null,8,["modelValue","errors"])]),a.visible?(_(),Y("div",{key:0,class:H([a.placmentEnd?"justify-end":"","flex gap-2 mt-10"])},[n("div",null,[u(M,{type:a.submitType,"icon-placement":"right","attr-type":"submit",block:""},{icon:T(()=>[u(j,null,{default:T(()=>[(_(),Z(ee(a.icon)))]),_:1})]),default:T(()=>[K(" "+X(a.submitLabel),1)]),_:1},8,["type"])])],2)):q("",!0)])],32)])}}});function Fe(){const e=N({title:"Employees",description:"The Employee module provides a centralized space to manage workforce data, including personal information, job details, and access rights. It enables administrators to add, update, and organize employee records efficiently while ensuring accurate and secure handling of sensitive information."}),s=z(),t=I(),a=te(),{data:y}=A(s),{resetForm:c}=Q();return{meta:e,data:y,handleFetchEmployee:async()=>{const{success:d,message:m}=await s.fetchEmployee();d||t.error(m)},handleCreateEmployee:async d=>{const{message:m}=await s.createEmployee(d);t.success(m),c(),a.push({name:"employee"})}}}export{Ve as _,Fe as a,Q as b,z as u};
