import{r as m,d as W,q as H,c as $,o as D,a as n,v as q,g as e,x as se,e as o,n as I,L as U,f as y,w as r,m as V,t as L,l as ne,M as le,O as re,P as ie,h as ue,k as me,y as ce,I as pe}from"./index-DdZqzgYp.js";import{_ as B}from"./BaseButton.vue_vue_type_script_setup_true_lang-B2zrozXY.js";import{_ as de}from"./ProgressModal.vue_vue_type_script_setup_true_lang-CLAfHBEU.js";import{_ as fe}from"./SelectLabelWithError.vue_vue_type_script_setup_true_lang-d7Bv589l.js";import{u as ve,a as M,_ as ye}from"./useEmployee-Dn4y_sOX.js";import{u as be}from"./useRoleTable-X_beLCTe.js";import{u as _e,a as ge}from"./user.form-Cpyq8hpK.js";import{I as j,a as we}from"./vee-validate-zod-CZ9ob7vP.js";import{S as z}from"./SaveAnnotation-BaJaWK0a.js";import{u as xe,a as Ce}from"./vee-validate-DnOYitGX.js";import{U as O,A as Ee,N as he}from"./UserAddOutlined-qzslnYyp.js";import{S as ke}from"./SmartHome-Dgf1LhUS.js";import{C as Fe}from"./QrCode20Filled-Bg0dl_ux.js";import{F as Se}from"./FormNew28Regular-BW9vSJoL.js";import{o as De,a as Ue,s as Ve}from"./types-D48y91Ee.js";import"./DocumentError16Filled-agJfXpnn.js";import"./EyeOutline-DCvke_pR.js";import"./api.schema-BwRGpLBP.js";import"./employeeSchema-BY4Ew02x.js";import"./useFieldWrapper-BxIkTl4T.js";import"./dayjs.min-lasCq60O.js";import"./_commonjsHelpers-CE1G-McA.js";import"./Role-Ke8lKof5.js";import"./Trash-S2QUP0yr.js";import"./user.schema-DUhrVGkL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Ne(k){const i=m(1),g=m("process");return{current:i,currentStatus:g,next:async s=>{const a=i.value-1;s[a]&&!await s[a]()||i.value<k&&i.value++},prev:()=>{i.value>1&&i.value--}}}const Te={class:"flex gap-2"},Ae=W({__name:"UserForm",props:{initialData:{},isEdit:{type:Boolean,default:!1},submitLabel:{default:"Create Employee"},submitType:{default:"default"},placmentEnd:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},icon:{default:z}},emits:["click:submitted"],setup(k,{expose:i,emit:g}){const F=g,c=m(!1),s=k,{name:a,email:u,errors:w,validateForm:x,onSubmit:C}=_e(s.initialData),b=C(p=>{F("click:submitted",p)});return H(()=>s.initialData,p=>{p?a.value=p.name:s.isEdit&&(a.value=""),c.value=!0},{deep:!0}),i({name:a,validateForm:x,submit:b}),(p,d)=>{const N=y("n-icon"),T=y("n-button");return D(),$("div",null,[n("form",{onSubmit:d[2]||(d[2]=q((...v)=>e(b)&&e(b)(...v),["prevent"]))},[n("div",Te,[o(j,{name:"name",errors:e(w),label:"Name",modelValue:e(a),"onUpdate:modelValue":d[0]||(d[0]=v=>I(a)?a.value=v:null),readonly:c.value,classContent:"!bg-gray-100"},null,8,["errors","modelValue","readonly"]),o(j,{name:"email",errors:e(w),label:"Email",modelValue:e(u),"onUpdate:modelValue":d[1]||(d[1]=v=>I(u)?u.value=v:null)},null,8,["errors","modelValue"])]),s.visible?(D(),$("div",{key:0,class:U([s.placmentEnd?"justify-end":"","flex gap-2 mt-10"])},[n("div",null,[o(T,{type:s.submitType,"icon-placement":"right","attr-type":"submit",block:""},{icon:r(()=>[o(N,null,{default:r(()=>[(D(),ne(le(s.icon)))]),_:1})]),default:r(()=>[V(" "+L(s.submitLabel),1)]),_:1},8,["type"])])],2)):se("",!0)],32)])}}}),Pe={class:"flex flex-col gap-10"},Re={class:"bg-gray-50 p-5 rounded-md"},Be={class:"flex justify-between items-center"},$e={class:"w-84 flex-auto"},Ie={class:"text-xl font-bold mb-1"},Le={class:"w-16 flex-auto text-right"},Me={class:"p-5 flex flex-col gap-10"},je={class:"mt-5 mb-10"},Oe={class:"flex justify-end gap-3"},vt=W({__name:"EmployeeFormView",setup(k){const i=ue(),g=ge(),F=ve(),{meta:c}=M(),s=m(!1),a=re({title:"Creating Employee Personal Detail",description:"Please wait while we are creating the new record. This may take a few seconds.",error:!1}),u=m(),w=m(),x=m({}),C=m({}),b=ie(),p=m({name:"",email:"",roleNames:[]}),{handleCreateEmployee:d}=M(),N=we(De({roles:Ue(Ve()).min(1,"Pilih minimal 1 role")})),{errors:T,handleSubmit:v,validate:Q}=xe({validationSchema:N}),A=v(async()=>{a.error=!1,C.value.roleNames=S.value;const{id:l,success:t,message:E}=await g.create(C.value);if(!t){a.title=E,a.error=!0;return}a.title="creating Employee Account",x.value.userId=l;const{success:h,message:P}=await F.createEmployee(x.value);if(!h){a.title=P,a.error=!0;return}setTimeout(()=>{s.value=!1,i.push({name:"employee"})},3e3)}),{value:S}=Ce("roles",void 0,{initialValue:[]}),{fnRefresh:G,data:Y}=be(),J=me(()=>Y.value.map(l=>({value:l.name,label:l.name}))),{current:f,currentStatus:K,next:X,prev:Z}=Ne(3),ee=[async()=>{const{valid:l,values:t}=await u.value?.validateForm();return l?(x.value=t,!0):!1},async()=>{const{valid:l,values:t}=await w.value?.validateForm();return l?(C.value=t,!0):!1},async()=>{const{valid:l}=await Q();return l?(b.success({title:"Confirmation Create Employee",content:"Are you sure you want to create this record? Please review the details before proceeding.",positiveText:"Create",negativeText:"Cancel",draggable:!0,onPositiveClick:async()=>{s.value=!0,A()}}),!0):!1}],te=async l=>{b.warning({title:"No User Account Detected",content:"This employee doesnâ€™t have a user account yet. Do you still want to save? You can assign one later to provide access.",positiveText:"Sure",negativeText:"Not Sure",draggable:!0,onPositiveClick:async()=>{d(l)}})};function oe(){u.value?.submit()}return ce(async()=>{await G()}),c.value.description="Quickly register and onboard new employees.",pe({title:"Employee Form",meta:[{name:"description",content:c.value.description}]}),H(()=>u.value?.name,()=>{p.value.name=u.value?.name}),(l,t)=>{const E=y("n-icon"),h=y("n-breadcrumb-item"),P=y("n-breadcrumb"),R=y("n-step"),ae=y("n-steps");return D(),$("div",Pe,[n("div",Re,[n("div",Be,[n("div",$e,[n("h2",Ie,L(e(c).title),1),n("p",null,L(e(c).description),1)]),n("div",Le,[o(P,null,{default:r(()=>[o(h,null,{default:r(()=>[o(E,{component:e(ke)},null,8,["component"]),t[4]||(t[4]=V(" Home",-1))]),_:1}),o(h,null,{default:r(()=>[o(E,{component:e(Fe)},null,8,["component"]),t[5]||(t[5]=V(" Employee",-1))]),_:1}),o(h,null,{default:r(()=>[o(E,{component:e(Se)},null,8,["component"]),t[6]||(t[6]=V(" Form",-1))]),_:1})]),_:1})])])]),n("div",Me,[n("form",{onSubmit:t[1]||(t[1]=q((..._)=>e(A)&&e(A)(..._),["prevent"]))},[o(ae,{current:e(f),status:e(K),vertical:""},{default:r(()=>[o(R,{title:"Employee",description:"Personal Detail"},{default:r(()=>[t[7]||(t[7]=n("p",null,"Quickly register and onboard new employees.",-1)),n("div",je,[o(ye,{ref_key:"employeeForm",ref:u,submitLabel:"Create Employee Without User Account","onClick:submitted":te,visible:!1,icon:e(O),class:U([e(f)==1?"":"opacity-25"])},null,8,["icon","class"])])]),_:1}),o(R,{title:"User Account",description:"Create a new user account with required credentials"},{default:r(()=>[o(Ae,{ref_key:"userForm",ref:w,class:U([e(f)==2?"":"opacity-25"]),initialData:p.value,visible:!1},null,8,["class","initialData"])]),_:1}),o(R,{title:"Access Control",description:"Assign roles and manage employee permissions."},{default:r(()=>[n("div",{class:U([e(f)==3?"":"opacity-25","mt-5 mb-10"])},[o(fe,{modelValue:e(S),"onUpdate:modelValue":t[0]||(t[0]=_=>I(S)?S.value=_:null),name:"roles",options:J.value,multiple:!0,errors:e(T),label:"Roles Name"},null,8,["modelValue","options","errors"])],2)]),_:1})]),_:1},8,["current","status"])],32),n("div",Oe,[o(B,{label:"Create Employee Without User Account",onClick:oe,class:"pr-10",icon:e(O)},null,8,["icon"]),o(B,{label:"Prev",icon:e(Ee),onClick:e(Z),disabled:e(f)===1},null,8,["icon","onClick","disabled"]),o(B,{label:e(f)==3?"Apply Changes":"Next",icon:e(f)===3?e(z):e(he),"icon-placement":"right",type:e(f)==3?"success":"info",onClick:t[2]||(t[2]=_=>e(X)(ee))},null,8,["label","icon","type"])])]),o(de,{show:s.value,"onUpdate:show":t[3]||(t[3]=_=>s.value=_),title:a.title,error:a.error,description:a.description},null,8,["show","title","error","description"])])}}});export{vt as default};
