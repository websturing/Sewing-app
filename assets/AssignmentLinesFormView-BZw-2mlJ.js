import{u as le,_ as _e}from"./AssignmentLines.store-oH14-PDt.js";import{D as ie,E as j,r as U,s as E,q as J,d as q,c as R,o as S,a,a6 as we,v as ce,e as m,f as k,w as y,F as X,H as Z,l as V,m as Q,t as L,a7 as xe,g as r,p as H,P as Le,k as Pe,y as Ce,x as K,n as W,h as Ge,I as Fe}from"./index-_rG576ze.js";import{_ as me}from"./BaseButton.vue_vue_type_script_setup_true_lang-MvkUDymy.js";import{t as Ne,I as Re}from"./vee-validate-zod-CZ0VRxc9.js";import{_ as ke}from"./ProgressModal.vue_vue_type_script_setup_true_lang-CJWH7UNE.js";import{_ as oe}from"./SelectLabelWithError.vue_vue_type_script_setup_true_lang-CX7B_yXD.js";import{u as Ae}from"./useFieldWrapper-DDTDrk8Q.js";import{f as $e}from"./dateRangeFormaterNaive-ClR-GZjc.js";import{o as u,a as N,s as l,n as c,e as de,c as ue}from"./types-C6rLBGHV.js";import{M as ge,L as he,A as $}from"./metaPagination-BtrCOo_7.js";import{u as Be}from"./vee-validate-B8ABOBPA.js";import{C as Ie,B as Qe,a as Te,b as Ue,S as Ve}from"./Search20Filled-GHeFwA28.js";import{S as Oe}from"./SaveAnnotation-BCKksckI.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as De}from"./SmartHome-B-GjucFz.js";import{B as Me}from"./BrandAirtable-DsdZIhvc.js";import{F as je}from"./FormNew28Regular-D4tBBkN4.js";import"./user.schema-Dy53BlgU.js";import"./employeeSchema-BKc-Bb2P.js";import"./EyeOutline-Dlb0vT-L.js";import"./DocumentError16Filled-BHNdHnlt.js";const Ee=u({glId:c().min(1,"GL is required"),glNumber:l().min(1,"GL Number is required"),lineId:c().min(1,"Line is required"),dateStart:l(),dateEnd:l(),layingPlanning:u({id:c().optional(),color:l().min(1,"Color is required"),type:de(["BODY","COMBINASI"]),summary:u({orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()})}),dateRange:N(l()).length(2,"Date range must have exactly two dates")}),qe=u({id:c().optional(),glNumber:l().min(1,"Line name is required"),createdAt:l().optional(),updatedAt:l().optional()}),He=N(qe),Ye=u({message:l(),data:He,links:he,meta:ge,status:ue()}),pe=u({orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()}),fe=u({size:l(),orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()}),Ke=u({id:c().optional(),color:l(),type:l(),summary:pe,sizeBreakdown:N(fe)}),We=u({orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()}),Je=u({size:l(),orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()}),Xe=u({glNumber:l(),layingPlannings:N(Ke),glSummary:We,glSizeBreakdown:N(Je)}),Ze=u({color:l(),type:de(["BODY","COMBINASI"]),summary:pe,sizeBreakdown:N(fe)}),et=u({orderQty:c().int().nonnegative(),cutQty:c().int().nonnegative()}),tt=u({glNumbers:N(l())}),st=u({totalGlCount:c().int().positive(),totalColorCount:c().int().positive(),totalLayingPlannings:c().int().positive(),generatedAt:l(),lastUpdated:l(),filtersApplied:tt}),at=u({message:l(),status:c(),data:u({summaryByGl:N(Xe),summaryByColor:N(Ze),grandTotal:et,metadata:st})}),ee=ie("gls",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:"",summaryGl:[],summaryByColor:[],total:{},metaSummary:{}}),actions:{async fetch(e={}){this.loading=!0,this.error=null;try{const t={page:e.page??1,perPage:e.perPage??50,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};e.q&&(this.searchResult=[],this.isSearching=!0);const s=await j.get("/api/gls",{params:t}),n=Ye.parse(s.data);return this.meta=n.meta,this.links=n.links,this.currentPage=n.meta.currentPage,this.lastPage=n.meta.lastPage,e.q?this.searchResult=n.data:(this.data=n.data,this.isSearching=!1,this.searchResult=[]),$.parse({success:!0,message:n.message??"Gl Numbers loaded"})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}},async fetchGLNumber(e){this.loading=!0,this.error=null;try{const s=(await j.get(`/api/gls/number/${e}`)).data;return $.parse({success:!0,message:s.message??"Gl Numbers loaded",id:s.data.id})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}},async fetchSummaryGl(e){this.loading=!0,this.error=null;try{const t=await j.get("/api/gls/cutting-summary",{params:{glNumber:e}}),s=at.parse(t.data);return this.summaryGl=s.data.summaryByGl,this.summaryByColor=s.data.summaryByColor,this.metaSummary=s.data.metadata,this.total=s.data.grandTotal,$.parse({success:!0,message:t.data.message??"Gl Numbers loaded"})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetch(),this.data;const t=this.data.filter(n=>n.glNumber?.toLowerCase().includes(e));return t.length>0?(this.searchResult=t,this.isSearching=!0,t):(await this.fetch({page:1,q:e})).success?this.searchResult:[]}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const t=e.search.toLowerCase();return e.data.filter(s=>s.glNumber?.toLowerCase().includes(t))},options(){return this.searchedItems.map(e=>({value:e.glNumber||"",label:e.glNumber||""}))}}});function nt(e=null){const t=le(),s=ee(),n=U(null),{loading:g}=E(t),i=()=>({glNumber:e?.glNumber??"",lineId:e?.lineId??"",layingPlanning:e?.layingPlanning??{},dateRange:e?.dateRange??[]}),{handleSubmit:b,errors:P,isSubmitting:d,resetForm:v,validate:_}=Be({validationSchema:Ne(Ee),initialValues:i()}),h=()=>{v({values:i(),errors:{}})},C=Ae(["glNumber","lineId","layingPlanning","dateRange","glId","dateStart","dateEnd"]),{glId:w,glNumber:G,lineId:O,layingPlanning:B,dateRange:T,dateStart:Y,dateEnd:z}=C,I=async()=>{const x=await _();return x.valid?{valid:!0,values:x.values}:{valid:!1}},A=x=>b(x);return J(n,async x=>{if(x){const F=$e(x);F&&(T.value.push(F[0],F[1]),Y.value=F[0],z.value=F[1])}}),J(G,async x=>{const{id:F}=await s.fetchGLNumber(x);console.log(F),w.value=F||0}),{glNumber:G,lineId:O,isLoading:g,layingPlanning:B,dateRangeUnformated:n,errors:P,isSubmitting:d,validateForm:I,onSubmit:A,handleSubmit:b,resetForm:h}}const rt=["onKeydown"],ot={class:"flex justify-between items-start mb-2"},lt={class:"font-bold text-lg flex gap-3"},it={class:"text-[14px]"},ct={class:"text-center"},mt={class:"flex flex-col gap-1 text-sm"},dt={class:"flex justify-between"},ut={class:"text-xs text-teal-700"},gt={class:"flex justify-between"},ht={class:"flex justify-between"},pt={class:"flex flex-col justify-between"},ft={class:"flex flex-wrap"},yt=q({__name:"GlsLayingPlanning",props:{layingPlanning:{},bgColor:{},rowIndex:{}},emits:["click"],setup(e,{emit:t}){const s=g=>{n("click",g)},n=t;return(g,i)=>{const b=k("n-ellipsis"),P=k("n-card");return S(),R("div",null,[a("div",{role:"button",tabindex:"0",onClick:i[0]||(i[0]=d=>s(e.layingPlanning)),onKeydown:we(ce(s,["prevent"]),["enter","space"]),class:"cursor-pointer"},[m(P,{hoverable:"",style:{width:"330px"},"content-class":g.bgColor,"header-class":g.bgColor},{header:y(()=>[a("div",ot,[a("div",lt,[a("div",it,[m(b,{style:{"max-width":"240px"}},{tooltip:y(()=>[a("div",ct,L(e.layingPlanning.color),1)]),default:y(()=>[Q(L(e.layingPlanning.color)+" ",1)]),_:1})])])]),a("div",mt,[a("div",dt,[i[1]||(i[1]=a("p",{class:"font-normal text-xs"},"Type:",-1)),a("p",ut,L(e.layingPlanning.type),1)]),a("div",gt,[i[2]||(i[2]=a("p",{class:"text-gray-400 font-normal"}," Order Quantity: ",-1)),Q(" "+L(e.layingPlanning.summary.orderQty),1)]),a("div",ht,[i[3]||(i[3]=a("p",{class:"text-gray-400 font-normal"}," Cut Quantity: ",-1)),Q(" "+L(e.layingPlanning.summary.cutQty),1)])])]),default:y(()=>[a("div",pt,[i[4]||(i[4]=a("p",{class:"text-xs text-gray-400 mb-2"},"Sizes",-1)),a("div",ft,[(S(!0),R(X,null,Z(e.layingPlanning.sizeBreakdown,(d,v)=>(S(),V(me,{type:"info",size:"small",tertiary:!0,key:v,"class-content":[v!=e.layingPlanning.sizeBreakdown.length-1?"!mr-2 !mb-2":"!mb-2"]},{default:y(()=>[Q(L(d.size),1)]),_:2},1032,["class-content"]))),128))])])]),_:1},8,["content-class","header-class"])],40,rt)])}}}),vt={class:"flex justify-between items-center border-b-1 border-gray-100 pb-5"},St={class:"font-bold text-lg flex items-center gap-3"},bt={class:"font-bold !text-blue-700"},_t={class:"flex gap-4 mt-1"},wt={class:"flex items-center gap-2"},xt={class:"text-sm text-gray-400 font-normal"},Lt={class:"flex items-center gap-2"},Pt={class:"text-sm text-gray-400 font-normal"},Ct={class:"flex items-center gap-2"},Gt={class:"text-sm text-gray-400 font-normal"},Ft=q({__name:"GlsSummary",props:{summary:{},lastUpdated:{},rowIndex:{}},setup(e){return(t,s)=>{const n=k("n-avatar"),g=k("n-icon"),i=k("n-card");return S(),V(i,{class:"mb-4"},{header:y(()=>[a("div",vt,[a("div",St,[m(n,{size:52,color:"#f0f6ff"},{default:y(()=>[a("p",bt,L(t.rowIndex),1)]),_:1}),a("div",null,[a("p",null,"GL-"+L(e.summary.glNumber),1),a("div",_t,[a("div",wt,[m(g,null,{default:y(()=>[m(r(Ie))]),_:1}),a("p",xt," Color : "+L(e.summary.layingPlannings.length),1)]),a("div",Lt,[m(g,null,{default:y(()=>[m(r(Qe))]),_:1}),a("p",Pt," Order Quantity :"+L(e.summary.glSummary.orderQty),1)]),a("div",Ct,[m(g,null,{default:y(()=>[m(r(Te))]),_:1}),a("p",Gt," Cut Quantity: "+L(e.summary.glSummary.cutQty),1)])])])]),a("div",null,[s[0]||(s[0]=a("p",{class:"text-sm text-gray-400 font-normal"},"Last Updated",-1)),Q(" "+L(t.lastUpdated),1)])])]),default:y(()=>[xe(t.$slots,"default")]),_:3})}}});function Nt(){const e=H(),t=ee(),{search:s,options:n,summaryGl:g,metaSummary:i,loading:b}=E(t),P=h=>{const C=h.slice(3);d(C)},d=async(h,C={notify:!0})=>{const{success:w,message:G}=await t.fetchSummaryGl(h);return C.notify&&(w?e.success(G):e.error(G)),{success:w,message:G}};return{search:s,options:n,summaryGl:g,metaSummary:i,loading:b,handleFetch:async(h={notify:!0})=>{const{success:C,message:w}=await t.fetch();return h.notify&&(C?e.success(w):e.error(w)),{success:C,message:w}},handleFetchSummaryGLNumber:P,handleUpdateSearch:h=>{t.searchOrFetch(h)}}}function Rt(){const e=H(),t=ee(),{search:s,options:n}=E(t),g=d=>{const v=d.slice(3);i(v)},i=async(d,v={notify:!0})=>{const{success:_,message:h}=await t.fetchSummaryGl(d);return v.notify&&(_?e.success(h):e.error(h)),{success:_,message:h}};return{search:s,options:n,handleFetch:async(d={notify:!0})=>{const{success:v,message:_}=await t.fetch();return d.notify&&(v?e.success(_):e.error(_)),{success:v,message:_}},handleFetchSummaryGLNumber:g,handleUpdateSearch:d=>{t.searchOrFetch(d)}}}const kt=u({id:c().optional(),name:l().min(1,"Line name is required"),createdAt:l().optional(),updatedAt:l().optional()}),At=N(kt),$t=u({message:l(),data:At,links:he,meta:ge,status:ue()}),Bt=ie("lines",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:""}),actions:{async fetch(e={}){this.loading=!0,this.error=null;try{const t={page:e.page??1,perPage:e.perPage??50,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};e.q&&(this.searchResult=[],this.isSearching=!0);const s=await j.get("/api/lines",{params:t}),n=$t.parse(s.data);return this.meta=n.meta,this.links=n.links,this.currentPage=n.meta.currentPage,this.lastPage=n.meta.lastPage,e.q?this.searchResult=n.data:(this.data=n.data,this.isSearching=!1,this.searchResult=[]),$.parse({success:!0,message:n.message??"lines loaded"})}catch(t){const s=t?.response?.data?.message||"Something went wrong";return this.error=s,$.parse({success:!1,message:s})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetch(),this.data;const t=this.data.filter(n=>n.name?.toLowerCase().includes(e));return t.length>0?(this.searchResult=t,this.isSearching=!0,t):(await this.fetch({page:1,q:e})).success?this.searchResult:[]}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const t=e.search.toLowerCase();return e.data.filter(s=>s.name?.toLowerCase().includes(t))},options(){return this.searchedItems.map(e=>({value:e.id,label:e.name||""}))}}});function It(){const e=H(),t=Bt(),{search:s,options:n}=E(t);return{search:s,options:n,handleFetch:async(b={notify:!0})=>{const{success:P,message:d}=await t.fetch();return b.notify&&(P?e.success(d):e.error(d)),{success:P,message:d}},handleUpdateSearch:b=>{t.searchOrFetch(b)}}}const Qt={class:"flex flex-col gap-5"},Tt={class:"flex flex-wrap gap-4 mb-4 items-center justify-between"},Ut={class:"flex items-start gap-4"},Vt={class:"space-y-2"},Ot={key:0,class:"ml-4 mt-2 border-l border-gray-300"},zt={class:"relative pl-6 flex items-center gap-2"},Dt={key:0,class:"w-1/6"},Mt={class:"flex flex-wrap gap-2 mt-4"},jt=q({__name:"AssignmentLinesForm",setup(e){const t=Ge(),s=Le(),{options:n,handleFetch:g,handleUpdateSearch:i}=It(),{options:b,handleFetch:P,handleUpdateSearch:d,handleFetchSummaryGLNumber:v}=Rt(),{summaryGl:_,metaSummary:h,loading:C}=Nt(),{glNumber:w,lineId:G,layingPlanning:O,errors:B,dateRangeUnformated:T,onSubmit:Y}=nt(),z=le(),I=U(null),A=U(""),x=H(),F=p=>{I.value=p,O.value={id:p.id,color:p.color,type:p.type,summary:p.summary}},te=Y(async p=>{s.success({title:"Confirmation Create Line Assignment",content:"Are you sure you want to create this record? Please review the details before proceeding.",positiveText:"Create",negativeText:"Cancel",draggable:!0,onPositiveClick:async()=>{const{success:o,message:M}=await z.create(p);o?x.success(M):x.error(M)}})}),ye=p=>{I.value=null,O.value={id:void 0,color:"",type:"BODY",summary:{orderQty:0,cutQty:0}},v(p)},se=Pe(()=>A.value?_.value.map(p=>({...p,layingPlannings:p.layingPlannings.filter(o=>o.color.toLowerCase().includes(A.value.toLowerCase())||o.type.toLowerCase().includes(A.value.toLowerCase()))})):_.value);Ce(async()=>{await g({notify:!1}),await P({notify:!1})});const D=U(!1);return J(()=>z.loading,p=>{p?D.value=!0:setTimeout(()=>{D.value=!1,I.value=null,t.push({name:"assignment-lines"})},500)}),(p,o)=>{const M=k("n-date-picker"),ve=k("n-alert"),Se=k("n-spin"),ae=k("n-empty");return S(),R("div",Qt,[a("form",{onSubmit:o[4]||(o[4]=ce((...f)=>r(te)&&r(te)(...f),["prevent"]))},[m(Se,{size:"medium",class:"mt-6",description:"Please Wait, Loading your selected data",show:r(C)},{default:y(()=>[a("div",Tt,[a("div",Ut,[a("ul",Vt,[a("li",null,[m(oe,{modelValue:r(w),"onUpdate:modelValue":o[0]||(o[0]=f=>W(w)?w.value=f:null),name:"glNumber",options:r(b),errors:r(B),multiple:!1,onChange:ye,onSearch:r(d),label:"GL Number"},null,8,["modelValue","options","errors","onSearch"]),r(_).length>0?(S(),R("ul",Ot,[a("li",zt,[o[6]||(o[6]=a("span",{class:"absolute left-0 top-1/2 w-6 border-t border-gray-300"},null,-1)),m(Re,{modelValue:A.value,"onUpdate:modelValue":o[1]||(o[1]=f=>A.value=f),name:"searchLayingPlanning",placeholder:"Search by Color or Type",style:{width:"250px"},icon:r(Ue)},null,8,["modelValue","icon"])])])):K("",!0)])]),m(oe,{modelValue:r(G),"onUpdate:modelValue":o[2]||(o[2]=f=>W(G)?G.value=f:null),name:"lineId",options:r(n),multiple:!1,errors:r(B),label:"Line Name",onSearch:r(i)},null,8,["modelValue","options","errors","onSearch"]),a("div",null,[o[7]||(o[7]=a("label",{for:"dateRange",class:"font-bold"},"Start - End Date",-1)),m(M,{id:"dateRange",status:r(B).dateRange?"error":"",value:r(T),"onUpdate:value":o[3]||(o[3]=f=>W(T)?T.value=f:null),type:"daterange",clearable:""},null,8,["status","value"])]),m(me,{label:"Save Assignments",type:"success","class-content":"!mt-6",icon:r(Oe),"icon-placement":"right","attr-type":"submit"},null,8,["icon"])]),r(B).layingPlanning?(S(),R("div",Dt,[m(ve,{type:"error"},{default:y(()=>[...o[8]||(o[8]=[Q(" Please select a color from the list. ",-1)])]),_:1})])):K("",!0)])]),_:1},8,["show"]),se.value.length===0?(S(),V(ae,{key:0,description:"GL Number Not Selected",class:"mt-10"})):(S(!0),R(X,{key:1},Z(se.value,(f,be)=>(S(),R("div",null,[m(Ft,{summary:f,"row-index":be+1,"last-updated":r(h).lastUpdated},{default:y(()=>[f.layingPlannings.length===0?(S(),V(ae,{key:0,description:`No results found for ${A.value}`},{icon:y(()=>[m(r(Ve),{class:"!text-6xl !text-gray-300"})]),_:1},8,["description"])):K("",!0),a("div",Mt,[(S(!0),R(X,null,Z(f.layingPlannings,(ne,re)=>(S(),V(yt,{key:re,"laying-planning":ne,"bg-color":I.value==ne?"bg-teal-50":"","row-index":re+1,onClick:F},null,8,["laying-planning","bg-color","row-index"]))),128))])]),_:2},1032,["summary","row-index","last-updated"])]))),256))],32),m(ke,{show:D.value,"onUpdate:show":o[5]||(o[5]=f=>D.value=f),title:"Processing Assignment Lines",description:"Please wait while we process your request.",error:!1},null,8,["show"])])}}}),Et=ze(jt,[["__scopeId","data-v-8cec405b"]]),qt={class:"flex flex-col gap-10"},Ht={class:"bg-gray-50 p-5 rounded-md"},ps=q({__name:"AssignmentLinesFormView",setup(e){const t=U({title:"Assignment Lines Form",description:"Create a new assignment between a line and GL."});return Fe({title:t.value.title,meta:[{name:"description",content:t.value.description}]}),(s,n)=>(S(),R("div",qt,[a("div",Ht,[m(_e,{title:t.value.title,description:t.value.description,breadcrumbs:[{label:"Home",icon:r(De),to:"/"},{label:t.value.title,icon:r(Me),to:{name:"assignment-lines"}},{label:"Form",icon:r(je)}]},null,8,["title","description","breadcrumbs"])]),m(Et)]))}});export{ps as default};
