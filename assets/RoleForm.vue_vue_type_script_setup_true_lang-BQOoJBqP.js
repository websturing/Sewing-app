import{D as O,E as w,p as J,s as E,r as K,d as j,c as f,o as i,F as B,x as L,a as r,t as v,G as Q,H as M,e as m,f as p,w as u,l as T,y as X,g as h,n as P,v as Y,m as U}from"./index-KKLjXh5o.js";import{I as Z}from"./InputLabelWithError-BDBcFb6B.js";import{h as S,u as ee}from"./Role-De2Fs16-.js";import{o as se,s as $,n as F,a as W}from"./types-CVZIcfwR.js";import{t as te}from"./vee-validate-zod-YABXOXEh.js";import{u as oe,a as I}from"./vee-validate-D5xA2-Dp.js";import{S as re}from"./SendOutline-DwNFTT6b.js";const A=O("module",{state:()=>({data:[],loading:!1,error:null}),actions:{async fetchModule(){this.loading=!0,this.error=null;try{const e=await w.get("/api/module");this.data=e.data.data,this.error=null}catch(e){throw this.data=[],this.error=S(e),e}finally{this.loading=!1}},async fetchModuleWithPermissions(){this.loading=!0,this.error=null;try{const e=await w.get("/api/module/withpermissions");this.data=e.data.data,this.error=null}catch(e){throw this.data=[],this.error=S(e),e}finally{this.loading=!1}},async createModule(e){this.loading=!0,this.error=null;try{const t=await w.post("/api/module",e);return await this.fetchModule(),t.data.message}catch(t){const o=t?.response?.data?.message||"Terjadi kesalahan";throw this.error=o,o}finally{this.loading=!1}},async updateModule(e,t){this.loading=!0,this.error=null;try{const o=await w.post(`/api/module/${e}`,t);return this.fetchModule(),this.error=null,o.data.message}catch(o){return console.log(o),this.error=S(o),o}finally{this.loading=!1}},async deleteModule(e){this.loading=!0,this.error=null;try{const t=await w.delete(`/api/module/${e}`);return this.fetchModule(),this.error=null,t.data.message}catch(t){throw this.error=S(t),t}finally{this.loading=!1}}}}),D=se({id:F().optional(),name:$().min(1,"Name is required."),guardName:$().default("web")}),ne=D.pick({name:!0,guardName:!0}).extend({permissions:W(F()).min(1,"Please select at least one permission.")});D.partial().extend({permissions:W(F()).optional()});function ae(e=null){const t=J(),o=ee(),y=A(),{data:b}=E(o),{data:x}=E(y),{handleSubmit:s,errors:a,isSubmitting:d,resetForm:_}=oe({validationSchema:te(ne),initialValues:{name:e?.name||"",guardName:e?.guardName||"web",permissions:e?.permissions||[]}}),{value:k}=I("name"),{value:l}=I("permissions"),c=K(!!e?.id),n=()=>{_({values:{name:e?.name||"",guardName:e?.guardName||"web",permissions:e?.permissions||[]},errors:{}})},R=s(async C=>{try{if(c.value){const g=await o.updateRole(e.id,C);t.success(g)}else{const g=await o.createRole(C);t.success(g),n()}}catch(g){console.error("Error submitting form:",g)}});return{name:k,permissions:l,isEdit:c,onSubmit:R,resetForm:n,parentData:b,errors:a,isSubmitting:d,permissionData:x}}const ie={key:0},le={class:"text-center"},me={key:0,class:"font-semibold"},de={key:1,class:"ml-2"},ce=j({__name:"RolesPermissionRowTable",props:{item:{},index:{},level:{},permissionCheckBox:{}},emits:["update:permissionCheckBox"],setup(e,{emit:t}){const o=e,y=t;function b(s=[],a){return s.find(d=>d.action===a)?.permissionId}const x=["read","create","update","delete","upload","download"];return(s,a)=>{const d=p("n-checkbox"),_=p("n-checkbox-group"),k=p("RolesPermissionRowTable",!0);return i(),f(B,null,[o.item&&o.item.name?(i(),f("tr",ie,[r("td",le,v(s.level===0?s.index:""),1),r("td",{style:Q({paddingLeft:`${s.level*20}px`}),class:"!pl-5"},[s.level===0?(i(),f("span",me,v(s.item.name),1)):(i(),f("span",de,"- "+v(s.item.name),1))],4),(i(),f(B,null,M(x,l=>r("td",{key:l,class:"!text-center"},[m(_,{value:s.permissionCheckBox,"onUpdate:value":a[0]||(a[0]=c=>y("update:permissionCheckBox",c))},{default:u(()=>[m(d,{value:b(s.item.permissions,l),disabled:!b(s.item.permissions,l)},null,8,["value","disabled"])]),_:2},1032,["value"])])),64))])):L("",!0),(i(!0),f(B,null,M(s.item.children,(l,c)=>(i(),T(k,{key:`${l.id}-${c}`,item:l,index:s.index,level:s.level+1,permissionCheckBox:s.permissionCheckBox,"onUpdate:permissionCheckBox":a[1]||(a[1]=n=>y("update:permissionCheckBox",n))},null,8,["item","index","level","permissionCheckBox"]))),128))],64)}}}),xe=j({__name:"RoleForm",props:{initialData:{}},emits:["submitted"],setup(e,{emit:t}){const o=A(),y=e,b=t,x=async()=>{await _(),b("submitted")};X(async()=>{try{await o.fetchModuleWithPermissions()}catch(c){console.error("Error fetching modules:",c)}});const{name:s,permissions:a,errors:d,onSubmit:_,isEdit:k,permissionData:l}=ae(y.initialData);return(c,n)=>{const R=p("n-table"),C=p("n-scrollbar"),g=p("n-card"),V=p("n-space"),q=p("n-icon"),z=p("n-button");return i(),f("div",null,[r("form",{onSubmit:Y(x,["prevent"])},[m(Z,{modelValue:h(s),"onUpdate:modelValue":n[0]||(n[0]=N=>P(s)?s.value=N:null),name:"name",errors:h(d),label:"Role Name"},null,8,["modelValue","errors"]),m(V,{vertical:"",class:"mt-5"},{default:u(()=>[n[3]||(n[3]=r("p",{class:"text-gray-400"},"Manage Permission",-1)),m(C,{style:{"max-height":"320px"}},{default:u(()=>[m(R,{"single-line":!1},{default:u(()=>[n[2]||(n[2]=r("thead",null,[r("tr",null,[r("th",{class:"!text-center",width:"20px"},"No"),r("th",null,"Module Name"),r("th",{class:"!text-center"},"View"),r("th",{class:"!text-center"},"Create"),r("th",{class:"!text-center"},"Update"),r("th",{class:"!text-center"},"Delete"),r("th",{class:"!text-center"},"Upload"),r("th",{class:"!text-center"},"Download")])],-1)),r("tbody",null,[(i(!0),f(B,null,M(h(l),(N,G)=>(i(),T(ce,{item:N,index:G+1,level:0,permissionCheckBox:h(a),"onUpdate:permissionCheckBox":n[1]||(n[1]=H=>P(a)?a.value=H:null)},null,8,["item","index","permissionCheckBox"]))),256))])]),_:1})]),_:1}),h(d).permissions?(i(),T(g,{key:0,"content-class":"bg-red-100"},{default:u(()=>[U(v(h(d).permissions),1)]),_:1})):L("",!0)]),_:1}),m(V,{class:"mt-10",justify:"end"},{default:u(()=>[m(z,{type:"success","icon-placement":"right","attr-type":"submit",block:""},{icon:u(()=>[m(q,null,{default:u(()=>[m(h(re))]),_:1})]),default:u(()=>[U(" "+v(h(k)?"Apply Changes":"Create New"),1)]),_:1})]),_:1})],32)])}}});export{xe as _,A as u};
