import{_ as D}from"./BaseButton.vue_vue_type_script_setup_true_lang-WC2rZVzv.js";import{d as M,k as I,c as U,o as L,x as Y,e as s,t as C,g as r,W as de,L as te,w as h,l as J,m as R,f as x,E as H,D as ue,p as ae,r as $,s as me,y as se,a as e,n as O,F as P,H as z,v as ce}from"./index-BGjygZi6.js";import{A as pe}from"./AlertOutline-DQlsbB1u.js";import{u as fe}from"./useFieldWrapper-BJG8P0uZ.js";import{o as K,c as ne,a as N,n as T,s as B}from"./types-CVZIcfwR.js";import{A as V}from"./api.schema-B7NsqcGR.js";import{c as ge}from"./defect.summaryApi-CUJMEH2X.js";import{u as ve}from"./line.page-BjrcM1Ro.js";import{u as ye}from"./user.table-DLSWtYTB.js";import{t as _e}from"./vee-validate-zod-Bo8hHpTC.js";import{u as he}from"./vee-validate-CYL8LZYL.js";import{S as be,T as Le,P as xe}from"./Trash-DPhRf5qk.js";import{_ as we}from"./BaseInput.vue_vue_type_script_setup_true_lang-BU0nAdgp.js";import{S as Se}from"./SearchOutline-SINafxgf.js";import{R as Ae}from"./RefreshRound-BRsK8zsJ.js";import{C as le}from"./ChartPerson20Filled-DzVyi-rB.js";import{F as Ue}from"./FolderDetailsReference-DAJmznZY.js";import{S as Ce}from"./SmartHome-D-YBCpvA.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./stockin.api.schema-DC3-uBMr.js";import"./metaPagination-9MSE0uSw.js";import"./dateRangeFormaterNaive-ClR-GZjc.js";import"./user.store-mLnNcpY6.js";import"./user.schema-BXMI3HnA.js";import"./employeeSchema-AqYtwcrb.js";const Be={class:"flex flex-col gap-1"},$e=["status","for"],Z=M({__name:"BaseSelectWithError",props:{modelValue:{},options:{},placeholder:{default:"Select option"},clearable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},size:{default:"medium"},icon:{default:null},errors:{},label:{},name:{},multiple:{type:Boolean,default:!1},classContent:{}},emits:["update:modelValue"],setup(n,{emit:a}){const t=n,o=a,u=I(()=>t.errors?.[t.name]),c=I(()=>u.value?"error":void 0);return(p,m)=>{const l=x("n-icon"),f=x("n-tooltip");return L(),U("div",Be,[p.label?(L(),U("label",{key:0,status:c.value,for:t.name,class:"text-sm font-medium text-gray-700"},C(p.label),9,$e)):Y("",!0),s(r(de),{id:t.name,value:t.modelValue,options:t.options,multiple:t.multiple,placeholder:t.placeholder,clearable:t.clearable,filterable:t.filterable,size:t.size,"onUpdate:value":m[0]||(m[0]=g=>o("update:modelValue",g)),class:te([t.classContent,"!min-w-[200px]"]),"max-tag-count":t.multiple?0:void 0,"render-tag":t.multiple?()=>null:void 0},{arrow:h(()=>[u.value?(L(),J(f,{key:0,show:!!u.value,trigger:"hover"},{trigger:h(()=>[s(l,{component:r(pe),color:"red"},null,8,["component"])]),default:h(()=>[R(" "+C(u.value),1)]),_:1},8,["show"])):Y("",!0)]),_:1},8,["id","value","options","multiple","placeholder","clearable","filterable","size","class","max-tag-count","render-tag"])])}}}),ke=K({userId:T().nullable().refine(n=>n!==null,"Leader is required").transform(n=>n),lineId:N(T()).min(1,"Leader is required"),isActive:ne()}),W="/api",G={getAssignments:()=>H.get(`${W}/leaders`).then(n=>n.data),createAssign:n=>H.post(`${W}/leaders/assign`,n).then(a=>a.data),createUnassign:n=>H.post(`${W}/leaders/unassign`,n).then(a=>a.data)},ee=K({assignId:T(),assignAt:B(),unassignAt:B().nullable(),lineId:T().nullable(),lineName:B().nullable(),createdBy:B(),updatedBy:B().nullable(),lastUpdated:B()}),Fe=K({leader:B(),leaderId:T(),isActive:ne(),activeLines:B(),activeLineIds:B(),lastUpdated:B().nullable(),activeDetail:N(ee),inactiveDetail:N(ee)}),Ve=ge(N(Fe)),oe=ue("leaderStore",{state:()=>({loading:!1,error:null,AssignmentSummaryByLeader:[]}),actions:{async fetchSummaryByLeader(){this.loading=!0,this.error=null;try{const n=await G.getAssignments(),a=Ve.parse(n);return this.AssignmentSummaryByLeader=a.data,V.parse({success:!0,message:a.message??"loaded"})}catch(n){const a=n?.response?.data?.message||"Something went wrong";return this.error=a,V.parse({success:!1,message:a})}finally{this.loading=!1}},async createAssignLeader(n){try{const a=await G.createAssign(n);return V.parse({success:!0,message:a.message??"Created",data:a.data})}catch(a){const t=a?.response?.data?.message||"Something went wrong";return this.error=t,V.parse({success:!1,message:t})}finally{this.loading=!1}},async unAssignLeader(n){try{const a=await G.createUnassign(n);return V.parse({success:!0,message:a.message??"Created",data:a.data})}catch(a){const t=a?.response?.data?.message||"Something went wrong";return this.error=t,V.parse({success:!1,message:t})}finally{this.loading=!1}}}});function re(n=null){const a=ae(),t=oe(),o=$(!1),{rows:u,handleFetch:c}=ye(),{data:p,handleFetch:m}=ve(),l=I(()=>u.value.map(w=>({label:w.name,value:w.id}))),f=I(()=>p.value.map(w=>({label:w.name,value:w.id}))),g=async w=>{o.value=!0,await t.createAssignLeader(w),o.value=!1},v=async w=>{o.value=!0;const{success:ie,message:X}=await t.unAssignLeader(w);ie?a.success(X):a.error(X),o.value=!1},d=async()=>{await Promise.all([c(),m({notify:!1},{})])},i=()=>({userId:n?.userId??null,lineId:n?.lineId??[],isActive:n?.isActive??!0}),{handleSubmit:_,errors:S,isSubmitting:b,resetForm:F,validate:k}=he({validationSchema:_e(ke),initialValues:i()}),{userId:y,lineId:q,isActive:E}=fe(["userId","lineId","isActive"]);return{isLoading:o,userId:y,lineId:q,isActive:E,optionUsers:l,optionLines:f,handleUserLineData:d,onSubmit:_,resetForm:()=>{F({values:i(),errors:{}})},errors:S,isSubmitting:b,validateForm:async()=>{const w=await k();return w.valid?{valid:!0,values:w.values}:{valid:!1}},handleCreateAssignLeader:g,handleUnassignLeader:v}}function j(){const n=ae(),a=oe(),t=$(!1),{loading:o,AssignmentSummaryByLeader:u}=me(a);return{leaderPiniaLoading:o,isLoading:t,AssignmentSummaryByLeader:u,fetchSummaryByLeader:async(p={notify:!0})=>{const{success:m,message:l}=await a.fetchSummaryByLeader();return p.notify&&(m?n.success(l):n.error(l)),{success:m,message:l}}}}const De={class:"flex flex-col gap-5"},Ie={class:"flex gap-2 items-end"},Re={class:"flex flex-col"},Te={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Me={class:"flex gap-2 flex-wrap mt-2"},Pe={class:"flex gap-2 justify-end"},ze=M({__name:"LeaderAssignmentForm",props:{modal:{type:Boolean},initialData:{}},emits:["update:modal"],setup(n,{emit:a}){const t=n,{isLoading:o,userId:u,lineId:c,isActive:p,optionLines:m,optionUsers:l,onSubmit:f,errors:g,resetForm:v,handleUserLineData:d,handleCreateAssignLeader:i}=re(t.initialData),{fetchSummaryByLeader:_}=j(),S=f(async k=>{await i(k),await _(),F(!1)}),b=a,F=k=>{b("update:modal",k)};return se(async()=>{await d()}),(k,y)=>{const q=x("n-switch"),E=x("n-tag");return L(),U("div",null,[e("form",{onSubmit:y[3]||(y[3]=ce((...A)=>r(S)&&r(S)(...A),["prevent"]))},[e("div",De,[y[6]||(y[6]=e("div",{class:"mb-5"},[e("p",{class:"text-xl font-semibold"},"Leader Assignment Form"),e("p",null,"A dedicated form interface for assigning leaders to specific production lines.")],-1)),e("div",Ie,[s(Z,{name:"userId",options:r(l),label:"Leaders",modelValue:r(u),"onUpdate:modelValue":y[0]||(y[0]=A=>O(u)?u.value=A:null),placeholder:"Select Leader",errors:r(g)},null,8,["options","modelValue","errors"]),s(Z,{name:"lineId",options:r(m),multiple:"",label:"Lines",modelValue:r(c),"onUpdate:modelValue":y[1]||(y[1]=A=>O(c)?c.value=A:null),placeholder:"Select Lines",errors:r(g)},null,8,["options","modelValue","errors"]),e("div",Re,[y[4]||(y[4]=e("label",{id:"isActive",class:"mb-2 font-semibold"},"Is Active",-1)),s(q,{round:!1,size:"large",value:r(p),"onUpdate:value":y[2]||(y[2]=A=>O(p)?p.value=A:null)},null,8,["value"])])]),e("div",Te,[y[5]||(y[5]=e("p",{class:"text-xs text-gray-400"},"Selected Lines",-1)),e("div",Me,[(L(!0),U(P,null,z(r(c),A=>(L(),J(E,{key:A,size:"small",type:"info",round:""},{default:h(()=>[R(C(r(m).find(Q=>Q.value===A)?.label),1)]),_:2},1024))),128))])]),e("div",Pe,[s(D,{label:"Reset",onClick:r(v),type:"error",quaternary:""},null,8,["onClick"]),s(D,{label:"Assign Leader",icon:r(be),"icon-placement":"right",loading:r(o),type:"primary",attrType:"submit"},null,8,["icon","loading"])])])],32)])}}}),Ne={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},je={class:"text-lg font-semibold mb-2"},qe=M({__name:"LeaderUnassignmentForm",props:{initialData:{},modal:{type:Boolean}},emits:["update:modal"],setup(n,{emit:a}){const t=a,o=$(null),{isLoading:u,handleUnassignLeader:c}=re(),{fetchSummaryByLeader:p}=j(),m=f=>{t("update:modal",f)},l=async(f,g)=>{o.value=f,await c({id:g}),n.initialData?.activeDetail.splice(f,1),o.value=null,await p(),m(!1)};return(f,g)=>{const v=x("n-divider"),d=x("n-list-item"),i=x("n-list");return L(),U("div",null,[e("div",Ne,[e("p",je,C(n.initialData?.leader),1),g[0]||(g[0]=e("p",{class:"text-xs font-semibold text-gray-400"},"Assignment Lines",-1)),s(v,{dashed:"",class:"!my-[10px]"}),s(i,{bordered:""},{default:h(()=>[(L(!0),U(P,null,z(n.initialData?.activeDetail,(_,S)=>(L(),J(d,{class:te((S===o.value,"dimmed"))},{suffix:h(()=>[s(D,{label:"unassign line",size:"small",icon:r(Le),type:"error",loading:r(u)&&S==o.value,onClick:b=>l(S,_.assignId),disabled:S==o.value},null,8,["icon","loading","onClick","disabled"])]),default:h(()=>[R(C(_?.lineName)+" ",1)]),_:2},1032,["class"]))),256))]),_:1})])])}}}),Ee={class:"flex flex-col gap-5"},He={class:"flex justify-between"},Oe={class:"!w-[300px]"},We={class:"flex gap-3 items-center"},Ge={class:"flex gap-2"},Je=M({__name:"SummaryLeaderTable",props:{modal:{type:Boolean}},emits:["click:unassignLine","update:modal"],setup(n,{emit:a}){const t=$(""),o=I(()=>{const v=t.value.toLowerCase().trim();return v?(c.value||[]).filter(d=>d.leader?.toLowerCase().includes(v)||d.activeLines?.toLowerCase().includes(v)):c.value||[]}),{leaderPiniaLoading:u,AssignmentSummaryByLeader:c,fetchSummaryByLeader:p}=j(),m=a,l=async()=>{await p()},f=async v=>{m("click:unassignLine",v)},g=v=>{m("update:modal",v)};return(v,d)=>{const i=D,_=x("n-skeleton"),S=x("n-table");return L(),U("div",Ee,[e("div",He,[e("div",Oe,[s(we,{icon:r(Se),placeholder:"Search",modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=b=>t.value=b)},null,8,["icon","modelValue"])]),e("div",We,[s(i,{label:"Refresh",icon:r(Ae),onClick:l},null,8,["icon"]),s(i,{label:"Create Leader Assignment",icon:r(le),onClick:d[1]||(d[1]=b=>g(!0)),type:"primary"},null,8,["icon"])])]),s(S,null,{default:h(()=>[d[3]||(d[3]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Leader"),e("th",null,"Line Assignments"),e("th",null,"Last Updated"),e("th",null,"Status")])],-1)),e("tbody",null,[r(u)?(L(),U(P,{key:0},z(10,b=>e("tr",{key:b},[e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})]),e("td",null,[s(_,{text:""})])])),64)):(L(!0),U(P,{key:1},z(o.value,(b,F)=>(L(),U("tr",{key:F},[e("td",null,C(F+1),1),e("td",null,C(b.leader),1),e("td",null,C(b.activeLines),1),e("td",null,C(b.lastUpdated),1),e("td",Ge,[s(i,{label:"Detail",icon:r(Ue),onClick:d[2]||(d[2]=()=>{}),tertiary:""},null,8,["icon"]),s(i,{label:"Unasssign Line",icon:r(xe),tertiary:"",type:"error",onClick:k=>f(b)},null,8,["icon","onClick"])])]))),128))])]),_:1})])}}}),Ke={class:"flex flex-col gap-10"},Qe={class:"flex justify-between items-center"},Xe={class:"w-84 flex-auto"},Ye={class:"text-xl font-bold mb-1"},Ze={class:"w-16 flex-auto text-right"},et={class:"flex justify-end"},Ct=M({__name:"LeadersPageView",setup(n){const a=$({title:"Leader Management Module",description:"A centralized interface enabling users to view, create, and maintain leader records assigned across multiple production lines. The module streamlines oversight, improves data governance, and ensures operational visibility by providing a structured workflow for leader placement and line assignments."}),t=$(!1),o=$(!1),u=$(),{fetchSummaryByLeader:c}=j(),p=m=>{u.value=m,o.value=!0};return se(async()=>{await c()}),(m,l)=>{const f=x("n-icon"),g=x("n-breadcrumb-item"),v=x("n-breadcrumb"),d=x("n-modal");return L(),U("div",Ke,[e("div",Qe,[e("div",Xe,[e("h2",Ye,C(a.value.title),1),e("p",null,C(a.value.description),1)]),e("div",Ze,[s(v,null,{default:h(()=>[s(g,null,{default:h(()=>[s(f,{component:r(Ce)},null,8,["component"]),l[6]||(l[6]=R(" Home",-1))]),_:1}),s(g,null,{default:h(()=>[s(f,{component:r(le)},null,8,["component"]),l[7]||(l[7]=R(" Leaders ",-1))]),_:1})]),_:1})])]),s(Je,{"onClick:unassignLine":p,modal:t.value,"onUpdate:modal":l[0]||(l[0]=i=>t.value=i)},null,8,["modal"]),s(d,{show:t.value,"onUpdate:show":l[2]||(l[2]=i=>t.value=i),preset:"card",style:"width: 1200px"},{default:h(()=>[s(ze,{modal:t.value,"onUpdate:modal":l[1]||(l[1]=i=>t.value=i)},null,8,["modal"])]),_:1},8,["show"]),s(d,{show:o.value,"onUpdate:show":l[5]||(l[5]=i=>o.value=i),preset:"card",style:"width: 1200px"},{header:h(()=>[...l[8]||(l[8]=[e("p",null,"Leader Unassignment",-1),e("p",{class:"text-sm font-normal"},"An operational interface for removing a leader from a designated production line.",-1)])]),footer:h(()=>[e("div",et,[s(D,{label:"Close",type:"primary",tertiary:"",onClick:l[3]||(l[3]=i=>o.value=!1)})])]),default:h(()=>[s(qe,{initialData:u.value,modal:o.value,"onUpdate:modal":l[4]||(l[4]=i=>o.value=i)},null,8,["initialData","modal"])]),_:1},8,["show"])])}}});export{Ct as default};
