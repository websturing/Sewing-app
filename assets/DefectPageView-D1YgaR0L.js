import{_ as q}from"./BaseButton.vue_vue_type_script_setup_true_lang-gujkCTAV.js";import{_ as E}from"./BaseInput.vue_vue_type_script_setup_true_lang-B3ayLQCv.js";import{E as C,D as H,p as O,s as J,d as T,r as R,k as K,c as u,a as e,e as a,g as _,f as w,w as N,o as i,F as y,H as b,t as c,y as Q}from"./index-luQSl8x0.js";import{o as S,n as g,s as p,a as $,c as W}from"./types-CVZIcfwR.js";import{A as G}from"./api.schema-B7NsqcGR.js";import{S as X}from"./SearchOutline-BVUhlP4Y.js";import{R as Y}from"./RefreshRound-Dh5UE_Dk.js";import{R as Z,F as ee}from"./Repeat-CYc-KUWB.js";const F="/api",P={getSummaryGroupLines:()=>C.get(`${F}/defect/summary/lines`).then(o=>o.data),getGroupLines:()=>C.get(`${F}/defect`).then(o=>o.data),getGroupGlNumber:()=>C.get(`${F}/defect/group/gl-number`).then(o=>o.data)},te=S({glNo:p(),color:p(),size:p(),lineId:g(),lineName:p(),totalDefect:g(),totalPcs:g()}),M=S({totalSize:g(),totalDefect:g(),totalPcs:g(),items:$(te)}),A=M.extend({lineName:p()}),se=M.extend({glNumber:p(),color:p(),lineNames:p()}),oe=S({totalLines:g(),totalDefect:g(),lines:$(A)}),j=o=>S({status:W(),message:p(),data:o}),ae=j(oe),le=j($(A)),ne=j($(se)),re=H("defect",{state:()=>({loading:!1,error:null,defectData:[],defectGroupLines:[],defectGroupGlNumber:[],summaryGroupLine:{}}),actions:{async fetchSummaryGroupLines(){this.loading=!0,this.error=null;try{const o=await P.getSummaryGroupLines(),s=ae.parse(o);return this.summaryGroupLine=s.data,G.parse({success:!0,message:s.message??"loaded"})}catch(o){const s=o?.response?.data?.message||"Something went wrong";return this.error=s,G.parse({success:!1,message:s})}finally{this.loading=!1}},async fetchGroupLines(){this.loading=!0,this.error=null;try{const o=await P.getGroupLines(),s=le.parse(o);return this.defectGroupLines=s.data,G.parse({success:!0,message:s.message??"loaded"})}catch(o){const s=o?.response?.data?.message||"Something went wrong";return this.error=s,G.parse({success:!1,message:s})}finally{this.loading=!1}},async fetchGroupGlNumber(){this.loading=!0,this.error=null;try{const o=await P.getGroupGlNumber(),s=ne.parse(o);return this.defectGroupGlNumber=s.data,G.parse({success:!0,message:s.message??"loaded"})}catch(o){const s=o?.response?.data?.message||"Something went wrong";return this.error=s,G.parse({success:!1,message:s})}finally{this.loading=!1}}}});function B(){const o=O(),s=re(),{loading:n,summaryGroupLine:x,defectGroupLines:d,defectGroupGlNumber:m}=J(s);return{loading:n,summaryGroupLine:x,defectGroupLines:d,defectGroupGlNumber:m,handleFetchGroupGlNumber:async(f={notify:!0})=>{const{success:r,message:t}=await s.fetchGroupGlNumber();return f.notify&&(r?o.success(t):o.error(t)),{success:r,message:t}},handleFetchSummaryGroupLines:async(f={notify:!0})=>{const{success:r,message:t}=await s.fetchSummaryGroupLines();return f.notify&&(r?o.success(t):o.error(t)),{success:r,message:t}},handleFetchGroupLines:async(f={notify:!0})=>{const{success:r,message:t}=await s.fetchGroupLines();return f.notify&&(r?o.success(t):o.error(t)),{success:r,message:t}}}}const ce={class:"flex flex-col gap-3"},ue={class:"flex justify-between"},ie={class:"!w-[300px]"},de={class:"flex gap-2"},me={class:"text-center"},pe={class:"!bg-red-100 text-center"},fe={class:"text-center"},he={class:"text-center"},_e=["colspan"],ge={class:"!text-center !bg-white"},xe={class:"!text-center"},ye={class:"!text-center"},be={class:"!text-center !text-red-400"},Ge={class:"!text-center"},we={class:"!bg-gray-50 !text-center !font-semibold"},ve={class:"!bg-gray-50 !text-center"},Le=T({__name:"DefectGroupGlNumberTable",setup(o){const s=R(""),n=R(),x=R(!1),{loading:d,defectGroupGlNumber:m,handleFetchGroupGlNumber:v}=B(),V=K(()=>{const r=s.value.toLowerCase().trim();return r?(m.value||[]).filter(t=>t.glNumber?.toLowerCase().includes(r)||t.color?.toLowerCase().includes(r)||t.lineNames?.toLowerCase().includes(r)):m.value||[]}),D=async()=>{await v()},f=r=>{x.value=!0,n.value=m.value[r]};return(r,t)=>{const L=q,h=w("n-skeleton"),z=w("n-table"),I=w("n-modal");return i(),u("div",ce,[e("div",ue,[e("div",ie,[a(E,{icon:_(X),placeholder:"Search",modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l)},null,8,["icon","modelValue"])]),e("div",de,[a(L,{label:"Refresh",icon:_(Y),onClick:D},null,8,["icon"]),a(L,{label:"Create Request Replacement",icon:_(Z),onClick:D,type:"primary"},null,8,["icon"])])]),a(z,null,{default:N(()=>[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"!w-[20px]"},"No"),e("th",{class:"!w-[80px]"},"GL Number"),e("th",null,"Color"),e("th",{class:"!w-[30px]"},"Cut Pieces"),e("th",{class:"!w-[30px] !bg-red-100"},"Defects"),e("th",{class:"!w-[30px]"},"Balance"),e("th",{class:"!w-[200px] !text-center"},"Line"),e("th",{class:"!w-[80px]"},"Status")])],-1)),e("tbody",null,[_(d)?(i(),u(y,{key:0},b(10,l=>e("tr",{key:l},[e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})]),e("td",null,[a(h,{text:""})])])),64)):(i(!0),u(y,{key:1},b(V.value,(l,k)=>(i(),u("tr",{key:l.glNumber},[e("td",null,c(k+1),1),e("td",null,c(l.glNumber),1),e("td",null,[a(L,{label:l.color,onClick:U=>f(k),quaternary:"",type:"primary"},null,8,["label","onClick"])]),e("td",me,c(l.totalPcs),1),e("td",pe,c(l.totalDefect),1),e("td",fe,c(l.totalPcs-l.totalDefect),1),e("td",he,c(l.lineNames),1),e("td",null,[a(L,{label:"Detail",icon:_(ee),onClick:U=>f(k),tertiary:""},null,8,["icon","onClick"])])]))),128))])]),_:1}),a(I,{show:x.value,"onUpdate:show":t[1]||(t[1]=l=>x.value=l),preset:"card",style:"width: 1200px",title:`GL-${n.value?.glNumber.toString()} | ${n.value?.lineNames}`},{default:N(()=>[a(z,null,{default:N(()=>[e("thead",null,[e("tr",null,[t[3]||(t[3]=e("th",{class:"!bg-white"},"Color",-1)),e("th",{colspan:(n.value?.items.length??0)+1,class:"!text-center !bg-white !text-blue-600 !font-semibold"},c(n.value?.color),9,_e)]),e("tr",null,[t[4]||(t[4]=e("th",{class:"!bg-white"},"Size",-1)),(i(!0),u(y,null,b(n.value?.items,l=>(i(),u("th",ge,c(l.size),1))),256)),t[5]||(t[5]=e("th",{class:"!bg-white !text-center"},"Total",-1))])]),e("tbody",null,[e("tr",null,[t[6]||(t[6]=e("td",null,"Cut Piece",-1)),(i(!0),u(y,null,b(n.value?.items,l=>(i(),u("td",xe,c(l.totalPcs),1))),256)),e("td",ye,c(n.value?.totalPcs),1)]),e("tr",null,[t[7]||(t[7]=e("td",null,"Defect",-1)),(i(!0),u(y,null,b(n.value?.items,l=>(i(),u("td",be,c(l.totalDefect),1))),256)),e("td",Ge,c(n.value?.totalDefect),1)]),e("tr",null,[t[8]||(t[8]=e("td",{class:"!bg-gray-50"},"Balance",-1)),(i(!0),u(y,null,b(n.value?.items,l=>(i(),u("td",we,c(l.totalPcs-l.totalDefect),1))),256)),e("td",ve,c((n.value?.totalPcs??0)-(n.value?.totalDefect??0)),1)])])]),_:1})]),_:1},8,["show","title"])])}}}),Ne={class:"!w-[300px]"},Se={key:0,class:"flex flex-col gap-1"},$e={class:"flex gap-2 items-end justify-between"},De={class:"text-gray-400"},ke={class:"text-lg font-bold text-red-600"},Ce={class:"text-sm"},Re={class:"flex justify-between"},Fe={class:"text-gray-400"},Pe={class:"font-semibold"},Te={class:"flex justify-between"},je={class:"text-gray-400 text-xs"},Be={class:"text-gray-400 text-xs"},Ve={key:1,class:"flex flex-col gap-1"},ze={class:"flex gap-2 items-end justify-between"},Me={class:"text-lg font-bold text-red-600"},Ae={class:"text-sm"},Ie={class:"flex justify-between"},Ue={class:"font-semibold"},qe=T({__name:"DefectSummaryCard",setup(o){const{loading:s,summaryGroupLine:n}=B();return(x,d)=>{const m=w("n-skeleton"),v=w("n-card");return i(),u("div",Ne,[a(v,{class:"shadow-xs"},{default:N(()=>[_(s)?(i(),u("div",Se,[e("div",$e,[e("p",De,[a(m,{width:80,text:""})]),e("p",ke,[a(m,{width:40,text:""})])]),e("div",Ce,[e("div",Re,[e("p",Fe,[a(m,{width:80,text:""})]),e("p",Pe,[a(m,{width:20,text:""})])])]),d[0]||(d[0]=e("div",{class:"border-b-1 border-gray-200 my-2"},null,-1)),e("div",Te,[e("p",je,[a(m,{width:80,text:""})]),e("p",Be,[a(m,{width:120,text:""})])])])):(i(),u("div",Ve,[e("div",ze,[d[1]||(d[1]=e("p",{class:"text-gray-400"},"Total Defect",-1)),e("p",Me,c(_(n).totalDefect),1)]),e("div",Ae,[e("div",Ie,[d[2]||(d[2]=e("p",{class:"text-gray-400"},"Total Lines",-1)),e("p",Ue,c(_(n).totalLines),1)])]),d[3]||(d[3]=e("div",{class:"border-b-1 border-gray-200 my-2"},null,-1)),d[4]||(d[4]=e("div",{class:"flex justify-between"},[e("p",{class:"text-gray-400 text-xs"},"Last Updated"),e("p",{class:"text-gray-400 text-xs"},"November 20, 2025 12:10")],-1))]))]),_:1})])}}}),Ee={class:"flex flex-col gap-10"},Ze=T({__name:"DefectPageView",setup(o){const{handleFetchSummaryGroupLines:s,handleFetchGroupGlNumber:n}=B();return Q(async()=>{await s(),await n()}),(x,d)=>(i(),u("div",Ee,[a(qe),a(Le)]))}});export{Ze as default};
