import{G as T,u as b,a as M}from"./gls.store-Cie-SQof.js";import{D as w,E as x,p as v,s as S,r as h,q as k,k as G,h as E}from"./index-BGjygZi6.js";import{A as L}from"./api.schema-B7NsqcGR.js";const D=w("glsTable",{state:()=>({data:[],meta:{},links:{},loading:!1,error:null}),actions:{async fetch(t={}){this.loading=!0,this.error=null;try{const a=await x.get("/api/gls",{params:{page:t.page??1,perPage:t.perPage??10,search:t.search??void 0}}),e=T.parse(a.data);return this.data=Array.isArray(e.data)?e.data:[],this.meta=e.meta,this.links=e.links,{success:!0,message:e.message??"GLs loaded"}}catch(a){const e=a?.response?.data?.message||"Fetch failed";return this.error=e,this.data=[],{success:!1,message:e}}finally{this.loading=!1}}},getters:{options:t=>t.data.map(a=>({value:a.glNo,label:a.glNo}))}});function z(){const t=v(),a=D(),{data:e,loading:g,meta:c}=S(a),d=h(""),n=h([]),o=h(!1),i=async(s=!0)=>{const{success:u,message:r}=await a.fetch({search:d.value||void 0});s&&(u?t.success(r):t.error(r))};k(d,async s=>{if(!s){n.value=[],o.value=!1,await i(!1);return}const u=a.data.filter(r=>r.glNo?.toLowerCase().includes(s.toLowerCase()));u.length>0?(n.value=u,o.value=!0):(await i(!1),a.data.length===0?(n.value=[],o.value=!1):(n.value=a.data,o.value=!0))});const f=G(()=>o.value?n.value:e.value);return{meta:c,data:f,search:d,loading:g,handleFetch:i}}function I(){const t=b(),a=v(),{matrixData:e,matrixSummary:g}=S(t),c=h({}),d=G(()=>e.value.map(s=>s.date)),n=G(()=>e.value.map(s=>s.totalPcs)),o=h(),i=h();return c.value={tooltip:{trigger:"axis"},legend:{data:["PCS","Bundle"]},grid:{left:"0%",right:"0%",bottom:"1%",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,data:d},yAxis:{type:"value"},series:[{name:"PCS",type:"line",smooth:!0,data:n,areaStyle:{opacity:.6,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#6366f1"},{offset:1,color:"rgba(99,102,241,0)"}]}},itemStyle:{color:"#4f46e5"},lineStyle:{width:3}}]},{matrixData:e,matrixSummary:g,startDate:o,endDate:i,GLNumberOptionsEchart:c,handleFetchGLMatrix:async(s,u={notify:!0})=>{const{success:r,message:p,data:m}=await t.fetchGLMatix(s);u.notify&&(r?a.success(p):a.error(p)),r&&m&&(o.value=m.startDate,i.value=m.endDate)}}}const O=w("glsSync",{state:()=>({data:{},colors:[],loading:!1,error:null}),actions:{async fetchSyncCuttingGL(t){this.loading=!0,this.error=null;try{const a=await x.get("/api/gls/syncCuttingGlNumber",{params:{glNumber:t}}),e=M.parse(a.data),{colors:g,...c}=e.data;return this.data=c,this.colors=e.data.colors,L.parse({success:!0,message:a.data.message??"Gl Numbers loaded"})}catch(a){const e=a?.response?.data?.message||"Something went wrong";return this.error=e,L.parse({success:!1,message:e})}finally{this.loading=!1}}}});function V(){const t=v(),a=D(),e=b(),g=O(),{handleFetch:c,data:d,loading:n,search:o,meta:i}=z(),{data:f,loading:s,colors:u}=S(g),{matrixData:r,matrixSummary:p,GLNumberOptionsEchart:m,handleFetchGLMatrix:P,startDate:N,endDate:A}=I(),y=h(10),F=E();return{data:d,meta:i,search:o,loading:n,glCombineData:f,glCombineColors:u,glCombineLoading:s,matrixData:r,matrixSummary:p,startDate:N,endDate:A,GLNumberOptionsEchart:m,handleFetch:c,handlePageChange:async l=>{await a.fetch({page:l,perPage:y.value})},handlePageSizeChange:async l=>{y.value=l,await a.fetch({page:1,perPage:y.value})},handleCuttingIntegrationGl:async l=>{await e.fetchSummaryGl(l)},handleSyncCuttingGL:async l=>{const{success:R,message:C}=await g.fetchSyncCuttingGL(l);R?t.success(C):t.error(C)},navigateToGLDetail:l=>{F.push({name:"gls-detail",params:{id:l}})},handleFetchGLMatrix:P}}export{V as a,z as u};
