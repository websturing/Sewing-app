import{u as v}from"./useFieldWrapper-CEDM__2o.js";import{U as R,a as F}from"./user.schema-DUhrVGkL.js";import{D as C,E as l,p as P}from"./index-Dk1rQdoc.js";import{A as o}from"./api.schema-BwRGpLBP.js";import{t as U}from"./vee-validate-zod-DdOocCPf.js";import{u as D}from"./vee-validate-BKX4jqAw.js";const L=C("users",{state:()=>({data:[],searchResult:[],isSearching:!1,meta:{},links:{},loading:!1,error:null,currentPage:1,lastPage:1,search:""}),actions:{async fetch(e={}){this.loading=!0,this.error=null,console.log("fetching user data");try{const s={page:e.page??1,perPage:e.perPage??10,q:e.q??void 0,dateFrom:e.dateFrom,dateTo:e.dateTo};console.log("fetching user data 1"),e.q&&(this.searchResult=[],this.isSearching=!0);const a=await l.get("/api/users",{params:s});console.log(a.data);const t=R.parse(a.data);return console.log(t),this.meta=t.meta,this.links=t.links,this.currentPage=t.meta.currentPage,this.lastPage=t.meta.lastPage,e.q?this.searchResult=t.data:(this.data=t.data,this.isSearching=!1,this.searchResult=[]),o.parse({success:!0,message:t.message??"Employees loaded"})}catch(s){const a=s?.response?.data?.message||"Something went wrong";return this.error=a,o.parse({success:!1,message:a})}finally{this.loading=!1}},async searchOrFetch(e){if(this.search!==e&&(this.searchResult=[],this.isSearching=!1),this.search=e,!e)return await this.fetch(),this.data;const s=this.data.filter(t=>t.name?.toLowerCase().includes(e)||t.email?.toLowerCase().includes(e));return s.length>0?(this.searchResult=s,this.isSearching=!0,s):(await this.fetch({page:1,q:e})).success?this.searchResult:[]},async create(e){this.loading=!0,this.error=null;try{const s=await l.post("/api/users",e);return this.data.push(s.data.data),this.error=null,o.parse({success:!0,message:s.data.message??"Data Created Succesfully",id:s.data.data.id})}catch(s){const a=s?.response?.data?.message||"Someting Wrong";return this.error=a,o.parse({success:!1,message:a})}finally{this.loading=!1}},async update(e,s){this.loading=!0,this.error=null;try{const a=await l.post(`/api/users/${e}`,s),t=this.data.findIndex(u=>u.id===e);return t!==-1&&(this.data[t]={...this.data[t],...a.data.data}),this.error=null,o.parse({success:!0,message:a.data.message??"Data Update Successfully"})}catch(a){const t=a?.response?.data?.message||"Something Wrong";return this.error=t,o.parse({success:!1,message:t})}finally{this.loading=!1}},async delete(e){this.loading=!0,this.error=null;try{const s=await l.delete(`/api/users/${e}`);return this.data=this.data.filter(a=>a.id!==e),this.error=null,o.parse({success:!0,message:s.data.message??"Data Delete Successfully"})}catch(s){const a=s?.response?.data?.message||"Something Wrong";return this.error=a,o.parse({success:!1,message:a})}finally{this.loading=!1}}},getters:{searchedItems:e=>{if(!e.search)return e.data;if(e.isSearching&&e.searchResult.length)return e.searchResult;const s=e.search.toLowerCase();return e.data.filter(a=>a.name?.toLowerCase().includes(s)||a.email?.toLowerCase().includes(s))}}});function M(e=null){const s=P(),a=L(),t=()=>({email:e?.email??"",name:e?.name??"",roleNames:e?.roleNames??[]}),{handleSubmit:u,errors:d,isSubmitting:m,resetForm:g,validate:f}=D({validationSchema:U(F),initialValues:t()}),p=()=>{g({values:t(),errors:{}})},{email:S,name:y,roleNames:w}=v(["email","name","roleNames"]);return{name:y,email:S,roleNames:w,errors:d,isSubmitting:m,validateForm:async()=>{const r=await f();return r.valid?{valid:!0,values:r.values}:{valid:!1}},onSubmit:r=>u(r),resetForm:p,handleCreateStore:async(r,c={notify:!0})=>{const{success:n,message:i}=await a.create(r);return c.notify&&(n?s.success(i):s.error(i)),{success:n,message:i}},handleUpdateStore:async(r,c,n={notify:!0})=>{const{success:i,message:h}=await a.update(r,c);return n.notify&&(i?s.success(h):s.error(h)),{success:i,message:h}},handleDeleteStore:async(r,c={notify:!0})=>{const{success:n,message:i}=await a.delete(r);return c.notify&&(n?s.success(i):s.error(i)),{success:n,message:i}}}}export{L as a,M as u};
