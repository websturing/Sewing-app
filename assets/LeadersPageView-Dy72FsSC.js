import{d as T,k as U,c as A,o as b,x as W,e as s,t as w,g as l,W as ae,L as ne,w as B,l as Q,m as $,f as S,E as z,D as le,p as X,r as I,y as Y,a as e,n as N,F as j,H as q,v as oe,s as re}from"./index-D1JVnUop.js";import{_ as E}from"./BaseButton.vue_vue_type_script_setup_true_lang-Lz5EE8Oa.js";import{A as ie}from"./AlertOutline-CM9tAc53.js";import{u as de}from"./useFieldWrapper-Bzi3EEPU.js";import{o as H,c as Z,a as D,n as R,s as x}from"./types-CVZIcfwR.js";import{A as V}from"./api.schema-B7NsqcGR.js";import{c as ue}from"./defect.summaryApi-CUJMEH2X.js";import{u as ce}from"./line.page-C-AkZQ-y.js";import{u as me}from"./user.table-C6WWjrV0.js";import{t as pe}from"./vee-validate-zod-DKsvp3Q-.js";import{u as fe}from"./vee-validate-oyuuBr7W.js";import{S as ge,P as ve}from"./SaveArrowRight20Filled-UwoqSfzS.js";import{_ as ye}from"./BaseInput.vue_vue_type_script_setup_true_lang-CKPuqIwF.js";import{S as _e}from"./SearchOutline-SzTXtDb2.js";import{R as he}from"./RefreshRound-D7bULExg.js";import{C as ee}from"./ChartPerson20Filled-BzAfcP8X.js";import{F as be}from"./FolderDetailsReference-CwUdPQNT.js";import{S as Le}from"./SmartHome-erlrdeMA.js";import"./index-B-cYlh1f.js";import"./_commonjsHelpers-CE1G-McA.js";import"./stockin.api.schema-DC3-uBMr.js";import"./metaPagination-9MSE0uSw.js";import"./dateRangeFormaterNaive-ClR-GZjc.js";import"./user.store-BhfQTC4h.js";import"./user.schema-BXMI3HnA.js";import"./employeeSchema-AqYtwcrb.js";const xe={class:"flex flex-col gap-1"},Se=["status","for"],G=T({__name:"BaseSelectWithError",props:{modelValue:{},options:{},placeholder:{default:"Select option"},clearable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},size:{default:"medium"},icon:{default:null},errors:{},label:{},name:{},multiple:{type:Boolean,default:!1},classContent:{}},emits:["update:modelValue"],setup(a,{emit:n}){const t=a,f=n,i=U(()=>t.errors?.[t.name]),p=U(()=>i.value?"error":void 0);return(r,o)=>{const c=S("n-icon"),L=S("n-tooltip");return b(),A("div",xe,[r.label?(b(),A("label",{key:0,status:p.value,for:t.name,class:"text-sm font-medium text-gray-700"},w(r.label),9,Se)):W("",!0),s(l(ae),{id:t.name,value:t.modelValue,options:t.options,multiple:t.multiple,placeholder:t.placeholder,clearable:t.clearable,filterable:t.filterable,size:t.size,"onUpdate:value":o[0]||(o[0]=m=>f("update:modelValue",m)),class:ne([t.classContent,"!min-w-[200px]"]),"max-tag-count":t.multiple?0:void 0,"render-tag":t.multiple?()=>null:void 0},{arrow:B(()=>[i.value?(b(),Q(L,{key:0,show:!!i.value,trigger:"hover"},{trigger:B(()=>[s(c,{component:l(ie),color:"red"},null,8,["component"])]),default:B(()=>[$(" "+w(i.value),1)]),_:1},8,["show"])):W("",!0)]),_:1},8,["id","value","options","multiple","placeholder","clearable","filterable","size","class","max-tag-count","render-tag"])])}}}),Ae=H({userId:R().nullable().refine(a=>a!==null,"Leader is required").transform(a=>a),lineId:D(R()).min(1,"Leader is required"),isActive:Z()}),M="/api",J={getAssignments:()=>z.get(`${M}/leaders`).then(a=>a.data),createAssign:a=>z.post(`${M}/leaders/assign`,a).then(n=>n.data),createUnassign:a=>z.post(`${M}/leaders/unassign`,a).then(n=>n.data)},K=H({assignAt:x(),unassignAt:x().nullable(),lineId:R().nullable(),lineName:x().nullable(),createdBy:x(),updatedBy:x().nullable(),lastUpdated:x()}),we=H({leader:x(),leaderId:R(),isActive:Z(),activeLines:x(),activeLineIds:x(),lastUpdated:x().nullable(),activeDetail:D(K),inactiveDetail:D(K)}),Be=ue(D(we)),te=le("leaderStore",{state:()=>({loading:!1,error:null,AssignmentSummaryByLeader:[]}),actions:{async fetchSummaryByLeader(){this.loading=!0,this.error=null;try{const a=await J.getAssignments(),n=Be.parse(a);return this.AssignmentSummaryByLeader=n.data,V.parse({success:!0,message:n.message??"loaded"})}catch(a){const n=a?.response?.data?.message||"Something went wrong";return this.error=n,V.parse({success:!1,message:n})}finally{this.loading=!1}},async createAssignLeader(a){try{const n=await J.createAssign(a);return V.parse({success:!0,message:n.message??"Created",data:n.data})}catch(n){const t=n?.response?.data?.message||"Something went wrong";return this.error=t,V.parse({success:!1,message:t})}finally{this.loading=!1}}}});function ke(a=null){X();const n=te(),t=I(!1),{rows:f,handleFetch:i}=me(),{data:p,handleFetch:r}=ce(),o=U(()=>f.value.map(_=>({label:_.name,value:_.id}))),c=U(()=>p.value.map(_=>({label:_.name,value:_.id}))),L=async _=>{t.value=!0,await n.createAssignLeader(_),t.value=!1},m=async()=>{await Promise.all([i(),r({notify:!1},{})])},d=()=>({userId:a?.userId??null,lineId:a?.lineId??[],isActive:a?.isActive??!0}),{handleSubmit:g,errors:v,isSubmitting:C,resetForm:y,validate:F}=fe({validationSchema:pe(Ae),initialValues:d()}),{userId:k,lineId:u,isActive:P}=de(["userId","lineId","isActive"]);return{isLoading:t,userId:k,lineId:u,isActive:P,optionUsers:o,optionLines:c,handleUserLineData:m,onSubmit:g,resetForm:()=>{y({values:d(),errors:{}})},errors:v,isSubmitting:C,validateForm:async()=>{const _=await F();return _.valid?{valid:!0,values:_.values}:{valid:!1}},handleCreateAssignLeader:L}}const Ce={class:"flex flex-col gap-5"},Fe={class:"flex gap-2 items-end"},Ie={class:"flex flex-col"},Ue={class:"bg-gray-50 border border-gray-200 p-3 rounded-lg"},Ve={class:"flex gap-2 flex-wrap mt-2"},$e={class:"flex gap-2 justify-end"},De=T({__name:"LeaderAssignmentForm",props:{modal:{type:Boolean},initialData:{}},emits:["update:modal"],setup(a,{emit:n}){const t=a,{isLoading:f,userId:i,lineId:p,isActive:r,optionLines:o,optionUsers:c,onSubmit:L,errors:m,resetForm:d,handleUserLineData:g,handleCreateAssignLeader:v}=ke(t.initialData),C=L(k=>{v(k),F(!1)}),y=n,F=k=>{y("update:modal",k)};return Y(async()=>{await g()}),(k,u)=>{const P=S("n-switch"),O=S("n-tag");return b(),A("div",null,[e("form",{onSubmit:u[3]||(u[3]=oe((...h)=>l(C)&&l(C)(...h),["prevent"]))},[e("div",Ce,[u[6]||(u[6]=e("div",{class:"mb-5"},[e("p",{class:"text-xl font-semibold"},"Leader Assignment Form"),e("p",null,"A dedicated form interface for assigning leaders to specific production lines.")],-1)),e("div",Fe,[s(G,{name:"userId",options:l(c),label:"Leaders",modelValue:l(i),"onUpdate:modelValue":u[0]||(u[0]=h=>N(i)?i.value=h:null),placeholder:"Select Leader",errors:l(m)},null,8,["options","modelValue","errors"]),s(G,{name:"lineId",options:l(o),multiple:"",label:"Lines",modelValue:l(p),"onUpdate:modelValue":u[1]||(u[1]=h=>N(p)?p.value=h:null),placeholder:"Select Lines",errors:l(m)},null,8,["options","modelValue","errors"]),e("div",Ie,[u[4]||(u[4]=e("label",{id:"isActive",class:"mb-2 font-semibold"},"Is Active",-1)),s(P,{round:!1,size:"large",value:l(r),"onUpdate:value":u[2]||(u[2]=h=>N(r)?r.value=h:null)},null,8,["value"])])]),e("div",Ue,[u[5]||(u[5]=e("p",{class:"text-xs text-gray-400"},"Selected Lines",-1)),e("div",Ve,[(b(!0),A(j,null,q(l(p),h=>(b(),Q(O,{key:h,size:"small",type:"info",round:""},{default:B(()=>[$(w(l(o).find(_=>_.value===h)?.label),1)]),_:2},1024))),128))])]),e("div",$e,[s(E,{label:"Reset",onClick:l(d),type:"error",quaternary:""},null,8,["onClick"]),s(E,{label:"Assign Leader",icon:l(ge),"icon-placement":"right",loading:l(f),type:"primary",attrType:"submit"},null,8,["icon","loading"])])])],32)])}}});function se(){const a=X(),n=te(),t=I(!1),{loading:f,AssignmentSummaryByLeader:i}=re(n);return{leaderPiniaLoading:f,isLoading:t,AssignmentSummaryByLeader:i,fetchSummaryByLeader:async(r={notify:!0})=>{const{success:o,message:c}=await n.fetchSummaryByLeader();return r.notify&&(o?a.success(c):a.error(c)),{success:o,message:c}}}}const Re={class:"flex flex-col gap-5"},Te={class:"flex justify-between"},Pe={class:"!w-[300px]"},ze={class:"flex gap-3 items-center"},Ne={class:"flex gap-2"},Me=T({__name:"SummaryLeaderTable",emits:["click:unassignLine"],setup(a,{emit:n}){const t=I(""),f=U(()=>{const m=t.value.toLowerCase().trim();return m?(p.value||[]).filter(d=>d.leader?.toLowerCase().includes(m)||d.activeLines?.toLowerCase().includes(m)):p.value||[]}),{leaderPiniaLoading:i,AssignmentSummaryByLeader:p,fetchSummaryByLeader:r}=se(),o=n,c=async()=>{await r()},L=async m=>{o("click:unassignLine",m)};return(m,d)=>{const g=E,v=S("n-skeleton"),C=S("n-table");return b(),A("div",Re,[e("div",Te,[e("div",Pe,[s(ye,{icon:l(_e),placeholder:"Search",modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=y=>t.value=y)},null,8,["icon","modelValue"])]),e("div",ze,[s(g,{label:"Refresh",icon:l(he),onClick:c},null,8,["icon"]),s(g,{label:"Create Leader Assignment",icon:l(ee),onClick:c,type:"primary"},null,8,["icon"])])]),s(C,null,{default:B(()=>[d[2]||(d[2]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Leader"),e("th",null,"Line Assignments"),e("th",null,"Last Updated"),e("th",null,"Status")])],-1)),e("tbody",null,[l(i)?(b(),A(j,{key:0},q(10,y=>e("tr",{key:y},[e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})]),e("td",null,[s(v,{text:""})])])),64)):(b(!0),A(j,{key:1},q(f.value,(y,F)=>(b(),A("tr",{key:F},[e("td",null,w(F+1),1),e("td",null,w(y.leader),1),e("td",null,w(y.activeLines),1),e("td",null,w(y.lastUpdated),1),e("td",Ne,[s(g,{label:"Detail",icon:l(be),onClick:d[1]||(d[1]=()=>{}),tertiary:""},null,8,["icon"]),s(g,{label:"Unasssign Line",icon:l(ve),tertiary:"",type:"error",onClick:k=>L(y)},null,8,["icon","onClick"])])]))),128))])]),_:1})])}}}),je={class:"flex flex-col gap-10"},qe={class:"flex justify-between items-center"},Ee={class:"w-84 flex-auto"},He={class:"text-xl font-bold mb-1"},Oe={class:"w-16 flex-auto text-right"},_t=T({__name:"LeadersPageView",setup(a){const n=I({title:"Leader Management Module",description:"A centralized interface enabling users to view, create, and maintain leader records assigned across multiple production lines. The module streamlines oversight, improves data governance, and ensures operational visibility by providing a structured workflow for leader placement and line assignments."}),t=I(!1),f=I(),{fetchSummaryByLeader:i}=se(),p=r=>{t.value=!0,f.value={userId:r.leaderId,lineId:r.activeLineIds.split(",").map(Number),isActive:r.isActive}};return Y(async()=>{await i()}),(r,o)=>{const c=S("n-icon"),L=S("n-breadcrumb-item"),m=S("n-breadcrumb"),d=S("n-modal");return b(),A("div",je,[e("div",qe,[e("div",Ee,[e("h2",He,w(n.value.title),1),e("p",null,w(n.value.description),1)]),e("div",Oe,[s(m,null,{default:B(()=>[s(L,null,{default:B(()=>[s(c,{component:l(Le)},null,8,["component"]),o[2]||(o[2]=$(" Home",-1))]),_:1}),s(L,null,{default:B(()=>[s(c,{component:l(ee)},null,8,["component"]),o[3]||(o[3]=$(" Leaders ",-1))]),_:1})]),_:1})])]),s(Me,{"onClick:unassignLine":p}),s(d,{show:t.value,"onUpdate:show":o[1]||(o[1]=g=>t.value=g),preset:"card",style:"width: 1200px"},{default:B(()=>[s(De,{modal:t.value,"onUpdate:modal":o[0]||(o[0]=g=>t.value=g),initialData:f.value},null,8,["modal","initialData"])]),_:1},8,["show"])])}}});export{_t as default};
