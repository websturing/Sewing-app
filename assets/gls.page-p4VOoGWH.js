import{D as v,E as G,p as C,s as y,r as h,q as b,k as P,h as D}from"./index-BL_L1Flw.js";import{G as R,a as T,u as N}from"./gls.store-BP6Hexmm.js";import{A as p}from"./api.schema-363JpEzr.js";const S=v("glsTable",{state:()=>({data:[],meta:{},links:{},loading:!1,error:null}),actions:{async fetch(s={}){this.loading=!0,this.error=null;try{const a=await G.get("/api/gls",{params:{page:s.page??1,perPage:s.perPage??10,search:s.search??void 0}}),e=R.parse(a.data);return this.data=Array.isArray(e.data)?e.data:[],this.meta=e.meta,this.links=e.links,{success:!0,message:e.message??"GLs loaded"}}catch(a){const e=a?.response?.data?.message||"Fetch failed";return this.error=e,this.data=[],{success:!1,message:e}}finally{this.loading=!1}}},getters:{options:s=>s.data.map(a=>({value:a.glNo,label:a.glNo}))}});function k(){const s=C(),a=S(),{data:e,loading:i,meta:g}=y(a),u=h(""),o=h([]),r=h(!1),d=async(l=!0)=>{const{success:c,message:n}=await a.fetch({search:u.value||void 0});l&&(c?s.success(n):s.error(n))};b(u,async l=>{if(!l){o.value=[],r.value=!1,await d(!1);return}const c=a.data.filter(n=>n.glNo?.toLowerCase().includes(l.toLowerCase()));c.length>0?(o.value=c,r.value=!0):(await d(!1),a.data.length===0?(o.value=[],r.value=!1):(o.value=a.data,r.value=!0))});const m=P(()=>r.value?o.value:e.value);return{meta:g,data:m,search:u,loading:i,handleFetch:d}}const A=v("glsSync",{state:()=>({data:{},colors:[],loading:!1,error:null}),actions:{async fetchSyncCuttingGL(s){this.loading=!0,this.error=null;try{const a=await G.get("/api/gls/syncCuttingGlNumber",{params:{glNumber:s}}),e=T.parse(a.data),{colors:i,...g}=e.data;return this.data=g,this.colors=e.data.colors,p.parse({success:!0,message:a.data.message??"Gl Numbers loaded"})}catch(a){const e=a?.response?.data?.message||"Something went wrong";return this.error=e,p.parse({success:!1,message:e})}finally{this.loading=!1}}}});function B(){const s=C(),a=S(),e=N(),i=A(),{handleFetch:g,data:u,loading:o,search:r,meta:d}=k(),{data:m,loading:l,colors:c}=y(i),n=h(10),w=D();return{data:u,meta:d,search:r,loading:o,glCombineData:m,glCombineColors:c,glCombineLoading:l,handleFetch:g,handlePageChange:async t=>{await a.fetch({page:t,perPage:n.value})},handlePageSizeChange:async t=>{n.value=t,await a.fetch({page:1,perPage:n.value})},handleCuttingIntegrationGl:async t=>{await e.fetchSummaryGl(t)},handleSyncCuttingGL:async t=>{const{success:L,message:f}=await i.fetchSyncCuttingGL(t);L?s.success(f):s.error(f)},navigateToGLDetail:t=>{w.push({name:"gls-detail",params:{id:t}})}}}export{B as a,k as u};
